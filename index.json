[{"categories":null,"content":"âœ… To do list Icons made by Freepik from www.flaticon.com å¾…è¾¦äº‹é … ","date":"0001-01-01","objectID":"/notes/-to-do-list/:0:0","tags":null,"title":"âœ… To do list","uri":"/notes/-to-do-list/"},{"categories":null,"content":"ğŸ’» Python ","date":"0001-01-01","objectID":"/notes/-to-do-list/:1:0","tags":null,"title":"âœ… To do list","uri":"/notes/-to-do-list/"},{"categories":null,"content":"ğŸŒ hsiangjenli.github.io pyç¶²ç«™ + [ ] [[ğŸ’» Django]] Project [[Heroku]] [[è‚¡ç¥¨ç¶²ç«™]] + [ ] [[FastAPI]] + [ ] [[streamlit]] Machine Learning + [ ] [[sci-kit learn]] + [ ] [[æ©Ÿå™¨å­¸ç¿’çš„æ•¸å­¸åŸºç¤ : AIã€æ·±åº¦å­¸ç¿’æ‰“åº•å¿…è®€]] è³‡æ–™è¦–è¦ºåŒ– + [ ] [[Power BI]] + [x] [[OREILLYï½œè³‡æ–™è¦–è¦ºåŒ–]] å…¶ä»– + [ ] [[asyncio]] + [ ] [[talib]] + [ ] [[Tkinter Designer]] ğŸƒ æ¼”ç®—æ³• + [ ] [[æ²³å…§å¡”ï½œTower of Hanoi]] ","date":"0001-01-01","objectID":"/notes/-to-do-list/:1:1","tags":null,"title":"âœ… To do list","uri":"/notes/-to-do-list/"},{"categories":null,"content":"ğŸ’£ Python å‡½æ•¸ Python Built-in Functions Python3å†…ç½®å‡½æ•°æ±‡æ€» ","date":"0001-01-01","objectID":"/notes/-to-do-list/:1:2","tags":null,"title":"âœ… To do list","uri":"/notes/-to-do-list/"},{"categories":null,"content":"ğŸ“ æ–‡ç«  Visualizing Networks in Python Githubï½œgrokking_algorithms VISUALIZE CODE EXECUTION Githubï½œmatplotlib-cheatsheet Pyinstalleræ‰“åŒ…åçš„exeæ–‡ä»¶æ‰“å¼€é—ªé€€è§£å†³æ–¹æ¡ˆ Facebook AIé€ å­—ç¶“é©—åˆ†äº« Facebook ","date":"0001-01-01","objectID":"/notes/-to-do-list/:1:3","tags":null,"title":"âœ… To do list","uri":"/notes/-to-do-list/"},{"categories":null,"content":"ğŸ“– æ›¸ åœ–èªªæ¼”ç®—æ³•ï¼šä½¿ç”¨Python-å³ç‡¦éŠ˜ åœ–è§£è³‡æ–™çµæ§‹-ä½¿ç”¨Python-å³ç‡¦éŠ˜ å¯«ç¨‹å¼å‰å°±è©²æ‡‚çš„æ¼”ç®—æ³•ï¼šè³‡æ–™åˆ†æèˆ‡ç¨‹å¼è¨­è¨ˆäººå“¡å¿…å­¸çš„é‚è¼¯æ€è€ƒè¡“ Pandasè³‡æ–™åˆ†æå¯¦æˆ°ï¼šä½¿ç”¨Pythoné€²è¡Œé«˜æ•ˆèƒ½è³‡æ–™è™•ç†åŠåˆ†æ NumPy é«˜é€Ÿé‹ç®—å¾¹åº•è§£èªªï¼šå…­è¡Œå¯«ä¸€éš»ç¨‹å¼ï¼Ÿä½ çœŸæ‡‚æ·±åº¦å­¸ç¿’ï¼Ÿæ‰‹å·¥ç®—çµ¦ä½ çœ‹ï¼ ","date":"0001-01-01","objectID":"/notes/-to-do-list/:1:4","tags":null,"title":"âœ… To do list","uri":"/notes/-to-do-list/"},{"categories":null,"content":"ğŸƒ Leisure Activities ","date":"0001-01-01","objectID":"/notes/-to-do-list/:2:0","tags":null,"title":"âœ… To do list","uri":"/notes/-to-do-list/"},{"categories":null,"content":"âœ‚ï¸ æ‰‹å·¥è— é¯Šé­šæ›ä»¶ææ–™åŒ… ä¿„ç¾…æ–¯æˆ³æˆ³ç¹¡ ","date":"0001-01-01","objectID":"/notes/-to-do-list/:2:1","tags":null,"title":"âœ… To do list","uri":"/notes/-to-do-list/"},{"categories":null,"content":"ğŸ“š é–±è®€ [[åˆ»æ„ç·´ç¿’]] [[æ–œæ§“é’å¹´SLASH]] [[æ•¸å­¸æ•™ä½ ä¸çŠ¯éŒ¯ ê‰ ä¸‹å†Š, ê‰ æå®šæœŸæœ›å€¼ã€èªæ¸…è¿´æ­¸è¶¨å‹¢ã€å¼„æ‡‚å­˜åœ¨æ€§]] [[æˆ‘å€‘å¦‚ä½•ä¸ˆé‡ä¸–ç•Œ å¾ç”Ÿæ´»çš„å–®ä½çœ‹è¦‹ç§‘å­¸çš„è¶£å‘³]] [[èª²å ‚ä¸Šæ²’æ•™çš„ç§‘å­¸çŸ¥è­˜ 60å‰‡ä»¤äººæ‹æ¡ˆå«çµ•çš„æ•…äº‹]] ","date":"0001-01-01","objectID":"/notes/-to-do-list/:2:2","tags":null,"title":"âœ… To do list","uri":"/notes/-to-do-list/"},{"categories":null,"content":"note ğŸ² Dictionary Get key by value in dictionary def getKeyByValue(mydict, value): return list(mydict.keys())[list(mydict.values()).index(value)] def getKeyByValue(mydict, value): return [k for k, v in mydict.items() if v == value] \rè«‹å•å…©å€‹dcitè¦åˆä½µ(æœ‰æ¢ä»¶çš„åˆä½µï¼Œä¸ä¸€å®šæ˜¯è¦æ–°çš„è“‹æ‰èˆŠçš„)\r\r---\rğŸ¦ List ğŸº The Python Profilers A profile is a set of statistics that describes how often and for how long various parts of the program executed. ğŸ¦Š timeit ğŸ¦ if __name__ == '__main__': pythonçš„ if name == â€˜main': æ˜¯ä»€éº¼æ„æ€? Python - if name == â€˜mainâ€™ æ¶µç¾© Python __name__ä¸â€œmainâ€œæ˜¯ä»€ä¹ˆæ„æ€? è³‡æ–™ \rè³‡æ–™åº«ã€è³‡æ–™å€‰å„²ã€è³‡æ–™å¸‚é›†ã€è³‡æ–™æ¹– \rè³‡æ–™åº«ã€è³‡æ–™å€‰å„²\r\r\r","date":"0001-01-01","objectID":"/notes/note/:1:0","tags":null,"title":"note","uri":"/notes/note/"},{"categories":null,"content":"æ•¸å­¸æ•™ä½ ä¸çŠ¯éŒ¯ ê‰ ä¸‹å†Š, ê‰ æå®šæœŸæœ›å€¼ã€èªæ¸…è¿´æ­¸è¶¨å‹¢ã€å¼„æ‡‚å­˜åœ¨æ€§ ","date":"0001-01-01","objectID":"/notes/%E6%95%B8%E5%AD%B8%E6%95%99%E4%BD%A0%E4%B8%8D%E7%8A%AF%E9%8C%AF-%E4%B8%8B%E5%86%8A-%E6%90%9E%E5%AE%9A%E6%9C%9F%E6%9C%9B%E5%80%BC%E8%AA%8D%E6%B8%85%E8%BF%B4%E6%AD%B8%E8%B6%A8%E5%8B%A2%E5%BC%84%E6%87%82%E5%AD%98%E5%9C%A8%E6%80%A7/:0:0","tags":null,"title":"æ•¸å­¸æ•™ä½ ä¸çŠ¯éŒ¯ ê‰ ä¸‹å†Š, ê‰ æå®šæœŸæœ›å€¼ã€èªæ¸…è¿´æ­¸è¶¨å‹¢ã€å¼„æ‡‚å­˜åœ¨æ€§","uri":"/notes/%E6%95%B8%E5%AD%B8%E6%95%99%E4%BD%A0%E4%B8%8D%E7%8A%AF%E9%8C%AF-%E4%B8%8B%E5%86%8A-%E6%90%9E%E5%AE%9A%E6%9C%9F%E6%9C%9B%E5%80%BC%E8%AA%8D%E6%B8%85%E8%BF%B4%E6%AD%B8%E8%B6%A8%E5%8B%A2%E5%BC%84%E6%87%82%E5%AD%98%E5%9C%A8%E6%80%A7/"},{"categories":null,"content":"æ¨‚é€çµ„åˆ ","date":"0001-01-01","objectID":"/notes/%E6%95%B8%E5%AD%B8%E6%95%99%E4%BD%A0%E4%B8%8D%E7%8A%AF%E9%8C%AF-%E4%B8%8B%E5%86%8A-%E6%90%9E%E5%AE%9A%E6%9C%9F%E6%9C%9B%E5%80%BC%E8%AA%8D%E6%B8%85%E8%BF%B4%E6%AD%B8%E8%B6%A8%E5%8B%A2%E5%BC%84%E6%87%82%E5%AD%98%E5%9C%A8%E6%80%A7/:1:0","tags":null,"title":"æ•¸å­¸æ•™ä½ ä¸çŠ¯éŒ¯ ê‰ ä¸‹å†Š, ê‰ æå®šæœŸæœ›å€¼ã€èªæ¸…è¿´æ­¸è¶¨å‹¢ã€å¼„æ‡‚å­˜åœ¨æ€§","uri":"/notes/%E6%95%B8%E5%AD%B8%E6%95%99%E4%BD%A0%E4%B8%8D%E7%8A%AF%E9%8C%AF-%E4%B8%8B%E5%86%8A-%E6%90%9E%E5%AE%9A%E6%9C%9F%E6%9C%9B%E5%80%BC%E8%AA%8D%E6%B8%85%E8%BF%B4%E6%AD%B8%E8%B6%A8%E5%8B%A2%E5%BC%84%E6%87%82%E5%AD%98%E5%9C%A8%E6%80%A7/"},{"categories":null,"content":"å®Œå…¨ç«¶çˆ­å¸‚å ´ ","date":"0001-01-01","objectID":"/notes/%E6%95%B8%E5%AD%B8%E6%95%99%E4%BD%A0%E4%B8%8D%E7%8A%AF%E9%8C%AF-%E4%B8%8B%E5%86%8A-%E6%90%9E%E5%AE%9A%E6%9C%9F%E6%9C%9B%E5%80%BC%E8%AA%8D%E6%B8%85%E8%BF%B4%E6%AD%B8%E8%B6%A8%E5%8B%A2%E5%BC%84%E6%87%82%E5%AD%98%E5%9C%A8%E6%80%A7/:2:0","tags":null,"title":"æ•¸å­¸æ•™ä½ ä¸çŠ¯éŒ¯ ê‰ ä¸‹å†Š, ê‰ æå®šæœŸæœ›å€¼ã€èªæ¸…è¿´æ­¸è¶¨å‹¢ã€å¼„æ‡‚å­˜åœ¨æ€§","uri":"/notes/%E6%95%B8%E5%AD%B8%E6%95%99%E4%BD%A0%E4%B8%8D%E7%8A%AF%E9%8C%AF-%E4%B8%8B%E5%86%8A-%E6%90%9E%E5%AE%9A%E6%9C%9F%E6%9C%9B%E5%80%BC%E8%AA%8D%E6%B8%85%E8%BF%B4%E6%AD%B8%E8%B6%A8%E5%8B%A2%E5%BC%84%E6%87%82%E5%AD%98%E5%9C%A8%E6%80%A7/"},{"categories":null,"content":"æ©¢åœ“ã€é›™æ›²ç·šã€æ‹‹ç‰©ç·š ![[attachments/Clipboard_2021-06-29-02-46-11.png]] ","date":"0001-01-01","objectID":"/notes/%E6%95%B8%E5%AD%B8%E6%95%99%E4%BD%A0%E4%B8%8D%E7%8A%AF%E9%8C%AF-%E4%B8%8B%E5%86%8A-%E6%90%9E%E5%AE%9A%E6%9C%9F%E6%9C%9B%E5%80%BC%E8%AA%8D%E6%B8%85%E8%BF%B4%E6%AD%B8%E8%B6%A8%E5%8B%A2%E5%BC%84%E6%87%82%E5%AD%98%E5%9C%A8%E6%80%A7/:3:0","tags":null,"title":"æ•¸å­¸æ•™ä½ ä¸çŠ¯éŒ¯ ê‰ ä¸‹å†Š, ê‰ æå®šæœŸæœ›å€¼ã€èªæ¸…è¿´æ­¸è¶¨å‹¢ã€å¼„æ‡‚å­˜åœ¨æ€§","uri":"/notes/%E6%95%B8%E5%AD%B8%E6%95%99%E4%BD%A0%E4%B8%8D%E7%8A%AF%E9%8C%AF-%E4%B8%8B%E5%86%8A-%E6%90%9E%E5%AE%9A%E6%9C%9F%E6%9C%9B%E5%80%BC%E8%AA%8D%E6%B8%85%E8%BF%B4%E6%AD%B8%E8%B6%A8%E5%8B%A2%E5%BC%84%E6%87%82%E5%AD%98%E5%9C%A8%E6%80%A7/"},{"categories":null,"content":"ç›¸é—œæ€§ ","date":"0001-01-01","objectID":"/notes/%E6%95%B8%E5%AD%B8%E6%95%99%E4%BD%A0%E4%B8%8D%E7%8A%AF%E9%8C%AF-%E4%B8%8B%E5%86%8A-%E6%90%9E%E5%AE%9A%E6%9C%9F%E6%9C%9B%E5%80%BC%E8%AA%8D%E6%B8%85%E8%BF%B4%E6%AD%B8%E8%B6%A8%E5%8B%A2%E5%BC%84%E6%87%82%E5%AD%98%E5%9C%A8%E6%80%A7/:4:0","tags":null,"title":"æ•¸å­¸æ•™ä½ ä¸çŠ¯éŒ¯ ê‰ ä¸‹å†Š, ê‰ æå®šæœŸæœ›å€¼ã€èªæ¸…è¿´æ­¸è¶¨å‹¢ã€å¼„æ‡‚å­˜åœ¨æ€§","uri":"/notes/%E6%95%B8%E5%AD%B8%E6%95%99%E4%BD%A0%E4%B8%8D%E7%8A%AF%E9%8C%AF-%E4%B8%8B%E5%86%8A-%E6%90%9E%E5%AE%9A%E6%9C%9F%E6%9C%9B%E5%80%BC%E8%AA%8D%E6%B8%85%E8%BF%B4%E6%AD%B8%E8%B6%A8%E5%8B%A2%E5%BC%84%E6%87%82%E5%AD%98%E5%9C%A8%E6%80%A7/"},{"categories":null,"content":"ç„¡ç•Œ ","date":"0001-01-01","objectID":"/notes/%E6%95%B8%E5%AD%B8%E6%95%99%E4%BD%A0%E4%B8%8D%E7%8A%AF%E9%8C%AF-%E4%B8%8B%E5%86%8A-%E6%90%9E%E5%AE%9A%E6%9C%9F%E6%9C%9B%E5%80%BC%E8%AA%8D%E6%B8%85%E8%BF%B4%E6%AD%B8%E8%B6%A8%E5%8B%A2%E5%BC%84%E6%87%82%E5%AD%98%E5%9C%A8%E6%80%A7/:5:0","tags":null,"title":"æ•¸å­¸æ•™ä½ ä¸çŠ¯éŒ¯ ê‰ ä¸‹å†Š, ê‰ æå®šæœŸæœ›å€¼ã€èªæ¸…è¿´æ­¸è¶¨å‹¢ã€å¼„æ‡‚å­˜åœ¨æ€§","uri":"/notes/%E6%95%B8%E5%AD%B8%E6%95%99%E4%BD%A0%E4%B8%8D%E7%8A%AF%E9%8C%AF-%E4%B8%8B%E5%86%8A-%E6%90%9E%E5%AE%9A%E6%9C%9F%E6%9C%9B%E5%80%BC%E8%AA%8D%E6%B8%85%E8%BF%B4%E6%AD%B8%E8%B6%A8%E5%8B%A2%E5%BC%84%E6%87%82%E5%AD%98%E5%9C%A8%E6%80%A7/"},{"categories":null,"content":"ğ“€¬ æœ‰è¶£çš„å…§å®¹ \r","date":"0001-01-01","objectID":"/notes/%F0%93%80%AC-%E6%9C%89%E8%B6%A3%E7%9A%84%E5%85%A7%E5%AE%B9/:0:0","tags":null,"title":"ğ“€¬ æœ‰è¶£çš„å…§å®¹","uri":"/notes/%F0%93%80%AC-%E6%9C%89%E8%B6%A3%E7%9A%84%E5%85%A7%E5%AE%B9/"},{"categories":null,"content":"Unicodes \r\rManim \r ","date":"0001-01-01","objectID":"/notes/%F0%93%80%AC-%E6%9C%89%E8%B6%A3%E7%9A%84%E5%85%A7%E5%AE%B9/:1:0","tags":null,"title":"ğ“€¬ æœ‰è¶£çš„å…§å®¹","uri":"/notes/%F0%93%80%AC-%E6%9C%89%E8%B6%A3%E7%9A%84%E5%85%A7%E5%AE%B9/"},{"categories":null,"content":"Web scraping challenge Anueï½œé‰…äº¨ç¶² ","date":"0001-01-01","objectID":"/notes/web-scraping-challenge/:0:0","tags":null,"title":"Web scraping challenge","uri":"/notes/web-scraping-challenge/"},{"categories":null,"content":"gogo google form æ‰¾å‡ºæ¬„è·Ÿåˆ— åˆ—å‡ºæ¯å€‹é¸é …çš„äººæ•¸ ç•«åœ– ","date":"0001-01-01","objectID":"/notes/gogo-google-form/:0:0","tags":null,"title":"gogo google form","uri":"/notes/gogo-google-form/"},{"categories":null,"content":"Freepik from www.flaticon.com åŸºæœ¬\r\r import numpy as np import pandas as pd import matplotlib.pyplot as plt from sqlalchemy import create_engine from datetime import datetime user = 'root' pw = \"YourPassword\" db = \"TWSE\" engine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=db)) Start = '2019/10/20 00:00:00' End = '2021/1/10 23:59:59' SQL = ''' SELECT * FROM `{}` WHERE `æ—¥æœŸ` BETWEEN '{}' AND '{}' ORDER BY `æ—¥æœŸ` ''' df = pd.read_sql(SQL.format('ç™¼è¡Œé‡åŠ æ¬Šè‚¡åƒ¹æŒ‡æ•¸', Start, End), engine, coerce_float=True, parse_dates=True) df = pd.DataFrame(df['æ”¶ç›¤æŒ‡æ•¸']) df['æ”¶ç›¤æŒ‡æ•¸'].hist() df['t-10'] = df.shift(10) df = df.dropna() x = np.array(df['t-10']) y = np.array(df['æ”¶ç›¤æŒ‡æ•¸']) plt.scatter(x,y) def polynominal(x,y,i): results = {} p = Polynomial.fit(x, y,i) pnormal = p.convert(domain=(-1, 1)) SST = sum((y-y.mean())**2) SSR = sum((pnormal(x)-y.mean())**2) R_squared = SSR/SST corr = numpy.corrcoef(x, y)[0,1] results['Function'] = pnormal results['correlation'] = corr results['R_squared'] = R_squared plt.subplot(20,2,i) plt.scatter(x,y) plt.title('Degree {i}\\n$R^2$ = {R_squared}'.format(i=i,R_squared=R_squared)) plt.plot(*p.linspace(),linewidth = 4,c='r') return results fig, ax = plt.subplots(1, 1, figsize=(20, 120)) for i in range(1,21): polynominal(x,y,i) polynominal(x,y,1)['Function'] polynominal(x,y,1)['Function'](16000) $$x \\mapsto \\text{118.88807679810452} + \\text{1.0001305664084157},x$$ \r\r","date":"0001-01-01","objectID":"/notes/regression/:0:0","tags":["n"],"title":"Regression","uri":"/notes/regression/"},{"categories":null,"content":"Freepik from www.flaticon.com SQLé€£ç·š from sqlalchemy import create_engine import pandas as pd import matplotlib.pyplot as plt import numpy as np user = 'root' pw = \"YourPassword\" db = \"TWSE\" engine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=db)) Start = '2020/10/20 00:00:00' End = '2021/1/10 23:59:59' SQL = ''' SELECT * FROM `{}` WHERE `æ—¥æœŸ` BETWEEN '{}' AND '{}' ORDER BY `æ—¥æœŸ` ''' df = pd.read_sql(SQL.format('ç™¼è¡Œé‡åŠ æ¬Šè‚¡åƒ¹æŒ‡æ•¸', Start, End), engine, coerce_float=True, parse_dates=True) df = df['æ”¶ç›¤æŒ‡æ•¸'] Regression ","date":"0001-01-01","objectID":"/notes/linearr/:0:0","tags":["n"],"title":"XXXXXXXXLinear Regression","uri":"/notes/linearr/"},{"categories":null,"content":"numpy ","date":"0001-01-01","objectID":"/notes/linearr/:1:0","tags":["n"],"title":"XXXXXXXXLinear Regression","uri":"/notes/linearr/"},{"categories":null,"content":"Linear Regression Degree 1\r\r x = np.array(df.index) y = np.array(df) plt.plot(x, y,'o') m, b = np.polyfit(x, y, 1) plt.plot(x, m*x + b,linewidth = 4,c='r') \r\r ","date":"0001-01-01","objectID":"/notes/linearr/:1:1","tags":["n"],"title":"XXXXXXXXLinear Regression","uri":"/notes/linearr/"},{"categories":null,"content":"Polynomial regression Degree 4\r\r from numpy.polynomial import Polynomial p = Polynomial.fit(x, y, 4) plt.plot(x, y,'o') plt.plot(*p.linspace(),linewidth = 4,c='r') pnormal = p.convert(domain=(-1, 1)) pnormal $x \\mapsto \\text{13016.758838492064} - \\text{112.73756922573969}\\,x + \\text{12.521875114529937}\\,x^{2} - \\text{0.3460298242233912}\\,x^{3} + \\text{0.003055214499407899}\\,x^{4}$ def regression(i): plt.subplot(20,2,i) p = Polynomial.fit(x, y, i) plt.plot(x, y,'o') plt.title(' \\n\\nPolynomial.fit()\\nDegree {}'.format(i)) plot = plt.plot(*p.linspace(),linewidth = 4,c='r') plt.savefig('Degree {}.jpg'.format(i)) return plot plt.subplots(1, 1, figsize=(20, 120)) n = 19 for i in range(1,n): regression(i) \r\r åƒè€ƒè³‡æ–™\r\rfitting data with numpy\r\r ","date":"0001-01-01","objectID":"/notes/linearr/:1:2","tags":["n"],"title":"XXXXXXXXLinear Regression","uri":"/notes/linearr/"},{"categories":null,"content":"sklearn ","date":"0001-01-01","objectID":"/notes/linearr/:2:0","tags":["n"],"title":"XXXXXXXXLinear Regression","uri":"/notes/linearr/"},{"categories":null,"content":"LinearRegression().fit() Degree 1\r\r import numpy as np import pandas as pd import matplotlib.pyplot as plt from sklearn.linear_model import LinearRegression x = np.array(df.index).reshape(-1, 1) y = np.array(df) model = LinearRegression().fit(x, y) b, m = model.intercept_, model.coef_ r_sq = model.score(x, y) plt.plot(x,y, 'o') plt.plot(x,m*x+b,linewidth = 4,c='r') \r\r ","date":"0001-01-01","objectID":"/notes/linearr/:2:1","tags":["n"],"title":"XXXXXXXXLinear Regression","uri":"/notes/linearr/"},{"categories":null,"content":"PolynomialFeatures() Degree 4\r\r from sklearn.linear_model import Ridge from sklearn.preprocessing import PolynomialFeatures from sklearn.pipeline import make_pipeline x = np.array(df.index).reshape(-1, 1) y = np.array(df) X_seq = np.linspace(x.min(),x.max(),1000).reshape(-1,1) polyreg=make_pipeline(PolynomialFeatures(4),LinearRegression()) polyreg.fit(x,y) plt.plot(x,y, 'o') plt.plot(X_seq,polyreg.predict(X_seq),linewidth = 4,color=\"r\") def polynomial_plot(degree): plt.subplot(20,2,degree) polyreg=make_pipeline(PolynomialFeatures(degree),LinearRegression()) polyreg.fit(x,y) plt.plot(x,y, 'o') plt.title(\"Polyfit degree {}\".format(degree)) plot = plt.plot(X_seq,polyreg.predict(X_seq),linewidth = 4,color=\"r\") return plot plt.subplots(1, 1, figsize=(20, 120)) for degree in range(1,19): polynomial_plot(degree) \r\r åƒè€ƒè³‡æ–™\r\rLinear Regression in Python How to plot a linear regression line on a scatter plot in Python æœºå™¨å­¦ä¹ å¸¸ç”¨ç®—æ³•â€”â€”çº¿æ€§å›å½’ Volume-Supported Linear Regression Trend å­¸æœƒç”¨æ©Ÿå™¨å­¸ç¿’é æ¸¬è‚¡åƒ¹ â€” å®Œæ•´æµç¨‹æ•™å­¸èˆ‡å¯¦ä½œ Polynomial regression Polynomial Regression with Scikit learn: What You Should Know \r\r","date":"0001-01-01","objectID":"/notes/linearr/:2:2","tags":["n"],"title":"XXXXXXXXLinear Regression","uri":"/notes/linearr/"},{"categories":null,"content":"Freepik from www.flaticon.com Problem solving\r\rasyncio.run () can not be called from a running event loop problem solving\r\r","date":"0001-01-01","objectID":"/notes/async/:0:0","tags":["n"],"title":"Async","uri":"/notes/async/"},{"categories":["Python"],"content":"Freepik from www.flaticon.com ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:0:0","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"Installation of geopandas ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:1:0","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"Unofficial Windows Binaries for Python Extension Packages ä¸‹è¼‰5å€‹whlæª”\r\r GDAL pyproj Fiona Shapely geopandas æ³¨æ„\r\r ä¾ç…§Pythonç‰ˆæœ¬ä¸‹è¼‰ç›¸å°æ‡‰ç‰ˆæœ¬ æŒ‰ç…§ä¸Šé¢çš„é †åºï¼Œä¾æ¬¡åŸ·è¡Œä¸‹ä»¤ç¨‹å¼ç¢¼(Anaconda Prompt ) pip install GDAL-3.2.3-cp37-cp37m-win32.whl pip install pyproj-3.0.1-cp37-cp37m-win32.whl pip install Fiona-1.8.19-cp37-cp37m-win32.whl pip install Shapely-1.7.1-cp37-cp37m-win32.whl pip install geopandas-0.9.0-py3-none-any.whl \r\r \r\r ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:1:1","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"ç¸£å¸‚ç•Œç·šè³‡æ–™ ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:2:0","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"ä¸‹è¼‰SHP ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:2:1","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"è§£å£“ç¸®5å€‹æª”æ¡ˆ #ç¸£å¸‚ç•Œç·šè³‡æ–™---------------------------------------------------------------------------------------------- import geopandas as gpd C_shp = gpd.read_file(r'COUNTY_MOI_1090820.shp') C_shp.set_index('COUNTYNAME', inplace = True) ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:2:2","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"é„‰é®ç•Œç·šè³‡æ–™ ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:3:0","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"ä¸‹è¼‰SHP ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:3:1","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"è§£å£“ç¸®æª”æ¡ˆ Danger\r\r ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:3:2","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"ç¼ºå°‘CPGæª”æœƒé€ æˆäº‚ç¢¼ ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:4:0","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"5å€‹æª”æ¡ˆæª”åéƒ½è¦ä¸€æ¨£ \r\r #é„‰é®ç•Œç·šè³‡æ–™---------------------------------------------------------------------------------------------- import geopandas as gpd t_shp = gpd.read_file(r'TOWN_MOI_1100415.shp') t_shp.set_index('TOWNNAME', inplace = True) ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:5:0","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"Basic ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:6:0","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"Figure #ç¸£å¸‚ç•Œç·šè³‡æ–™---------------------------------------------------------------------------------------------- import geopandas as gpd C_shp = gpd.read_file(r'COUNTY_MOI_1090820.shp') C_shp.set_index('COUNTYNAME', inplace = True) #ç•«åœ–---------------------------------------------------------------------------------------------------- import matplotlib.pyplot as plt C_shp.plot(figsize=(20,20),cmap = 'Wistia') plt.tight_layout() plt.savefig('Taiwan_County.png') å…¶ä»–é¡è‰²\r\rcmap\r\r ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:6:1","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"Covid-19 Heatmap ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:7:0","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"Covid-19 Taiwan Open Data def get_covid19_data(): import urllib.request, json import pandas as pd import datetime url = 'https://od.cdc.gov.tw/eic/Day_Confirmation_Age_County_Gender_19CoV.json' with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) df = pd.DataFrame(data) df['ç¢ºå®šç—…ä¾‹æ•¸'] = df['ç¢ºå®šç—…ä¾‹æ•¸'].apply(lambda x:int(x)) df['å€‹æ¡ˆç ”åˆ¤æ—¥'] = [datetime.datetime.strptime(d, \"%Y%m%d\") for d in df['å€‹æ¡ˆç ”åˆ¤æ—¥']] return df Covid-19 Taiwan Open Data\r\råœ°å€å¹´é½¡æ€§åˆ¥çµ±è¨ˆè¡¨-åš´é‡ç‰¹æ®Šå‚³æŸ“æ€§è‚ºç‚-ä¾å€‹æ¡ˆç ”åˆ¤æ—¥çµ±è¨ˆ\r\r ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:7:1","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"Figure 1 å®Œæ•´ç¨‹å¼ç¢¼ #Covid-19 Data------------------------------------------------------------------------------------------- def get_covid19_data(): import urllib.request, json import pandas as pd import datetime url = 'https://od.cdc.gov.tw/eic/Day_Confirmation_Age_County_Gender_19CoV.json' with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) df = pd.DataFrame(data) df['ç¢ºå®šç—…ä¾‹æ•¸'] = df['ç¢ºå®šç—…ä¾‹æ•¸'].apply(lambda x:int(x)) df['å€‹æ¡ˆç ”åˆ¤æ—¥'] = [datetime.datetime.strptime(d, \"%Y%m%d\") for d in df['å€‹æ¡ˆç ”åˆ¤æ—¥']] return df #ç•«åœ–\u0026è£åˆ‡------------------------------------------------------------------------------------------------ def plot(data, plot_type, column, cmap, file_name): h = 100 w = 100 if plot_type == 'normal': data.plot(figsize=(w,h),cmap = cmap ) elif plot_type == 'heatmap': data.plot(figsize=(w,h),column = column, cmap = cmap) plt.savefig(f\"Plot_{file_name}.png\", bbox_inches='tight') return f\"Plot_{file_name}.png\" def crop(file_name): import cv2 image = cv2.imread(file_name) #è£åˆ‡ç¯„åœ crop_image = image[300:1700, 1300:2500, :] cv2.imshow(\"Cropped\", crop_image) cv2.imwrite(file_name,crop_image) cv2.destroyAllWindows() from IPython.display import display, Image display(Image(filename=file_name)) #ç¸£å¸‚ç•Œç·šè³‡æ–™---------------------------------------------------------------------------------------------- import geopandas as gpd C_shp = gpd.read_file(r'COUNTY_MOI_1090820.shp') C_shp.set_index('COUNTYNAME', inplace = True) import matplotlib.pyplot as plt plt.ioff() #åœ°å€å¹´é½¡æ€§åˆ¥çµ±è¨ˆè¡¨-åš´é‡ç‰¹æ®Šå‚³æŸ“æ€§è‚ºç‚-ä¾å€‹æ¡ˆç ”åˆ¤æ—¥çµ±è¨ˆ---------------------------------------------------------- df_GroupByCounty = get_covid19_data().groupby('ç¸£å¸‚').sum() df_GroupByCounty.drop('ç©ºå€¼',inplace = True) df_GroupByCounty.rename(index={'å°ä¸­å¸‚': 'è‡ºä¸­å¸‚', 'å°åŒ—å¸‚': 'è‡ºåŒ—å¸‚', 'å°å—å¸‚': 'è‡ºå—å¸‚'}, inplace=True) ##Mergeè³‡æ–™è¡¨--------------------------------------------------------------------------------------------- C_shp['CName'] = C_shp.index df_GroupByCounty['cname'] = df_GroupByCounty.index import numpy as np C_result = C_shp.merge(df_GroupByCounty, left_on=('CName'), right_on=('cname'), how='left') C_result['color'] = np.log(C_result['ç¢ºå®šç—…ä¾‹æ•¸']) C_result['ç¢ºå®šç—…ä¾‹æ•¸'] = C_result['ç¢ºå®šç—…ä¾‹æ•¸'].fillna(0) C_result['color'] = C_result['color'].fillna(0) #ç•«åœ–---------------------------------------------------------------------------------------------------- p2 = plot(data=C_result, plot_type='heatmap', column='color', cmap='Reds', file_name='Heatmap_Taiwan_COUNTY') crop(p2) ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:7:2","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"Figure 2 å®Œæ•´ç¨‹å¼ç¢¼ #Covid-19 Data------------------------------------------------------------------------------------------- def get_covid19_data(): import urllib.request, json import pandas as pd import datetime url = 'https://od.cdc.gov.tw/eic/Day_Confirmation_Age_County_Gender_19CoV.json' with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) df = pd.DataFrame(data) df['ç¢ºå®šç—…ä¾‹æ•¸'] = df['ç¢ºå®šç—…ä¾‹æ•¸'].apply(lambda x:int(x)) df['å€‹æ¡ˆç ”åˆ¤æ—¥'] = [datetime.datetime.strptime(d, \"%Y%m%d\") for d in df['å€‹æ¡ˆç ”åˆ¤æ—¥']] return df #ç¸£å¸‚ç•Œç·šè³‡æ–™---------------------------------------------------------------------------------------------- import geopandas as gpd C_shp = gpd.read_file(r'COUNTY_MOI_1090820.shp') C_shp.set_index('COUNTYNAME', inplace = True) import matplotlib.pyplot as plt plt.ioff() #åœ°å€å¹´é½¡æ€§åˆ¥çµ±è¨ˆè¡¨-åš´é‡ç‰¹æ®Šå‚³æŸ“æ€§è‚ºç‚-ä¾å€‹æ¡ˆç ”åˆ¤æ—¥çµ±è¨ˆ---------------------------------------------------------- df_GroupByCounty = get_covid19_data().groupby('ç¸£å¸‚').sum() df_GroupByCounty.drop('ç©ºå€¼',inplace = True) df_GroupByCounty.rename(index={'å°ä¸­å¸‚': 'è‡ºä¸­å¸‚', 'å°åŒ—å¸‚': 'è‡ºåŒ—å¸‚', 'å°å—å¸‚': 'è‡ºå—å¸‚'}, inplace=True) ##Mergeè³‡æ–™è¡¨--------------------------------------------------------------------------------------------- C_shp['CName'] = C_shp.index df_GroupByCounty['cname'] = df_GroupByCounty.index import numpy as np C_result = C_shp.merge(df_GroupByCounty, left_on=('CName'), right_on=('cname'), how='left') C_result['color'] = np.log(C_result['ç¢ºå®šç—…ä¾‹æ•¸']) C_result['ç¢ºå®šç—…ä¾‹æ•¸'] = C_result['ç¢ºå®šç—…ä¾‹æ•¸'].fillna(0) C_result['color'] = C_result['color'].fillna(0) #ç•«åœ–---------------------------------------------------------------------------------------------------- import plotly.express as px import numpy as np C_result.index = C_result['CName'] fig = px.choropleth_mapbox(C_result, geojson=C_result['geometry'], locations=C_result.CName, color_continuous_scale=\"Reds\", color=C_result['color'], hover_name='CName', hover_data = {'color':False, 'CName':False, 'ç¢ºå®šç—…ä¾‹æ•¸':True}, center={\"lat\": 23.5, \"lon\": 121}, mapbox_style=\"open-street-map\", zoom=5.5, title = 'Covid-19 Taiwan') fig.write_html(\"Python [1] Covid-19 + geopandas-2021-06-07-COUNTY.html\") fig.show() ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:7:3","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"Figure 3 å®Œæ•´ç¨‹å¼ç¢¼ #Covid-19 Data------------------------------------------------------------------------------------------- def get_covid19_data(): import urllib.request, json import pandas as pd import datetime url = 'https://od.cdc.gov.tw/eic/Day_Confirmation_Age_County_Gender_19CoV.json' with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) df = pd.DataFrame(data) df['ç¢ºå®šç—…ä¾‹æ•¸'] = df['ç¢ºå®šç—…ä¾‹æ•¸'].apply(lambda x:int(x)) df['å€‹æ¡ˆç ”åˆ¤æ—¥'] = [datetime.datetime.strptime(d, \"%Y%m%d\") for d in df['å€‹æ¡ˆç ”åˆ¤æ—¥']] return df #ç•«åœ–\u0026è£åˆ‡------------------------------------------------------------------------------------------------ def plot(data, plot_type, column, cmap, file_name): h = 100 w = 100 if plot_type == 'normal': data.plot(figsize=(w,h),cmap = cmap ) elif plot_type == 'heatmap': data.plot(figsize=(w,h),column = column, cmap = cmap) plt.savefig(f\"Plot_{file_name}.png\", bbox_inches='tight') return f\"Plot_{file_name}.png\" def crop(file_name): import cv2 image = cv2.imread(file_name) #è£åˆ‡ç¯„åœ crop_image = image[300:1700, 1300:2500, :] cv2.imshow(\"Cropped\", crop_image) cv2.imwrite(file_name,crop_image) cv2.destroyAllWindows() from IPython.display import display, Image display(Image(filename=file_name)) #é„‰é®ç•Œç·šè³‡æ–™---------------------------------------------------------------------------------------------- import geopandas as gpd t_shp = gpd.read_file(r'TOWN_MOI_1100415.shp') t_shp.set_index('TOWNNAME', inplace = True) import matplotlib.pyplot as plt plt.ioff() #åœ°å€å¹´é½¡æ€§åˆ¥çµ±è¨ˆè¡¨-åš´é‡ç‰¹æ®Šå‚³æŸ“æ€§è‚ºç‚-ä¾å€‹æ¡ˆç ”åˆ¤æ—¥çµ±è¨ˆ---------------------------------------------------------- df_GroupByTOWN = get_covid19_data().groupby('é„‰é®').sum() df_GroupByTOWN.drop('ç©ºå€¼',inplace = True) ##Mergeè³‡æ–™è¡¨--------------------------------------------------------------------------------------------- t_shp['TName'] = t_shp.index df_GroupByTOWN['tname'] = df_GroupByTOWN.index import numpy as np t_result = t_shp.merge(df_GroupByTOWN, left_on=('TName'), right_on=('tname'), how='left') t_result['color'] = np.log(t_result['ç¢ºå®šç—…ä¾‹æ•¸']) t_result['color'] = t_result['color'].fillna(0) t_result['ç¢ºå®šç—…ä¾‹æ•¸'] = t_result['ç¢ºå®šç—…ä¾‹æ•¸'].fillna(0) #ç•«åœ–---------------------------------------------------------------------------------------------------- p3 = plot(data=t_result, plot_type='heatmap', column='color', cmap='Reds', file_name='Heatmap_Taiwan_TOWN') crop(p3) ","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:7:4","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["Python"],"content":"Figure 4 å®Œæ•´ç¨‹å¼ç¢¼ #Covid-19 Data------------------------------------------------------------------------------------------- def get_covid19_data(): import urllib.request, json import pandas as pd import datetime url = 'https://od.cdc.gov.tw/eic/Day_Confirmation_Age_County_Gender_19CoV.json' with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) df = pd.DataFrame(data) df['ç¢ºå®šç—…ä¾‹æ•¸'] = df['ç¢ºå®šç—…ä¾‹æ•¸'].apply(lambda x:int(x)) df['å€‹æ¡ˆç ”åˆ¤æ—¥'] = [datetime.datetime.strptime(d, \"%Y%m%d\") for d in df['å€‹æ¡ˆç ”åˆ¤æ—¥']] return df #é„‰é®ç•Œç·šè³‡æ–™---------------------------------------------------------------------------------------------- import geopandas as gpd t_shp = gpd.read_file(r'TOWN_MOI_1100415.shp') t_shp.set_index('TOWNNAME', inplace = True) import matplotlib.pyplot as plt plt.ioff() #åœ°å€å¹´é½¡æ€§åˆ¥çµ±è¨ˆè¡¨-åš´é‡ç‰¹æ®Šå‚³æŸ“æ€§è‚ºç‚-ä¾å€‹æ¡ˆç ”åˆ¤æ—¥çµ±è¨ˆ---------------------------------------------------------- df_GroupByTOWN = get_covid19_data().groupby('é„‰é®').sum() df_GroupByTOWN.drop('ç©ºå€¼',inplace = True) ##Mergeè³‡æ–™è¡¨--------------------------------------------------------------------------------------------- t_shp['TName'] = t_shp.index df_GroupByTOWN['tname'] = df_GroupByTOWN.index import numpy as np t_result = t_shp.merge(df_GroupByTOWN, left_on=('TName'), right_on=('tname'), how='left') t_result['color'] = np.log(t_result['ç¢ºå®šç—…ä¾‹æ•¸']) t_result['color'] = t_result['color'].fillna(0) t_result['ç¢ºå®šç—…ä¾‹æ•¸'] = t_result['ç¢ºå®šç—…ä¾‹æ•¸'].fillna(0) #ç•«åœ–---------------------------------------------------------------------------------------------------- import plotly.express as px import numpy as np t_result['Name'] = t_result['COUNTYNAME']+' '+t_result['TName'] t_result.index = t_result['Name'] fig = px.choropleth_mapbox(t_result, geojson=t_result['geometry'], locations=t_result.Name, color_continuous_scale=\"Reds\", color=t_result['color'], hover_name='Name', hover_data = {'color':False, 'Name':False, 'ç¢ºå®šç—…ä¾‹æ•¸':True}, center={\"lat\": 23.5, \"lon\": 121}, mapbox_style=\"open-street-map\", zoom=5.5, title = 'Covid-19 Taiwan') fig.write_html(\"Python [1] Covid-19 + geopandas-2021-06-07-TOWN.html\") choropleth_mapbox\r\r plotly.express.choropleth_mapbox Built-in Continuous Color Scales in Python \r\r åƒè€ƒè³‡æ–™\r\rç›´è½„å¸‚ã€ç¸£å¸‚ç•Œç·š(TWD97ç¶“ç·¯åº¦) é„‰é®å¸‚å€ç•Œç·š(TWD97ç¶“ç·¯åº¦) Three Ways to Plot Choropleth Map Using Python Download GADM data (version 3.6) Python ç·´ç¿’: ä»¥åœ°åœ–é¡¯ç¤ºç™Œç—‡æ­»å› è³‡æ–™(II) Python åœ°åœ–è¦–è¦ºåŒ– - ä½¿ç”¨ Folium install geopandas Pandas Merging 101https://blog.csdn.net/Summer_Horse/article/details/113488809) \r\r","date":"2021-05-23","objectID":"/python-1-covid-19-geopandas/:7:5","tags":["geopandas"],"title":"Python [1]  Covid-19  + geopandas","uri":"/python-1-covid-19-geopandas/"},{"categories":["NOTE","Python"],"content":"Freepik from www.flaticon.com å ±é…¬ç‡ ","date":"2021-02-03","objectID":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/:0:0","tags":["Quantitative Investing ","å°æ•¸å ±é…¬ç‡","Log Return"],"title":"NOTE [1] å°æ•¸å ±é…¬ç‡","uri":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/"},{"categories":["NOTE","Python"],"content":"ç®—æ•¸å¹³å‡å ±é…¬ç‡ Arithmetic mean ","date":"2021-02-03","objectID":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/:1:0","tags":["Quantitative Investing ","å°æ•¸å ±é…¬ç‡","Log Return"],"title":"NOTE [1] å°æ•¸å ±é…¬ç‡","uri":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/"},{"categories":["NOTE","Python"],"content":"å¹¾ä½•å¹³å‡å ±é…¬ç‡ Geometric mean ç¼ºé»\r\ræ•¸åˆ—ä¸­ä»»ä½•ä¸€å€‹è®Šæ•¸å€¼ä¸èƒ½ç‚º0ï¼Œä¸€å€‹ç‚º0ï¼Œå‰‡å¹¾ä½•å¹³å‡æ•¸ç‚º0\r\r ","date":"2021-02-03","objectID":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/:2:0","tags":["Quantitative Investing ","å°æ•¸å ±é…¬ç‡","Log Return"],"title":"NOTE [1] å°æ•¸å ±é…¬ç‡","uri":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/"},{"categories":["NOTE","Python"],"content":"å°æ•¸å ±é…¬ç‡ Logarithmic Rates of Return Understanding Log Return and Continuous Compounding\r\rLog Return is one of three methods for calculating return and it assumes returns are compounded continuously rather than across sub-periods.\r\r å„ªé»\r\rç°¡åŒ–è¨ˆç®—\r\r å°æ•¸å ±é…¬ç‡ ","date":"2021-02-03","objectID":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/:3:0","tags":["Quantitative Investing ","å°æ•¸å ±é…¬ç‡","Log Return"],"title":"NOTE [1] å°æ•¸å ±é…¬ç‡","uri":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/"},{"categories":["NOTE","Python"],"content":"Python å°æ•¸å ±é…¬ç‡å¯«æ³• ","date":"2021-02-03","objectID":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/:4:0","tags":["Quantitative Investing ","å°æ•¸å ±é…¬ç‡","Log Return"],"title":"NOTE [1] å°æ•¸å ±é…¬ç‡","uri":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/"},{"categories":["NOTE","Python"],"content":"æ–¹æ³•ä¸€ np.exp(np.log(df['Adj Close']).diff(1))-1 ","date":"2021-02-03","objectID":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/:4:1","tags":["Quantitative Investing ","å°æ•¸å ±é…¬ç‡","Log Return"],"title":"NOTE [1] å°æ•¸å ±é…¬ç‡","uri":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/"},{"categories":["NOTE","Python"],"content":"æ–¹æ³•äºŒ np.exp(np.log(df['Adj Close']/df['Adj Close'].shift(1)))-1 ç‚ºä»€éº¼è¦ç”¨å°æ•¸å ±é…¬ç‡ï¼Ÿ\r\rå°æ•¸å ±é…¬ç‡æœ‰æ™‚é–“çš„ç´¯åŠ æ€§ ç°¡åŒ–è¨ˆç®—éç¨‹ \r\r ","date":"2021-02-03","objectID":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/:4:2","tags":["Quantitative Investing ","å°æ•¸å ±é…¬ç‡","Log Return"],"title":"NOTE [1] å°æ•¸å ±é…¬ç‡","uri":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/"},{"categories":["NOTE","Python"],"content":"PART 1 è§£é‡‹ /Daily/ PART 1\r\rSTEP 1 $\\frac{P_{t}-P_{t-1}}{P_{t-1}} = \\frac{P_{t}}{P_{t-1}} - 1 = r$ STEP 2 ç§»å‘ $1+r = \\frac{P_{t}}{P_{t-1}}$ STEP 3 å–å°æ•¸ $ln(1+r) = ln(\\frac{P_{t}}{P_{t-1}}) = ln(P_{t}) - ln(P_{t-1})$ $Y=ln(1+r)$\r\r ","date":"2021-02-03","objectID":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/:5:0","tags":["Quantitative Investing ","å°æ•¸å ±é…¬ç‡","Log Return"],"title":"NOTE [1] å°æ•¸å ±é…¬ç‡","uri":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/"},{"categories":["NOTE","Python"],"content":"PART 2 è§£é‡‹ /Period/ PART 2\r\rSTEP 1 $r_{T} = \\frac{P_{T} - P_{0}}{P_{0}} = \\frac{P_{T}}{P_{0}} - 1$ STEP 2 ç§»å‘ $1+r_{T} = \\frac{P_{T}}{P_{0}}$ STEP 3 å–å°æ•¸\u0026æ‹†è§£ $ln(\\frac{P_T}{P_0})=ln(\\frac{P_T}{P_{T-1}})+ln(\\frac{P_{T-1}}{P_{T-2}})+â€¦+ln(\\frac{P_1}{P_0})$ STEP 4 $e^{ln(\\frac{P_T}{P_0})} = \\frac{P_T}{P_0}$ $r_{T} = e^{ln(\\frac{P_T}{P_0})} -1 = \\frac{P_T}{P_0} -1$\r\r import numpy as np import pandas as pd import pandas_datareader.data as web df = web.DataReader('2330.tw', 'yahoo', '2020-05-01') different = pd.DataFrame() different['pct_cahnge()'] = df['Adj Close'].pct_change() different['np.log().diff(1)'] = np.exp(np.log(df['Adj Close']).diff(1))-1 different P_cumsum = pd.DataFrame() P_cumsum['pct_cahnge()'] = np.cumsum(df['Adj Close'].pct_change()) P_cumsum['np.log().diff(1)'] = np.exp(np.cumsum(np.log(df['Adj Close']).diff(1)))-1 P_cumsum tick_size = 20 legend_fontsize = 15 linewidth = 4 fig = plt.figure(figsize = (20,8)) ax = fig.add_subplot() ax1 = ax.plot(P_cumsum['pct_cahnge()'],linewidth=linewidth) ax2 = ax.plot(P_cumsum['np.log().diff(1)'],linewidth=linewidth) ax.tick_params(labelsize=tick_size) ax.legend(['pct_cahnge()','np.log().diff(1)'],loc='upper left',fontsize=legend_fontsize, frameon=False) åƒè€ƒè³‡æ–™\r\r[é‡åŒ–æŠ•è³‡åŸºæœ¬åŠŸ]ç‚ºä»€éº¼å°æ•¸æ”¶ç›Šç‡åœ¨é‡åŒ–æŠ•è³‡é€™éº¼é‡è¦? log return èˆ‡ç´¯ç©å ±é…¬ç‡ [Youtube]é‡åŒ–æŠ•è³‡åŸºæœ¬åŠŸâ€”ç‚ºä»€éº¼å°æ•¸æ”¶ç›Šç‡åœ¨é‡åŒ–æŠ•è³‡é€™éº¼é‡è¦? log return èˆ‡ç´¯ç©å ±é…¬ç‡ é—œæ–¼å¹¾ä½•å ±é…¬ç‡èˆ‡ç®—è¡“å ±é…¬ç‡çš„åˆ†äº«â€“TOMé›œå¯« [Day28]æŠ•è³‡çµ„åˆçš„é¢¨éšªè©•ä¼° - å°æ•¸æ”¶ç›Šç‡ Re: [å•é¡Œ] å–log=æˆé•·ç‡ [ROI] è¨è«–å ±é…¬ç‡çš„è¨ˆç®—å…¬å¼èˆ‡å ±é…¬ç‡ç†è§£è§€å¿µ Understanding Log Return and Continuous Compounding Python : easy way to do geometric mean in python? çµ±è¨ˆï¼šä¸€å€‹ç°¡å–®çš„å¹¾ä½•å¹³å‡æ•¸çš„é‹ç®—ç¯„ä¾‹ å¹¾ä½•å¹³å‡æ•¸ \r\r","date":"2021-02-03","objectID":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/:6:0","tags":["Quantitative Investing ","å°æ•¸å ±é…¬ç‡","Log Return"],"title":"NOTE [1] å°æ•¸å ±é…¬ç‡","uri":"/note-1-%E5%B0%8D%E6%95%B8%E5%A0%B1%E9%85%AC%E7%8E%87/"},{"categories":["Python","TWSE"],"content":"Freepik from www.flaticon.com Selenium + é‰…äº¨ç¶² + MonogoDB åƒè€ƒè³‡æ–™\r\ré«˜çº§çˆ¬è™«: è®© Selenium æ§åˆ¶ä½ çš„æµè§ˆå™¨å¸®ä½ çˆ¬ åœ¨Windowsä¸Šå®‰è£Python \u0026 Selenium + ç°¡æ˜“æ•™å­¸ \r\r Selenium Record and Playback tool\r\rSelenium IDE Selenium Record and Playback tool for ease of getting acquainted with Selenium WebDriver.\r\r ","date":"2021-02-01","objectID":"/twse-13-selenium-%E9%89%85%E4%BA%A8%E7%B6%B2/:0:0","tags":["Selenium","bs4","urllib","MongoDB"],"title":"TWSE [13] Selenium + é‰…äº¨ç¶²","uri":"/twse-13-selenium-%E9%89%85%E4%BA%A8%E7%B6%B2/"},{"categories":["Python","TWSE"],"content":"ChromeDriver - WebDriver for Chrome import selenium selenium.__version__ ","date":"2021-02-01","objectID":"/twse-13-selenium-%E9%89%85%E4%BA%A8%E7%B6%B2/:1:0","tags":["Selenium","bs4","urllib","MongoDB"],"title":"TWSE [13] Selenium + é‰…äº¨ç¶²","uri":"/twse-13-selenium-%E9%89%85%E4%BA%A8%E7%B6%B2/"},{"categories":["Python","TWSE"],"content":"é–‹å•ŸGoogleé¦–é  from selenium import webdriver browser = webdriver.Chrome() browser.get('http://google.com/') ","date":"2021-02-01","objectID":"/twse-13-selenium-%E9%89%85%E4%BA%A8%E7%B6%B2/:1:1","tags":["Selenium","bs4","urllib","MongoDB"],"title":"TWSE [13] Selenium + é‰…äº¨ç¶²","uri":"/twse-13-selenium-%E9%89%85%E4%BA%A8%E7%B6%B2/"},{"categories":["Python","TWSE"],"content":"é–‹å•Ÿé‰…äº¨ç¶²å°è‚¡æ–°è browser = webdriver.Chrome() driver.get(\"https://news.cnyes.com/news/cat/tw_stock_news?exp=a\") document.body.scrollHeight åƒè€ƒè³‡æ–™\r\rHow can I scroll a web page using selenium webdriver in python? [çˆ¬èŸ²å¯¦æˆ°] å¦‚ä½•é€éSelenium è‡ªå‹•å°‡é é¢æ²å‹•è‡³æœ€ä¸‹æ–¹æŠ“å–è³‡æ–™? ç”¨pythonå¯¦ç¾selenium è‡ªå‹•åŒ–æ¸¬è©¦ \r\r driver.execute_script(\"window.scrollTo(0, document.body.scrollHeight);\") print(driver.execute_script(\"return document.body.scrollHeight\")) pause_time = 10 for i in range(10): driver.execute_script(\"window.scrollTo(0, document.body.scrollHeight);\") time.sleep(pause_time) ChromeOptions() åƒè€ƒè³‡æ–™\r\rPython selenium.webdriver.ChromeOptions() Examples Python selenium.webdriver æ¨¡å—ï¼ŒChromeOptions() å®ä¾‹æºç  Python webdriver.ChromeOptionsæ–¹æ³•ä»£ç¢¼ç¤ºä¾‹ \r\r start = time.time() driver = webdriver.Chrome() driver.get(\"https://news.cnyes.com/news/cat/tw_stock_news?exp=a\") for i in range(2): driver.execute_script(\"window.scrollTo(0, document.body.scrollHeight);\") time.sleep(pause_time) driver.close() end = time.time() print(end - start) start = time.time() options = webdriver.ChromeOptions() options.add_experimental_option(\"prefs\", {'ignore_image': 2}) options.add_argument('--headless') options.add_argument('--disable-gpu') driver = webdriver.Chrome(chrome_options=options) driver.get(\"https://news.cnyes.com/news/cat/tw_stock_news?exp=a\") for i in range(2): driver.execute_script(\"window.scrollTo(0, document.body.scrollHeight);\") time.sleep(pause_time) driver.close() end = time.time() print(end - start) åŸ·è¡Œæ™‚é–“æ¯”è¼ƒ\r\r\r\r ","date":"2021-02-01","objectID":"/twse-13-selenium-%E9%89%85%E4%BA%A8%E7%B6%B2/:1:2","tags":["Selenium","bs4","urllib","MongoDB"],"title":"TWSE [13] Selenium + é‰…äº¨ç¶²","uri":"/twse-13-selenium-%E9%89%85%E4%BA%A8%E7%B6%B2/"},{"categories":["Python","TWSE"],"content":"Bs4 options = webdriver.ChromeOptions() options.add_experimental_option(\"prefs\", {'ignore_image': 2}) options.add_argument('--headless') options.add_argument('--disable-gpu') driver = webdriver.Chrome(chrome_options=options) driver.get(\"https://news.cnyes.com/news/cat/tw_stock_news?exp=a\") for i in range(2): driver.execute_script(\"window.scrollTo(0, document.body.scrollHeight);\") time.sleep(pause_time) soup = BeautifulSoup(driver.page_source, 'html.parser') driver.close() MongoDB æŠ“å‡ºå·²å­˜æª”çš„past_post_ids myclient = pymongo.MongoClient(\"mongodb://localhost:27017/\") mydb = myclient[\"article\"] mycol = mydb[\"2021_é‰…äº¨ç¶²\"] past_post_ids = [] end = datetime.datetime.now() start = end - datetime.timedelta(days = 3) for x in mycol.find({'Date': {\"$gte\": start,\"$lte\": end}}): past_post_ids.append(x[\"post_id\"]) å¾ç¶²ç«™ä¸ŠæŠ“ä¸‹ä¾†çš„post_ids hrefs = soup.find_all('a') post_ids = [] import regex as re for href in hrefs: if re.match('/news/id/', str(href.get('href'))): post_id = str(href.get('href')).split('/')[-1].split('?')[0] post_ids.append(post_id) past_post_ids\u0026post_idså·®é›† A = ['A','B','C','D'] B = ['B','F'] C = [] for x in B: if x in A: None else: C.append(x) C new_post_ids = [] for _id in post_ids: if _id in past_post_ids: None else: new_post_ids.append(_id) print(len(past_post_ids)) print(len(post_ids)) print(len(new_post_ids)) åœ–ç‰‡è§£èªª\r\rSet (mathematics)\r\r å­˜æˆurls urls = ['https://news.cnyes.com/news/id/{}?exp=a'.format(e) for e in new_post_ids] def get_text(i): post_id = urls[i].split('/')[5].split('?')[0] data = urllib.request.urlopen(urls[i]) soup = BeautifulSoup(data, 'html.parser') P = soup.find_all('p') text = '' for i,p in zip(range(0,len(P)),P): if i \u003e=4: text = text + p.getText() i += 1 tags = soup.find_all('a') n_tags = [] for tag in tags: if re.match('/tag/', str(tag.get('href'))): n_tags.append(str(tag.get('href'))[5:len(str(tag.get('href')))]) title = soup.find('h1').getText() T = soup.find('time') Date = datetime.datetime.strptime(T['datetime'], \"%Y-%m-%dT%H:%M:%S+08:00\") return(Date,post_id,title,n_tags,text) for i in range(0,len(urls)): print(get_text(i)) ","date":"2021-02-01","objectID":"/twse-13-selenium-%E9%89%85%E4%BA%A8%E7%B6%B2/:1:3","tags":["Selenium","bs4","urllib","MongoDB"],"title":"TWSE [13] Selenium + é‰…äº¨ç¶²","uri":"/twse-13-selenium-%E9%89%85%E4%BA%A8%E7%B6%B2/"},{"categories":["Python","TWSE"],"content":"å®Œæ•´ç¨‹å¼ç¢¼ import pymongo import urllib from bs4 import BeautifulSoup from selenium import webdriver from selenium.webdriver.chrome.options import Options import regex as re import datetime import time pause_time = 10 options = webdriver.ChromeOptions() options.add_experimental_option(\"prefs\", {'ignore_image': 2}) options.add_argument('--headless') options.add_argument('--disable-gpu') driver = webdriver.Chrome(chrome_options=options) driver.get(\"https://news.cnyes.com/news/cat/tw_stock_news?exp=a\") for i in range(2): driver.execute_script(\"window.scrollTo(0, document.body.scrollHeight);\") time.sleep(pause_time) soup = BeautifulSoup(driver.page_source, 'html.parser') driver.close() hrefs = soup.find_all('a') post_ids = [] past_post_ids = [] new_post_ids = [] for href in hrefs: if re.match('/news/id/', str(href.get('href'))): post_id = str(href.get('href')).split('/')[-1].split('?')[0] post_ids.append(post_id) myclient = pymongo.MongoClient(\"mongodb://localhost:27017/\") mydb = myclient[\"article\"] mycol = mydb[\"2021_é‰…äº¨ç¶²\"] end = datetime.datetime.now() start = end - datetime.timedelta(days = 3) for x in mycol.find({'Date': {\"$gte\": start,\"$lte\": end}}): past_post_ids.append(x[\"post_id\"]) new_post_ids = [] for _id in post_ids: if _id in past_post_ids: None else: new_post_ids.append(_id) urls = ['https://news.cnyes.com/news/id/{}?exp=a'.format(e) for e in new_post_ids] def get_text(i): post_id = urls[i].split('/')[5].split('?')[0] data = urllib.request.urlopen(urls[i]) soup = BeautifulSoup(data, 'html.parser') P = soup.find_all('p') text = '' for i,p in zip(range(0,len(P)),P): if i \u003e=4: text = text + p.getText() i += 1 tags = soup.find_all('a') n_tags = [] for tag in tags: if re.match('/tag/', str(tag.get('href'))): n_tags.append(str(tag.get('href'))[5:len(str(tag.get('href')))]) title = soup.find('h1').getText() T = soup.find('time') Date = datetime.datetime.strptime(T['datetime'], \"%Y-%m-%dT%H:%M:%S+08:00\") return(Date,post_id,title,n_tags,text) for i in range(0,len(urls)): data = get_text(i) print(i, end = ' ') mydict = { \"Date\": data[0], \"post_id\":data[1],\"Title\": data[2], \"Tags\":data[3] , \"text\": data[4] } x = mycol.insert_one(mydict) cursor = mycol.aggregate( [{\"$group\": {\"_id\": \"$Title\", \"unique_ids\": {\"$addToSet\": \"$_id\"}, \"count\": {\"$sum\": 1}}}, {\"$match\": {\"count\": { \"$gte\": 2 }}}]) response = [] for doc in cursor: del doc[\"unique_ids\"][0] for id in doc[\"unique_ids\"]: response.append(id) mycol.remove({\"_id\": {\"$in\": response}}) ","date":"2021-02-01","objectID":"/twse-13-selenium-%E9%89%85%E4%BA%A8%E7%B6%B2/:1:4","tags":["Selenium","bs4","urllib","MongoDB"],"title":"TWSE [13] Selenium + é‰…äº¨ç¶²","uri":"/twse-13-selenium-%E9%89%85%E4%BA%A8%E7%B6%B2/"},{"categories":["Python","TWSE"],"content":"Freepik from www.flaticon.com Python + æŠ•è³‡å­¸/Efficient Frontier/ ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:0:0","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"SQL é€£æ¥/æ–¹æ³•ä¸€/ from sqlalchemy import create_engine import pandas as pd import matplotlib import matplotlib.pyplot as plt %matplotlib inline import numpy as np from functools import reduce import scipy.optimize as solver user = 'root' pw = \"YourPassword\" db = \"TWSE\" engine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=db)) df_2330 = pd.read_sql(\"SELECT * FROM `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` WHERE `è­‰åˆ¸ä»£è™Ÿ` = 2330 AND `æ—¥æœŸ` BETWEEN '2020/10/20 00:00:00' AND '2021/1/10 23:59:59' ORDER BY `æ—¥æœŸ`\", engine, coerce_float=True, parse_dates=True) df_tw = pd.read_sql(\"SELECT * FROM `ç™¼è¡Œé‡åŠ æ¬Šè‚¡åƒ¹æŒ‡æ•¸` WHERE `æ—¥æœŸ` BETWEEN '2020/10/20 00:00:00' AND '2021/1/10 23:59:59'\", engine, coerce_float=True, parse_dates=True) ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:1:0","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"å ±é…¬ç‡ åƒè€ƒè³‡æ–™\r\rpandas.DataFrame.pct_change $$ Return = \\frac{D_{1} - D_{0}}{D_{0}} $$\r\r åŸºæœ¬ ä»Šæ—¥ \u0026 æ˜¨æ—¥ print('ä»Šæ—¥ æ˜¨æ—¥') for i,j in zip(df_2330['æ”¶ç›¤åƒ¹'],df_2330['æ”¶ç›¤åƒ¹'].shift(1)) : print(i, j) Return = pd.DataFrame((df_2330['æ”¶ç›¤åƒ¹'] - df_2330['æ”¶ç›¤åƒ¹'].shift(1))/df_2330['æ”¶ç›¤åƒ¹'].shift(1)) Return = Return.rename(columns = {'æ”¶ç›¤åƒ¹':'Return'}) Return pct_change() df_2330['æ”¶ç›¤åƒ¹'].pct_change() df_tw['æ”¶ç›¤æŒ‡æ•¸'].pct_change() df = pd.DataFrame(df_2330['æ”¶ç›¤åƒ¹'].pct_change()) df['TW'] = df_tw['æ”¶ç›¤æŒ‡æ•¸'].pct_change() df = df.rename(columns = {'æ”¶ç›¤åƒ¹':'2330'}) ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:1:1","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"è®Šç•°æ•¸$Ïƒ^2$ var() df_tw['æ”¶ç›¤æŒ‡æ•¸'].pct_change().var() ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:1:2","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"æ¨™æº–å·®$Ïƒ$ std() df_tw['æ”¶ç›¤æŒ‡æ•¸'].pct_change().std() std = df_tw['æ”¶ç›¤æŒ‡æ•¸'].pct_change().var()**(1/2) ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:1:3","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"å…±è®Šç•°æ•¸$Ïƒ_{a,b}$ cov() åƒè€ƒå…¬å¼\r\r$$cov_{x,y} = \\frac{\\sum{}^{} ({x_i} - \\overline{x})({y_i} - \\overline{y})}{N-1}$$\r\r ç°¡å–®å¯¦è­‰ df_test = pd.DataFrame([(1, 2), (0, 3), (2, 0), (1, 1)], columns=['dogs', 'cats']) df_test.cov() $$dog$$ $$dog_i - \\overline{dog} $$ $$cats$$ $$cat_i - \\overline{cat} $$ $${Dev_{dog}}\\times{Dev_{cat}}$$ 1 0 2 1 0 0 -1 3 1.5 -1.5 2 1 0 -1.5 -1.5 1 0 1 -1 0 $$\\overline{dog} = 1$$ $$\\overline{cat} = 1.5$$ $${\\frac{\\sum{}^{} ({Dev_{dog}}\\times{Dev_{cat}})}{4-1}} = -1$$ $ Ïƒ_{2330,TW} $ è£œå……è³‡æ–™\r\r$$ Ïƒ_{2330,TW} $$ Excelè¨ˆç®—éç¨‹\r\r df.cov() \u003e\u003e\u003e 0.000097 ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:1:4","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"ç›¸é—œä¿‚æ•¸$Ï_{a,b}$ corr() df.corr() 2330 TW 2330 1.000000 0.895857 TW 0.895857 1.000000 ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:1:5","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"$\\beta$ä¿‚æ•¸ åƒè€ƒå…¬å¼\r\r$${\\beta} = \\frac{Ïƒ_{i,m}}{Ïƒ^2}$$ \r\r Beta = df.cov()['TW'][0]/df_tw['æ”¶ç›¤æŒ‡æ•¸'].pct_change().var() ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:1:6","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"SQL é€£æ¥/æ–¹æ³•äºŒ/ from sqlalchemy import create_engine import pandas as pd import matplotlib import matplotlib.pyplot as plt %matplotlib inline import numpy as np from functools import reduce import scipy.optimize as solver user = 'root' pw = \"YourPassword\" db = \"TWSE\" engine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=db)) Start = '2020/10/20 00:00:00' End = '2021/1/10 23:59:59' SQL = ''' SELECT `æ”¶ç›¤åƒ¹` FROM `{}` WHERE `è­‰åˆ¸ä»£è™Ÿ` = '{}' AND `æ—¥æœŸ` BETWEEN '{}' AND '{}' ORDER BY `æ—¥æœŸ` ''' stock_codes = ['2330','2317','1234'] def getSQL(stock_code): df = pd.read_sql(SQL.format('æ¯æ—¥æ”¶ç›¤è¡Œæƒ…',stock_code, Start, End), engine, coerce_float=True, parse_dates=True) return df def Tsql(stock_codes): for i in range(0,len(stock_codes)): globals()[i] = getSQL(stock_codes[i]) if i == 0: df = pd.DataFrame(globals()[i].pct_change()) df = df.rename(columns = {'æ”¶ç›¤åƒ¹':stock_codes[i]}) else: df['{}'.format(stock_codes[i])] = globals()[i].pct_change() df = df.replace([np.inf, -np.inf], 0) return df returns = Tsql(stock_codes) ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:2:0","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"é æœŸå ±é…¬$E(r)$ Expected_R = returns.mean() * 252 ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:2:1","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"æ¬Šé‡$W_{i}$ W = np.array([0.5,0.3,0.2]) ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:2:2","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"æŠ•è³‡çµ„åˆå ±é…¬ç‡$R_{P}$ åƒè€ƒå…¬å¼\r\r$$R_{P} = \\sum{W_{i}\\times{R_{i}}}$$\r\r Portfolio_R = sum(W * Expected_R) ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:2:3","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"é‡åŒ–æŠ•è³‡/Efficient Frontier/ ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:3:0","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"éš¨æ©Ÿæ¬Šé‡$W_{i}$ W = np.random.rand(len(stock_codes)) W = W/sum(W) W ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:3:1","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"æŠ•è³‡çµ„åˆé¢¨éšª$Ïƒ_{P}^2$ åŸºæœ¬å…¬å¼ åƒè€ƒå…¬å¼\r\r$$Ïƒ_{P}^2 = \\sum{ {W_{i}^2} {Ïƒ_{i}^2}} + \\sum\\sum{ W_{i} W_{j} {Ïƒ_{i,j}} } $$ $$Ïƒ_{P}^2 = \\sum{ {W_{i}^2} {Ïƒ_{i}^2}} + \\sum\\sum{ W_{i} W_{j} {Ï_{i,j}} {Ïƒ_{i}} {Ïƒ_{j}} } $$\r\r çŸ©é™£ç°¡å–®è¨ˆç®— åƒè€ƒè³‡æ–™\r\r[work] ç†è§£çŸ©é™£ä¹˜æ³• \\[ \\begin{bmatrix} 1\u00262\\\\3\u00264 \\end{bmatrix} \\times \\begin{bmatrix} 4\u0026-6\\\\ -2\u00263 \\end{bmatrix} = \\begin{bmatrix} A_1\u0026A_2\\\\B_1\u0026B_2 \\end{bmatrix} = \\begin{bmatrix} 0\u00260\\\\4\u0026 -6 \\end{bmatrix}\\]\r\r $A_{1} = 1\\times4 + 2\\times(-2) = 0$ $A_{2} = 1\\times(-6) + 2\\times(3) = 0$ $B_{1} = 3\\times4 + 4\\times(-2) = 4$ $B_{2} = 3\\times(-6) + 4\\times(3) = -6$ ä½¿ç”¨çŸ©é™£ç°¡åŒ–$Ïƒ_{P}^2$è¨ˆç®— åƒè€ƒè³‡æ–™\r\rVaR é¢¨éšªå€¼è¡¡é‡(Value at Riskï¼›VaR) å¦‚ä½•è¨ˆç®—æŠ•è³‡çµ„åˆçš„é¢¨éšªå’Œå›å ± $$Ïƒ_{P}^2 = \\begin{bmatrix}W_1\u0026W_2\u0026W_3\\end{bmatrix} \\times \\begin{bmatrix}Ïƒ_{1}^2\u0026Ïƒ_{2,1}\u0026Ïƒ_{3,1} \\\\\\ Ïƒ_{1,2}\u0026Ïƒ_{2}^2\u0026Ïƒ_{3,2} \\\\\\ Ïƒ_{1,3}\u0026Ïƒ_{2,3}\u0026Ïƒ_{3}^2\\end{bmatrix} \\times \\begin{bmatrix}W_1\\\\\\ W_2\\\\\\ W_3\\end{bmatrix}$$ \r\r .tg {border-collapse:collapse;border-spacing:0;} .tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px; overflow:hidden;padding:10px 5px;word-break:normal;} .tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px; font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;} .tg .tg-io4b{background-color:#efefef;border-color:inherit;color:#000000;font-weight:bold;text-align:center;vertical-align:top} .tg .tg-c3ow{border-color:inherit;text-align:center;vertical-align:top} .tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top} æ­¥é©Ÿä¸€ $$\\begin{bmatrix}W_1\u0026W_2\u0026W_3\\end{bmatrix} \\times \\begin{bmatrix}Ïƒ_{1}^2\u0026Ïƒ_{2,1}\u0026Ïƒ_{3,1} \\\\\\ Ïƒ_{1,2}\u0026Ïƒ_{2}^2\u0026Ïƒ_{3,2} \\\\\\ Ïƒ_{1,3}\u0026Ïƒ_{2,3}\u0026Ïƒ_{3}^2\\end{bmatrix}$$ $W_{1}Ïƒ_{1}^2 + W_{2}Ïƒ_{1,2}+ W_{3}Ïƒ_{1,3}$ $ W_{1}Ïƒ_{2,1}+ W_{2}Ïƒ_{2}^2+ W_{3}Ïƒ_{2,3}$ $ W_{1}Ïƒ_{3,1}+ W_{2}Ïƒ_{3,2}+ W_{3}Ïƒ_{3}^2$ æ­¥é©ŸäºŒ $$\\begin{bmatrix} W_{1}Ïƒ_{1}^2 + W_{2}Ïƒ_{1,2}+ W_{3}Ïƒ_{1,3},\u0026 W_{1}Ïƒ_{2,1}+ W_{2}Ïƒ_{2}^2+ W_{3}Ïƒ_{2,3},\u0026 W_{1}Ïƒ_{3,1}+ W_{2}Ïƒ_{3,2}+ W_{3}Ïƒ_{3}^2\\end{bmatrix} \\times \\begin{bmatrix}W_1\\\\\\ W_2\\\\\\ W_3\\end{bmatrix}$$ $W_{1}^2Ïƒ_{1}^2$ $ W_{1}W_{2}Ïƒ_{2,1}$ $ W_{1}W_{2}Ïƒ_{3,1}$ $ W_{1} W_{2}Ïƒ_{1,2}$ $ W_{2}^2Ïƒ_{2}^2$ $ W_{2}W_{3}Ïƒ_{3,2}$ $ W_{1} W_{3}Ïƒ_{1,3}$ $ W_{2}W_{3}Ïƒ_{2,3}$ $ W_{3}^2Ïƒ_{3}^2$ ç”¨Pythonè¡¨ç¤º åƒè€ƒè³‡æ–™\r\rPython-ç¹ªè£½æ•ˆç‡å‰ç·£(Efficient Frontier) Pythoné‡‘èå¤§æ•¸æ“šåˆ†æâ€”â€”ç¬¬11ç«  çµ±è¨ˆå­¸ï¼ˆ2ï¼‰æŠ•è³‡çµ„åˆå„ªåŒ– ç­†è¨˜\r\r æ–¹æ³•ä¸€ ä»¥ä¸‹ç¨‹å¼ç¢¼ä¾†æºï¼Œåƒè€ƒè‡ªï¼š\r\rPython-ç¹ªè£½æ•ˆç‡å‰ç·£(Efficient Frontier) Portfolio_risk = np.sqrt(reduce(np.dot, [W, cov_matrix, W.T])) \r\r æ–¹æ³•äºŒ åƒè€ƒè³‡æ–™\r\rPython Lambda Portfolio_risk = lambda a, b,c: np.sqrt(np.dot(np.dot(a,b),c)) Portfolio_risk(W, cov_matrix,W.T) \r\r ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:3:2","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"éš¨æ©Ÿç”Ÿæˆ10000ç­†æ¬Šé‡ ä»¥ä¸‹ç¨‹å¼ç¢¼ä¾†æºï¼Œåƒè€ƒè‡ªï¼š\r\rPython-ç¹ªè£½æ•ˆç‡å‰ç·£(Efficient Frontier) Expected_R = returns.mean() * 252 cov_matrix = returns.cov()*252 all_Portfolio_risk = [] all_return = [] Expected_R = returns.mean() * 252 stop = 0 while stop \u003c 10000: try: stop += 1 W = np.random.rand(len(stock_codes)) W = W/sum(W) all_return.append(sum(Expected_R * W)) all_Portfolio_risk.append(np.sqrt(reduce(np.dot, [W, cov_matrix, W.T]))) except: pass SR = np.array(all_return)/np.array(all_Portfolio_risk) \r\r ç•«åœ– Fig 1 fig = plt.figure(figsize = (20,10)) ax = fig.add_subplot() ax.plot(all_Portfolio_risk, all_return, 'o',alpha=1) fig.savefig('Efficient_Frontier_1.png',dpi=300, bbox_inches='tight') Fig 2 æ–¹æ³•ä¸€ #åŸºæœ¬è¨­å®š fig = plt.figure(figsize = (20,8)) risk_free = 0.01 SR = (np.array(all_return)-risk_free)/np.array(all_Portfolio_risk) #å­—é«”å¤§å°è¨­å®š label_size = 27 tick_size = 15 Title_size = 40 #Title Title = 'Efficient Frontier' #æ ¼ç·š plt.grid(True) #æ•£é»åœ– plt.scatter(all_Portfolio_risk, all_return, c=SR,alpha=1) #X,Yè»¸æ¨™ç±¤ plt.xlabel('$Ïƒ_{P}$', fontsize=label_size, fontweight='bold') plt.ylabel('$E(R)$', fontsize=label_size, fontweight='bold') #X,Yè»¸å­—é«”è¨­å®š plt.xticks(fontsize=tick_size, fontweight='bold') plt.yticks(fontsize=tick_size, fontweight='bold') #color barè¨­å®š cbar = plt.colorbar(label='$Sharpe$ $Ratio$') ax = cbar.ax ax.tick_params(labelsize=tick_size) cbar_Title = ax.yaxis.label font = matplotlib.font_manager.FontProperties(size=label_size) cbar_Title.set_font_properties(font) plt.title(Title, fontsize=Title_size,family = 'monospace',ha = 'center') #åœ–ç‰‡å„²å­˜ plt.savefig('Efficient_Frontier_2.png',dpi=300, bbox_inches='tight') æ–¹æ³•äºŒ fig = plt.figure(figsize = (20,8)) label_size = 27 tick_size = 15 Title_size = 40 Title = 'Efficient Frontier' risk_free = 0.01 SR = (np.array(all_return)-risk_free)/np.array(all_Portfolio_risk) ax = fig.add_subplot() ax.grid(True) ax_main = ax.scatter(all_Portfolio_risk, all_return, c=SR,alpha=1) ax.set_title(Title, fontsize=Title_size,family = 'monospace',ha = 'center') ax.set_xlabel('$Ïƒ_{P}$', fontsize=label_size, fontweight='bold') ax.set_ylabel('$E(R)$', fontsize=label_size, fontweight='bold') ax.tick_params(labelsize=tick_size) cbar = fig.colorbar(ax_main, ax=ax, label = '$Sharpe$ $Ratio$') cbar = cbar.ax cbar.tick_params(labelsize=tick_size) cbar_Title = cbar.yaxis.label font = matplotlib.font_manager.FontProperties(size=label_size) cbar_Title.set_font_properties(font) fig.savefig('Efficient_Frontier_3.png',dpi=300, bbox_inches='tight') ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:3:3","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"scipy.optimize.minimize min($Ïƒ_{P}$) def standard_deviation(W): return Portfolio_risk(W, cov_matrix,W.T) ä»¥ä¸‹ç¨‹å¼ç¢¼ä¾†æºï¼Œåƒè€ƒè‡ªï¼š\r\rPython-ç¹ªè£½æ•ˆç‡å‰ç·£(Efficient Frontier) x0 = [1/len(stock_codes) for e in range(len(stock_codes))] bounds = tuple((0, 1) for x in range(len(stock_codes))) constraints = [{'type': 'eq', 'fun': lambda x: sum(x) - 1}] min_Portfolio_risk = solver.minimize(standard_deviation, x0=x0, constraints=constraints, bounds=bounds) mvp_risk = min_Portfolio_risk.fun mvp_return = sum(min_Portfolio_risk.x * Expected_R) print('é¢¨éšªæœ€å°åŒ–æŠ•è³‡çµ„åˆé æœŸå ±é…¬ç‡ç‚º:' + str(round(mvp_return,2))) print('é¢¨éšªæœ€å°åŒ–æŠ•è³‡çµ„åˆé¢¨éšªç‚º:' + str(round(mvp_risk,2))) \r\r è£œå……è³‡æ–™\r\rscipy.optimize.minimize \r\r ä»¥ä¸‹ç¨‹å¼ç¢¼ä¾†æºï¼Œåƒè€ƒè‡ªï¼š\r\rPython-ç¹ªè£½æ•ˆç‡å‰ç·£(Efficient Frontier) for i in range(0,len(stock_codes)): print(stock_codes[i]+' ä½”æŠ•è³‡çµ„åˆæ¬Šé‡ : ' + str(format(min_Portfolio_risk.x[i], '.4f'))) $$SR = \\frac{R_{P} - R_{f}}{Ïƒ_{P}}$$ risk_free = 0.01 SR = (np.array(all_return)-risk_free)/np.array(all_Portfolio_risk) x0 = [1/len(stock_codes) for e in range(len(stock_codes))] bounds = tuple((0, 1) for x in range(len(stock_codes))) efficient_fronter_return_range = np.arange(min(all_return), max(all_return),(max(all_return) - min(all_return))/20) efficient_fronter_risk_list = [] for i in efficient_fronter_return_range: constraints = [{'type': 'eq', 'fun': lambda x: sum(x) - 1}, {'type': 'eq', 'fun': lambda x: sum(x * Expected_R) - i}] efficient_fronter = solver.minimize(standard_deviation, x0=x0, constraints=constraints, bounds=bounds) efficient_fronter_risk_list.append(efficient_fronter.fun) \r\r label_size = 27 tick_size = 15 Title_size = 40 Title = 'Efficient Frontier' fig = plt.figure(figsize = (20,8)) ax = fig.add_subplot() ax.grid(True) ax_main = ax.scatter(all_Portfolio_risk, all_return, c=SR,alpha=1) ax.set_title(Title, fontsize=Title_size,family = 'monospace',ha = 'center') ax.set_xlabel('$Ïƒ_{P}$', fontsize=label_size, fontweight='bold') ax.set_ylabel('$E(R)$', fontsize=label_size, fontweight='bold') ax.tick_params(labelsize=tick_size) ax.plot(efficient_fronter_risk_list, efficient_fronter_return_range, linewidth=5, color='#251f6b') ax.plot(mvp_risk, mvp_return,'o',color='r', markerfacecolor='#ed1313', markersize=15) cbar = fig.colorbar(ax_main, ax=ax, label = '$Sharpe$ $Ratio$') cbar = cbar.ax cbar.tick_params(labelsize=tick_size) cbar_Title = cbar.yaxis.label font = matplotlib.font_manager.FontProperties(size=label_size) cbar_Title.set_font_properties(font) fig.savefig('Efficient_Frontier_4.png',dpi=300, bbox_inches='tight') ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:3:4","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"å®Œæ•´ç¨‹å¼ç¢¼/SQL/ from sqlalchemy import create_engine import pandas as pd import matplotlib import matplotlib.pyplot as plt %matplotlib inline import numpy as np from functools import reduce import scipy.optimize as solver user = 'root' pw = \"YourPassword\" db = \"TWSE\" engine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=db)) Start = '2020/10/20 00:00:00' End = '2021/1/10 23:59:59' SQL = ''' SELECT `æ”¶ç›¤åƒ¹` FROM `{}` WHERE `è­‰åˆ¸ä»£è™Ÿ` = '{}' AND `æ—¥æœŸ` BETWEEN '{}' AND '{}' ORDER BY `æ—¥æœŸ` ''' stock_codes = ['2330','2317','1234'] def getSQL(stock_code): df = pd.read_sql(SQL.format('æ¯æ—¥æ”¶ç›¤è¡Œæƒ…',stock_code, Start, End), engine, coerce_float=True, parse_dates=True) return df def Tsql(stock_codes): for i in range(0,len(stock_codes)): globals()[i] = getSQL(stock_codes[i]) if i == 0: df = pd.DataFrame(globals()[i].pct_change()) df = df.rename(columns = {'æ”¶ç›¤åƒ¹':stock_codes[i]}) else: df['{}'.format(stock_codes[i])] = globals()[i].pct_change() df = df.replace([np.inf, -np.inf,np.nan], 0) return df returns = Tsql(stock_codes) Expected_R = returns.mean() * 252 cov_matrix = returns.cov()*252 Portfolio_risk = lambda a, b,c: np.sqrt(np.dot(np.dot(a,b),c)) all_Portfolio_risk = [] all_return = [] stop = 0 while stop \u003c 10000: try: stop += 1 W = np.random.rand(len(stock_codes)) W = W/sum(W) all_return.append(sum(Expected_R * W)) all_Portfolio_risk.append(Portfolio_risk(W, cov_matrix,W.T)) except: pass def standard_deviation(W): return Portfolio_risk(W, cov_matrix,W.T) x0 = [1/len(stock_codes) for e in range(len(stock_codes))] bounds = tuple((0, 1) for x in range(len(stock_codes))) constraints = [{'type': 'eq', 'fun': lambda x: sum(x) - 1}] min_Portfolio_risk = solver.minimize(standard_deviation, x0=x0, constraints=constraints, bounds=bounds) mvp_risk = min_Portfolio_risk.fun mvp_return = sum(min_Portfolio_risk.x * Expected_R) print('é¢¨éšªæœ€å°åŒ–æŠ•è³‡çµ„åˆé æœŸå ±é…¬ç‡ç‚º:' + str(round(mvp_return,2))) print('é¢¨éšªæœ€å°åŒ–æŠ•è³‡çµ„åˆé¢¨éšªç‚º:' + str(round(mvp_risk,2))) for i in range(0,len(stock_codes)): print(stock_codes[i]+' ä½”æŠ•è³‡çµ„åˆæ¬Šé‡ : ' + str(format(min_Portfolio_risk.x[i], '.4f'))) risk_free = 0.01 SR = (np.array(all_return)-risk_free)/np.array(all_Portfolio_risk) start = round(min(all_return),6) end = round(max(all_return),4) efficient_fronter_return_range = np.arange(start, end,(max(all_return) - min(all_return))/30) efficient_fronter_risk_list = [] for i in efficient_fronter_return_range: constraints = [{'type': 'eq', 'fun': lambda x: sum(x) - 1}, {'type': 'eq', 'fun': lambda x: sum(x * Expected_R) - i}] efficient_fronter = solver.minimize(standard_deviation, x0=x0, constraints=constraints, bounds=bounds) efficient_fronter_risk_list.append(efficient_fronter.fun) label_size = 27 tick_size = 15 Title_size = 40 Title = 'Efficient Frontier' fig = plt.figure(figsize = (20,8)) ax = fig.add_subplot() ax.grid(True) ax_main = ax.scatter(all_Portfolio_risk, all_return, c=SR,alpha=1) ax.set_title(Title, fontsize=Title_size,family = 'monospace',ha = 'center') ax.set_xlabel('$Ïƒ_{P}$', fontsize=label_size, fontweight='bold') ax.set_ylabel('$E(R)$', fontsize=label_size, fontweight='bold') ax.tick_params(labelsize=tick_size) ax.plot(efficient_fronter_risk_list, efficient_fronter_return_range, linewidth=5, color='#251f6b') ax.plot(mvp_risk, mvp_return,'o',color='r', markerfacecolor='#ed1313', markersize=15) cbar = fig.colorbar(ax_main, ax=ax, label = '$Sharpe$ $Ratio$') cbar = cbar.ax cbar.tick_params(labelsize=tick_size) cbar_Title = cbar.yaxis.label font = matplotlib.font_manager.FontProperties(size=label_size) cbar_Title.set_font_properties(font) fig.savefig('Efficient_Frontier_4.png',dpi=300, bbox_inches='tight') ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:3:5","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"å®Œæ•´ç¨‹å¼ç¢¼/å…SQL/ import pandas_datareader.data as web import mplfinance as mpf import matplotlib import matplotlib.pyplot as plt %matplotlib inline import numpy as np import scipy.optimize as solver stock_code = ['2330','3008','6409','1234','2337','2412'] stock_codes = ['{}.tw'.format(e) for e in stock_code] df = web.DataReader(stock_codes, 'yahoo', '2020-05-01') returns = df['Close'].pct_change() Expected_R = returns.mean() * 252 cov_matrix = returns.cov()*252 Portfolio_risk = lambda a, b,c: np.sqrt(np.dot(np.dot(a,b),c)) all_Portfolio_risk = [] all_return = [] stop = 0 while stop \u003c 50000: try: stop += 1 W = np.random.rand(len(stock_codes)) W = W/sum(W) all_return.append(sum(Expected_R * W)) all_Portfolio_risk.append(Portfolio_risk(W, cov_matrix,W.T)) except: pass def standard_deviation(W): return Portfolio_risk(W, cov_matrix,W.T) x0 = [1/len(stock_codes) for e in range(len(stock_codes))] bounds = tuple((0, 1) for x in range(len(stock_codes))) constraints = [{'type': 'eq', 'fun': lambda x: sum(x) - 1}] min_Portfolio_risk = solver.minimize(standard_deviation, x0=x0, constraints=constraints, bounds=bounds) mvp_risk = min_Portfolio_risk.fun mvp_return = sum(min_Portfolio_risk.x * Expected_R) print('é¢¨éšªæœ€å°åŒ–æŠ•è³‡çµ„åˆé æœŸå ±é…¬ç‡ç‚º:' + str(round(mvp_return,2))) print('é¢¨éšªæœ€å°åŒ–æŠ•è³‡çµ„åˆé¢¨éšªç‚º:' + str(round(mvp_risk,2))) for i in range(0,len(stock_codes)): print(stock_codes[i]+' ä½”æŠ•è³‡çµ„åˆæ¬Šé‡ : ' + str(format(min_Portfolio_risk.x[i], '.4f'))) risk_free = 0.01 SR = (np.array(all_return)-risk_free)/np.array(all_Portfolio_risk) start = round(min(all_return),6) end = round(max(all_return),4) efficient_fronter_return_range = np.arange(start, end,(max(all_return) - min(all_return))/30) efficient_fronter_risk_list = [] for i in efficient_fronter_return_range: constraints = [{'type': 'eq', 'fun': lambda x: sum(x) - 1}, {'type': 'eq', 'fun': lambda x: sum(x * Expected_R) - i}] efficient_fronter = solver.minimize(standard_deviation, x0=x0, constraints=constraints, bounds=bounds) efficient_fronter_risk_list.append(efficient_fronter.fun) label_size = 27 tick_size = 15 Title_size = 40 Title = 'Efficient Frontier' fig = plt.figure(figsize = (20,8)) ax = fig.add_subplot() ax.grid(True) ax_main = ax.scatter(all_Portfolio_risk, all_return, c=SR,alpha=1) ax.set_title(Title, fontsize=Title_size,family = 'monospace',ha = 'center') ax.set_xlabel('$Ïƒ_{P}$', fontsize=label_size, fontweight='bold') ax.set_ylabel('$E(R)$', fontsize=label_size, fontweight='bold') ax.tick_params(labelsize=tick_size) ax.plot(efficient_fronter_risk_list, efficient_fronter_return_range, linewidth=5, color='#251f6b') ax.plot(mvp_risk, mvp_return,'o',color='r', markerfacecolor='#ed1313', markersize=15) cbar = fig.colorbar(ax_main, ax=ax, label = '$Sharpe$ $Ratio$') cbar = cbar.ax cbar.tick_params(labelsize=tick_size) cbar_Title = cbar.yaxis.label font = matplotlib.font_manager.FontProperties(size=label_size) cbar_Title.set_font_properties(font) fig.savefig('Efficient_Frontier_4.png',dpi=300, bbox_inches='tight') ","date":"2021-01-27","objectID":"/twse-12-efficient-frontier/:3:6","tags":["Python","TWSE","Pandas"],"title":"TWSE [12] Efficient Frontier","uri":"/twse-12-efficient-frontier/"},{"categories":["Python","TWSE"],"content":"Freepik from www.flaticon.com Wordcloud + MongoDB ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:0:0","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"img wordcloud.jpg ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:1:0","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"MongoDBé€£ç·š myclient = pymongo.MongoClient(\"mongodb://localhost:27017/\") mydb = myclient[\"article\"] mycol = mydb[\"2021_é‰…äº¨ç¶²\"] ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:2:0","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"import %matplotlib inline import matplotlib.pyplot as plt from wordcloud import WordCloud from PIL import Image import numpy as np import jieba import nltk import pymongo ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:2:1","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"æŠ“å‡ºæ–‡ç« å…§å®¹ Text = \"\" for x in mycol.find({}): Text = Text + x[\"text\"] ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:2:2","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"Wordcloudåœ– mask = np.array(Image.open('wordcloud.jpg')) wordcloud = WordCloud(background_color=\"white\", width=1000, height=860, margin=2, font_path=\"msjhbd.ttc\", mask=mask).generate(Text) plt.figure(figsize=(20,20)) plt.imshow(wordcloud) plt.axis(\"off\") plt.show() fig 1 fig 2 å­˜åˆ°äº†ä¸€äº›ç„¡é—œç·Šè¦çš„è³‡æ–™ é‡è¤‡æ€§é«˜çš„é–‹é ­ã€å½¢å®¹è© ex: å…¶ä¸­ã€ä»Šå¹´ã€ä¸éã€å¦å¤–...... ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:2:3","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"å°‡ç¬¦è™Ÿç§»é™¤ Text = Text.translate({ord(c):None for c in list(\"(),.â€œâ€ï¼ˆï¼‰ã€Œã€ï¼Œã€‚ã€ï¼šï¼›ï¼|\\n/ ã€Šã€‹ã€”ã€•ã€ˆã€‰ï¼Ÿ\")}) ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:2:4","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"è‡ªå»ºè© userdict userdict.txt jieba.load_userdict(\"userdict.txt\") ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:2:5","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"ä¸­æ–‡æ–·è© jieba terms = jieba.cut(Text) ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:2:6","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"åœç”¨è© stopwords.txt stopwords.txt stopwords = list() with open(\"stopwords.txt\", \"r\", encoding = \"utf-8\") as fp: stopwords = [word.strip() for word in fp.readlines()] keyterms = [keyterm for keyterm in terms if keyterm not in stopwords] Text = \"/\".join(keyterms) ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:2:7","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"WordCloudåœ– mask = np.array(Image.open('wordcloud.jpg')) wordcloud = WordCloud(background_color=\"white\", width=1000, height=860, margin=2, font_path=\"msjhbd.ttc\", mask=mask).generate(Text) plt.figure(figsize=(20,20)) plt.imshow(wordcloud) plt.axis(\"off\") plt.show() ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:2:8","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"è®€å–txtæª” ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:3:0","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"import %matplotlib inline import matplotlib.pyplot as plt from wordcloud import WordCloud from PIL import Image import numpy as np import jieba import nltk ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:3:1","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"Read .txt test_text.txt with open(\"test_text.txt\", \"r\", encoding = \"utf-8\") as fp: Text = fp.read() ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:3:2","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"ç•«åœ– Text = Text.translate({ord(c):None for c in list(\"(),.â€œâ€ï¼ˆï¼‰ã€Œã€ï¼Œã€‚ã€ï¼šï¼›ï¼|\\n/ ã€Šã€‹ã€”ã€•ã€ˆã€‰ï¼Ÿ\")}) jieba.load_userdict(\"userdict.txt\") terms = jieba.cut(Text) stopwords = list() with open(\"stopwords.txt\", \"r\", encoding = \"utf-8\") as fp: stopwords = [word.strip() for word in fp.readlines()] keyterms = [keyterm for keyterm in terms if keyterm not in stopwords] Text = \"/\".join(keyterms) mask = np.array(Image.open('wordcloud.jpg')) wordcloud = WordCloud(background_color=\"white\", width=1000, height=860, margin=2, font_path=\"msjhbd.ttc\", mask=mask).generate(Text) plt.figure(figsize=(20,20)) plt.imshow(wordcloud) plt.axis(\"off\") plt.show() ","date":"2021-01-26","objectID":"/twse-11-wordcloud-mongodb/:3:3","tags":["Python","TWSE","MongoDB","NoSQL","Word Cloud"],"title":"TWSE [11] Wordcloud + MongoDB","uri":"/twse-11-wordcloud-mongodb/"},{"categories":["Python","TWSE"],"content":"Freepik from www.flaticon.com NoSQL MonogoDB + Python ","date":"2021-01-19","objectID":"/twse-10-mongodb-python/:0:0","tags":["MongoDB","NoSQL","Python","NoSQL","TWSE"],"title":"TWSE [10] MongoDB+Python","uri":"/twse-10-mongodb-python/"},{"categories":["Python","TWSE"],"content":"MonogoDB Download åƒè€ƒè³‡æ–™ Windows MongoDB ä¸‹è¼‰èˆ‡å®‰è£æ•™å­¸ é—œæ–¼ MongoDB çš„ _id æ¬„ä½ MongoDBçš„_idå’ŒObjectIdæ€éº¼ç†è§£ï¼ŸåŒæ¨£æ˜¯ç¨‹å¼è¨­è¨ˆå¸«ï¼Œç”¨å¿ƒä½ å°±è¶…å‰äº† MongoDB Data Types ","date":"2021-01-19","objectID":"/twse-10-mongodb-python/:1:0","tags":["MongoDB","NoSQL","Python","NoSQL","TWSE"],"title":"TWSE [10] MongoDB+Python","uri":"/twse-10-mongodb-python/"},{"categories":["Python","TWSE"],"content":"MongoDB Version db.version() \u003e\u003e\u003e 4.4.2 ","date":"2021-01-19","objectID":"/twse-10-mongodb-python/:1:1","tags":["MongoDB","NoSQL","Python","NoSQL","TWSE"],"title":"TWSE [10] MongoDB+Python","uri":"/twse-10-mongodb-python/"},{"categories":["Python","TWSE"],"content":"MongoDB Data Types MongoDB Data Types Integer Arrays Timestamp Boolean Object Binary data Double Symbol Object ID Min/Max keys Null Regular expression String Date Code ","date":"2021-01-19","objectID":"/twse-10-mongodb-python/:1:2","tags":["MongoDB","NoSQL","Python","NoSQL","TWSE"],"title":"TWSE [10] MongoDB+Python","uri":"/twse-10-mongodb-python/"},{"categories":["Python","TWSE"],"content":"Robo 3T Download åƒè€ƒè³‡æ–™ MongoDB ä½¿ç”¨Robo 3Tå»ºç«‹è³‡æ–™åº« ","date":"2021-01-19","objectID":"/twse-10-mongodb-python/:2:0","tags":["MongoDB","NoSQL","Python","NoSQL","TWSE"],"title":"TWSE [10] MongoDB+Python","uri":"/twse-10-mongodb-python/"},{"categories":["Python","TWSE"],"content":"Python ","date":"2021-01-19","objectID":"/twse-10-mongodb-python/:3:0","tags":["MongoDB","NoSQL","Python","NoSQL","TWSE"],"title":"TWSE [10] MongoDB+Python","uri":"/twse-10-mongodb-python/"},{"categories":["Python","TWSE"],"content":"w3schools 1 pip install pip install pymongo 2 import import pymongo myclient = pymongo.MongoClient(\"mongodb://localhost:27017/\") 3 æ¸¬è©¦ç”¨æ–‡ç«  #æ¸¬è©¦æ–‡ç«  title = 'ç›¤ä¸­é›¶è‚¡äº¤æ˜“å°ç©é›»æœ€å—æ­¡è¿ æˆäº¤é‡‘é¡é€¼è¿‘200å„„å…ƒ' text = '''å°è‚¡æ”»ä¸Šæ³¢æ®µæ–°é«˜ï¼Œé€£å¸¶æ€èµ·é›¶è‚¡äº¤æ˜“ç†±æ½®ï¼Œæ ¹æ“šè­‰äº¤æ‰€çµ±è¨ˆï¼Œç›¤ä¸­é›¶è‚¡äº¤æ˜“è‡ªå»å¹´ 10 æœˆ 26 æ—¥å¯¦æ–½ä»¥ä¾†ï¼Œæˆªè‡³ä»Šå¹´ 1 æœˆ 15 æ—¥æ­¢ï¼Œå–®æ—¥å¹³å‡æˆäº¤é‡‘é¡é” 8.73 å„„å…ƒï¼ŒåŠ ä¸Šç›¤å¾Œäº¤æ˜“ï¼Œå–®æ—¥å¹³å‡é‡‘é¡è¶…é 10 å„„å…ƒï¼Œå…¶ä¸­æ¬Šå€¼è‚¡ç‹å°ç©é›» (2330-TW) ç´¯è¨ˆæˆäº¤å€¼é€¼è¿‘ 200 å„„å…ƒï¼Œæ˜¯æœ€ç†±é–€çš„äº¤æ˜“æ¨™çš„ã€‚æ ¹æ“šè­‰äº¤æ‰€çµ±è¨ˆï¼Œç›¤ä¸­é›¶è‚¡äº¤æ˜“å‰ 10 å¤§ç†±é–€æ¨™é¦–æ¨å°ç©é›»ï¼Œäº¤æ˜“é‡‘é¡æ¯”é‡é«˜é” 34%ï¼Œå…¶æ¬¡åˆ†åˆ¥ç‚ºï¼šå¤§ç«‹å…‰ (3008-TW)(12%)ã€è¯ç™¼ç§‘ (2454-TW)(5%)ã€åœ‹å·¨ (2327-TW)(3%)ã€å…ƒå¤§å°ç£ 50(2%)ã€é´»æµ· (2317-TW)(2%)ï¼›å¦å¤–ï¼Œè¯é›» (2303-TW)ã€å°é”é›» (2308-TW)ã€ç‰æ™¶å…‰ (3406-TW)ã€åŒæ¬£é›» (6271-TW) äº¤æ˜“é‡‘é¡ä¹Ÿæœ‰ 1% çš„æ¯”é‡ã€‚ä»¥æˆäº¤è‚¡æ•¸ä¾†çœ‹ï¼Œå°ç©é›»ä»¥å æ•´é«”äº¤æ˜“æ¯”é‡ 8% å±…å† ï¼Œå…¶ä»–ä¾åºåˆ†åˆ¥ç‚ºï¼šè¯é›»ã€é´»æµ·ã€å…ƒå¤§é«˜è‚¡æ¯ã€ç‰å±±é‡‘ (2884-TW)ã€å…ƒå¤§å°ç£ 50ã€é•·æ¦®ã€å…ƒæ™¶ã€æ•¦æ³°èˆ‡ç¬¬ä¸€é‡‘ã€‚ä»¥å°ç©é›»ä¾†èªªï¼Œå‡è¨­æŠ•è³‡äººåœ¨ 10 æœˆ 26 æ—¥ç•¶å¤©é«˜é» 455 å…ƒè²·é€²å°ç©é›»çºŒæŠ±è‡³ä»Šï¼Œä»¥ä»Šå¤©æ”¶ç›¤åƒ¹ 627 å…ƒè¨ˆç®—ï¼ŒæœŸé–“è‚¡åƒ¹ç´„ä¸Šæ¼² 37%ï¼Œå…¶ä»–åŒ…æ‹¬è¯é›»ã€é´»æµ·è‚¡åƒ¹åœ¨æœŸé–“æ”»ä¸Šæ­·å²é«˜é»ï¼ŒåŒæ¨£è®“é›¶è‚¡æŠ•è³‡äººè³ºé€²ä¸€ç­†æ”¶ç›Šã€‚''' 4 Create DB, Collection and Insert document mydb = myclient[\"article\"] mycol = mydb[\"test\"] mydict = { \"Title\": title, \"text\": text } x = mycol.insert_one(mydict) 5 å°å‡ºæ‰€æœ‰DB print(myclient.list_database_names()) 6 å°å‡ºæ‰€æœ‰collection print(mydb.list_collection_names()) ","date":"2021-01-19","objectID":"/twse-10-mongodb-python/:3:1","tags":["MongoDB","NoSQL","Python","NoSQL","TWSE"],"title":"TWSE [10] MongoDB+Python","uri":"/twse-10-mongodb-python/"},{"categories":["Python","TWSE"],"content":"Python + bs4 + é‰…äº¨ç¶² 1 def get_text(i): def get_text(i): post_id = urls[i].split('/')[5].split('?')[0] data = urllib.request.urlopen(urls[i]) soup = BeautifulSoup(data, 'html.parser') P = soup.find_all('p') text = '' for i,p in zip(range(0,len(P)),P): if i \u003e=4: text = text + p.getText() i += 1 tags = soup.find_all('a') n_tags = [] for tag in tags: if re.match('/tag/', str(tag.get('href'))): n_tags.append(str(tag.get('href'))[5:len(str(tag.get('href')))]) title = soup.find('h1').getText() T = soup.find('time') Date = datetime.datetime.strptime(T['datetime'], \"%Y-%m-%dT%H:%M:%S+08:00\") return(Date,post_id,title,n_tags,text) 2 importå¥—ä»¶ import pymongo import urllib from bs4 import BeautifulSoup import regex as re import datetime 3 Create DB, Collection myclient = pymongo.MongoClient(\"mongodb://localhost:27017/\") mydb = myclient[\"article\"] mycol = mydb[\"2021_é‰…äº¨ç¶²\"] 4 Insert document url = 'https://news.cnyes.com/news/cat/tw_stock_news?exp=a' data = urllib.request.urlopen(url) soup = BeautifulSoup(data, 'html.parser') hrefs = soup.find_all('a') urls = ['https://news.cnyes.com'+ str(href.get('href')) for href in hrefs if re.match('/news/id/', str(href.get('href')))] for i in range(0,len(urls)): data = get_text(i) mydict = { \"Date\": data[0], \"post_id\":data[1],\"Title\": data[2], \"Tags\":data[3] , \"text\": data[4] } x = mycol.insert_one(mydict) 5 find åƒè€ƒè³‡æ–™ Tutorial â€” PyMongo v2.0.1 documentation w3schools Collection Methods Finding duplicate keys with MongoDBâ€™s aggregation framework find({}) å…¨éƒ¨ for x in mycol.find({}): print(x) find({}).count() è¨ˆç®—å…¨éƒ¨æ•¸é‡ mycol.find({}).count() find({â€œXâ€:â€œXXâ€}) ç‰¹å®šè³‡æ–™ for x in mycol.find({\"Title\":\"å®æ³°äººå£½æ¸›è³‡å†å¢è³‡ ä¸ŸåŒ…è¢±223.9å„„å…ƒè£œè™§æ 2æœˆåº•å‰ç¾å¢19.5å„„å…ƒ\"}): print(x) find({â€œXâ€: {\"$\u001elt\": X}}).sort(â€œXXâ€) æŒ‡å®šæ—¥æœŸä¹‹å‰çš„æ‰€æœ‰è³‡æ–™.sort(â€œDateâ€) d = datetime.datetime(2021, 1, 21, 23) Year Month Day Hour 2021 1 21 23ï¼ˆæ•´å¤©ï¼‰ â˜…hour must be in 0~23 d = datetime.datetime(2021, 1, 21, 23) for x in mycol.find({\"Date\": {\"$lt\": d}}).sort(\"Date\"): print(x) print(mycol.find({\"Date\": {\"$lt\": d}}).sort(\"Date\").count()) find({â€˜Dateâ€™: {\"$\u001egte\": start,\"$\u001elte\": end}}) æ‰¾å‡ºä¸€æ®µæ™‚é–“çš„è³‡æ–™ start = datetime.datetime(2021, 1, 21, 0) end = datetime.datetime(2021, 1, 22, 20) for x in mycol.find({'Date': {\"$gte\": start,\"$lte\": end}}).sort(\"Date\"): print(x) 6 åˆªé™¤é‡è¤‡è³‡æ–™ åƒè€ƒè³‡æ–™ mongo åˆ é™¤é‡å¤æ•°æ® pymongoå»é™¤é‡å¤æ•°æ® pymongo: remove duplicates (map reduce?) MongoDBåŸ·è¡Œ æº–å‚™é‡è¤‡è³‡æ–™ åŸ·è¡Œç¨‹å¼ç¢¼/SQL/ db.getCollection(\"test\").aggregate([ { $group:{_id:{Title:'$Title'},count:{$sum:1},dups:{$addToSet:'$_id'}} }, { $match:{count:{$gt:1}} } ]).forEach(function(it){ it.dups.shift(); db.getCollection(\"test\").remove({_id: {$in: it.dups}}); });db.getCollection(\"test\").aggregate([ { $group:{_id:{Title:'$Title'},count:{$sum:1},dups:{$addToSet:'$_id'}} }, { $match:{count:{$gt:1}} } ]).forEach(function(it){ it.dups.shift(); db.getCollection(\"test\").remove({_id: {$in: it.dups}}); }); PythonåŸ·è¡Œ æº–å‚™é‡è¤‡è³‡æ–™ for i in range(10): mydict = { \"Title\": title, \"text\": text } x = mycol.insert_one(mydict) åŸ·è¡Œç¨‹å¼ç¢¼/Python/ cursor = mycol.aggregate( [ {\"$group\": {\"_id\": \"$Title\", \"unique_ids\": {\"$addToSet\": \"$_id\"}, \"count\": {\"$sum\": 1}}}, {\"$match\": {\"count\": { \"$gte\": 2 }}} ] ) response = [] for doc in cursor: del doc[\"unique_ids\"][0] for id in doc[\"unique_ids\"]: response.append(id) mycol.remove({\"_id\": {\"$in\": response}}) 7 $orderby åƒè€ƒè³‡æ–™ $orderby cursor.sort() å…ˆè¤‡è£½collectionï¼Œé¿å…å‡ºéŒ¯ ä¸æ”¹è®ŠåŸå§‹è³‡æ–™ åŸ·è¡Œç¨‹å¼ç¢¼/SQL/ db.getCollection('2021_é‰…äº¨ç¶²_copy').find().sort( { Date: -1 } ) If MongoDB requires using more than 100 megabytes of system memory for the blocking sort operation, MongoDB returns an error unless the query specifies cursor.allowDiskUse() (New in MongoDB 4.4). allowDiskUse() allows MongoDB to use temporary files on disk to store data exceeding the 100 megabyte system memory limit while processing a blocking sort operation. åŸæ–‡åƒè€ƒè‡ªï¼š $orderby åŸ·è¡Œç¨‹å¼ç¢¼/Python/ for x in mycol.find({}).sort(\"Date\"): print(x) ","date":"2021-01-19","objectID":"/twse-10-mongodb-python/:3:2","tags":["MongoDB","NoSQL","Python","NoSQL","TWSE"],"title":"TWSE [10] MongoDB+Python","uri":"/twse-10-mongodb-python/"},{"categories":["Python","TWSE"],"content":"Freepik from www.flaticon.com BeautifulSoup + é‰…äº¨ç¶² import urllib from bs4 import BeautifulSoup url = 'https://news.cnyes.com/news/cat/tw_stock_news?exp=a' data = urllib.request.urlopen(url) soup = BeautifulSoup(data, 'html.parser') ","date":"2021-01-19","objectID":"/twse-9-bs4-%E9%89%85%E4%BA%A8%E7%B6%B2/:0:0","tags":["bs4","BeautifulSoup","urllib","html.parser"],"title":"TWSE [9] Bs4 + é‰…äº¨ç¶²","uri":"/twse-9-bs4-%E9%89%85%E4%BA%A8%E7%B6%B2/"},{"categories":["Python","TWSE"],"content":"åŸå§‹ç¢¼ print(soup) ","date":"2021-01-19","objectID":"/twse-9-bs4-%E9%89%85%E4%BA%A8%E7%B6%B2/:1:0","tags":["bs4","BeautifulSoup","urllib","html.parser"],"title":"TWSE [9] Bs4 + é‰…äº¨ç¶²","uri":"/twse-9-bs4-%E9%89%85%E4%BA%A8%E7%B6%B2/"},{"categories":["Python","TWSE"],"content":"æ–‡ç« ç¶²å€ æ‰¾åˆ° \u003ca\u003e...\u003c/a\u003e hrefs = soup.find_all('a') regex import regex as re for href in hrefs: if re.match('/news/id/', str(href.get('href'))): print('https://news.cnyes.com'+ str(href.get('href'))) å¤šå€‹URLå­˜æˆList urls = ['https://news.cnyes.com'+ str(href.get('href')) for href in hrefs if re.match('/news/id/', str(href.get('href')))] ","date":"2021-01-19","objectID":"/twse-9-bs4-%E9%89%85%E4%BA%A8%E7%B6%B2/:1:1","tags":["bs4","BeautifulSoup","urllib","html.parser"],"title":"TWSE [9] Bs4 + é‰…äº¨ç¶²","uri":"/twse-9-bs4-%E9%89%85%E4%BA%A8%E7%B6%B2/"},{"categories":["Python","TWSE"],"content":"å¤šå€‹URLçš„æ–‡ç« è§£æ data = urllib.request.urlopen(urls[0]) soup = BeautifulSoup(data, 'html.parser') æ‰¾å‡ºæ–‡ç« çš„æ¨™é¡Œ æ‰¾åˆ°\u003ch1\u003e...\u003c/h1\u003e title = soup.find('h1').getText() æ‰¾å‡ºæ–‡ç« çš„tags æ‰¾åˆ° \u003ca\u003e...\u003c/a\u003e tags = soup.find_all('a') for tag in tags: print(tag) tags = soup.find_all('a') for tag in tags: print(tag.get('href')) for tag in tags: if re.match('/tag/', str(tag.get('href'))): print(str(tag.get('href'))[5:len(str(tag.get('href')))]) tagså­˜æˆlist n_tags = [] for tag in tags: if re.match('/tag/', str(tag.get('href'))): n_tags = n_tags.append(str(tag.get('href'))[5:len(str(tag.get('href')))]) æ–‡ç« å…§æ–‡ æ‰¾åˆ° \u003cp\u003e...\u003c/p\u003e P = soup.find_all('p') print(P) å–\u003cp\u003e...\u003c/p\u003eçš„å…§æ–‡ for p in P: print(p.getText()) for i,p in zip(range(0,len(P)),P): if i \u003e=4: print(p.getText()) i += 1 åŒ…è£æˆdef def get_text(i): data = urllib.request.urlopen(urls[i]) soup = BeautifulSoup(data, 'html.parser') P = soup.find_all('p') text = '' for i,p in zip(range(0,len(P)),P): if i \u003e=4: text = text + p.getText() i += 1 tags = soup.find_all('a') n_tags = [] for tag in tags: if re.match('/tag/', str(tag.get('href'))): n_tags.append(str(tag.get('href'))[5:len(str(tag.get('href')))]) title = soup.find('h1').getText() return(title,n_tags,text) ","date":"2021-01-19","objectID":"/twse-9-bs4-%E9%89%85%E4%BA%A8%E7%B6%B2/:1:2","tags":["bs4","BeautifulSoup","urllib","html.parser"],"title":"TWSE [9] Bs4 + é‰…äº¨ç¶²","uri":"/twse-9-bs4-%E9%89%85%E4%BA%A8%E7%B6%B2/"},{"categories":["TWSE"],"content":"Freepik from www.flaticon.com plotly | Chart Studio ","date":"2021-01-16","objectID":"/twse-8-chartstudio-1/:0:0","tags":["TWSE","Plotly","Chart Studio"],"title":"TWSE [8] plotly | Chart Studio | 1","uri":"/twse-8-chartstudio-1/"},{"categories":["TWSE"],"content":"æ¯æ—¥æ”¶ç›¤è¡Œæƒ… ","date":"2021-01-16","objectID":"/twse-8-chartstudio-1/:1:0","tags":["TWSE","Plotly","Chart Studio"],"title":"TWSE [8] plotly | Chart Studio | 1","uri":"/twse-8-chartstudio-1/"},{"categories":["TWSE"],"content":"1 è¨»å†Šå¸³è™Ÿ ","date":"2021-01-16","objectID":"/twse-8-chartstudio-1/:1:1","tags":["TWSE","Plotly","Chart Studio"],"title":"TWSE [8] plotly | Chart Studio | 1","uri":"/twse-8-chartstudio-1/"},{"categories":["TWSE"],"content":"2 é»é¸SQL Query ","date":"2021-01-16","objectID":"/twse-8-chartstudio-1/:1:2","tags":["TWSE","Plotly","Chart Studio"],"title":"TWSE [8] plotly | Chart Studio | 1","uri":"/twse-8-chartstudio-1/"},{"categories":["TWSE"],"content":"3 ä¸‹è¼‰Falcon SQL Client ","date":"2021-01-16","objectID":"/twse-8-chartstudio-1/:1:3","tags":["TWSE","Plotly","Chart Studio"],"title":"TWSE [8] plotly | Chart Studio | 1","uri":"/twse-8-chartstudio-1/"},{"categories":["TWSE"],"content":"4 ç™»å…¥SQL è¼¸å…¥MySQLçš„å¸³è™Ÿ, å¯†ç¢¼ ","date":"2021-01-16","objectID":"/twse-8-chartstudio-1/:1:4","tags":["TWSE","Plotly","Chart Studio"],"title":"TWSE [8] plotly | Chart Studio | 1","uri":"/twse-8-chartstudio-1/"},{"categories":["TWSE"],"content":"5 é»é¸QUERY ç¢ºèªæœ‰ç¢ºå¯¦è®€åˆ°è³‡æ–™åº« ","date":"2021-01-16","objectID":"/twse-8-chartstudio-1/:1:5","tags":["TWSE","Plotly","Chart Studio"],"title":"TWSE [8] plotly | Chart Studio | 1","uri":"/twse-8-chartstudio-1/"},{"categories":["TWSE"],"content":"6 é»é¸SCHEDULE 1 é»é¸ Connect to / Chart Studio Enterprise / 2 Your Chart Studio Enterprise Domain / https://api.plot.ly / ","date":"2021-01-16","objectID":"/twse-8-chartstudio-1/:1:6","tags":["TWSE","Plotly","Chart Studio"],"title":"TWSE [8] plotly | Chart Studio | 1","uri":"/twse-8-chartstudio-1/"},{"categories":["TWSE"],"content":"7 Authorize ","date":"2021-01-16","objectID":"/twse-8-chartstudio-1/:1:7","tags":["TWSE","Plotly","Chart Studio"],"title":"TWSE [8] plotly | Chart Studio | 1","uri":"/twse-8-chartstudio-1/"},{"categories":["TWSE"],"content":"8 é»é¸QUERY SELECT `æ—¥æœŸ`,`æˆäº¤è‚¡æ•¸`,`é–‹ç›¤åƒ¹`,`æœ€é«˜åƒ¹`,`æœ€ä½åƒ¹`,`æ”¶ç›¤åƒ¹`,`color` FROM `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` WHERE `è­‰åˆ¸ä»£è™Ÿ` = 2330 ","date":"2021-01-16","objectID":"/twse-8-chartstudio-1/:1:8","tags":["TWSE","Plotly","Chart Studio"],"title":"TWSE [8] plotly | Chart Studio | 1","uri":"/twse-8-chartstudio-1/"},{"categories":["TWSE"],"content":"9 é¸æ“‡è¦å¤šä¹…è·‘ä¸€æ¬¡ ","date":"2021-01-16","objectID":"/twse-8-chartstudio-1/:1:9","tags":["TWSE","Plotly","Chart Studio"],"title":"TWSE [8] plotly | Chart Studio | 1","uri":"/twse-8-chartstudio-1/"},{"categories":["TWSE"],"content":"10 é»é¸Live DataSet ","date":"2021-01-16","objectID":"/twse-8-chartstudio-1/:1:10","tags":["TWSE","Plotly","Chart Studio"],"title":"TWSE [8] plotly | Chart Studio | 1","uri":"/twse-8-chartstudio-1/"},{"categories":["Python","TWSE"],"content":"Freepik from www.flaticon.com Interactive Candlestick Charts ","date":"2020-12-05","objectID":"/twse-7-interactive-candlestick-charts/:0:0","tags":["Python","TWSE","Plotly"],"title":"TWSE [7] Interactive Candlestick Charts","uri":"/twse-7-interactive-candlestick-charts/"},{"categories":["Python","TWSE"],"content":"Plotly pip install plotly ","date":"2020-12-05","objectID":"/twse-7-interactive-candlestick-charts/:1:0","tags":["Python","TWSE","Plotly"],"title":"TWSE [7] Interactive Candlestick Charts","uri":"/twse-7-interactive-candlestick-charts/"},{"categories":["Python","TWSE"],"content":"å€‹è‚¡æœˆæˆäº¤è³‡è¨Š ","date":"2020-12-05","objectID":"/twse-7-interactive-candlestick-charts/:2:0","tags":["Python","TWSE","Plotly"],"title":"TWSE [7] Interactive Candlestick Charts","uri":"/twse-7-interactive-candlestick-charts/"},{"categories":["Python","TWSE"],"content":"SQLé€£ç·š user = 'root' pw = \"YourPassworrd\" db = \"STOCK\" engine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=db)) df = pd.read_sql(\"SELECT* FROM `twse` WHERE `Stock Code` = 2330 \", engine, coerce_float=True, parse_dates=True) df = df.drop(columns = ['Stock Code','Change','Transaction','Trade Value']) df = df.rename(columns = {'Opening Price': 'Open','Highest Price':'High','Closing Price':'Close', 'Lowest Price':'Low','Closing Price':'Close','Trade Volume':'Volume'}) ","date":"2020-12-05","objectID":"/twse-7-interactive-candlestick-charts/:2:1","tags":["Python","TWSE","Plotly"],"title":"TWSE [7] Interactive Candlestick Charts","uri":"/twse-7-interactive-candlestick-charts/"},{"categories":["Python","TWSE"],"content":"Fig1 Basic fig = go.Figure(data=[go.Candlestick(x=df['Date'], open=df['Open'], high=df['High'], low=df['Low'], close=df['Close'])]) fig.write_html(r\"C:\\Users\\User\\Downloads\\Python\\1.html\") fig.show() fig.show() ","date":"2020-12-05","objectID":"/twse-7-interactive-candlestick-charts/:2:2","tags":["Python","TWSE","Plotly"],"title":"TWSE [7] Interactive Candlestick Charts","uri":"/twse-7-interactive-candlestick-charts/"},{"categories":["Python","TWSE"],"content":"Fig2 xaxis_rangeslider_visible=False fig = go.Figure(data=[go.Candlestick(x=df['Date'], open=df['Open'], high=df['High'], low=df['Low'], close=df['Close'])]) fig.update_layout(xaxis_rangeslider_visible=False) fig.write_html(r\"C:\\Users\\User\\Downloads\\Python\\2.html\") fig.show() fig.show() ","date":"2020-12-05","objectID":"/twse-7-interactive-candlestick-charts/:2:3","tags":["Python","TWSE","Plotly"],"title":"TWSE [7] Interactive Candlestick Charts","uri":"/twse-7-interactive-candlestick-charts/"},{"categories":["Python","TWSE"],"content":"Fig3 Color \u0026 Title fig = go.Figure(data=[go.Candlestick(x=df['Date'], open=df['Open'], high=df['High'], low=df['Low'], close=df['Close'], increasing_line_color= '#5ac390', decreasing_line_color= '#fd6a6c')]) fig.update_layout( title='TWSE Stock Code:2330', yaxis_title='Price', xaxis_rangeslider_visible=False) fig.write_html(r\"C:\\Users\\User\\Downloads\\Python\\3.html\") fig.show() ####ã€€fig.show() ","date":"2020-12-05","objectID":"/twse-7-interactive-candlestick-charts/:2:4","tags":["Python","TWSE","Plotly"],"title":"TWSE [7] Interactive Candlestick Charts","uri":"/twse-7-interactive-candlestick-charts/"},{"categories":["Python","TWSE"],"content":"æ¯æ—¥æ”¶ç›¤è¡Œæƒ… import plotly.graph_objects as go import pandas as pd ","date":"2020-12-05","objectID":"/twse-7-interactive-candlestick-charts/:3:0","tags":["Python","TWSE","Plotly"],"title":"TWSE [7] Interactive Candlestick Charts","uri":"/twse-7-interactive-candlestick-charts/"},{"categories":["Python","TWSE"],"content":"SQLé€£ç·š import sqlalchemy from sqlalchemy import create_engine user = 'root' pw = \"YourPassworrd\" db = \"TWSE\" engine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=db)) df = pd.read_sql(\"SELECT * FROM `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` WHERE `è­‰åˆ¸ä»£è™Ÿ` = 2330\", engine, coerce_float=True, parse_dates=True) ","date":"2020-12-05","objectID":"/twse-7-interactive-candlestick-charts/:3:1","tags":["Python","TWSE","Plotly"],"title":"TWSE [7] Interactive Candlestick Charts","uri":"/twse-7-interactive-candlestick-charts/"},{"categories":["Python","TWSE"],"content":"rename col /å¯åšå¯ä¸åš/ df = df.rename(columns = {'é–‹ç›¤åƒ¹': 'Open','æœ€é«˜åƒ¹':'High','æ”¶ç›¤åƒ¹':'Close','æœ€ä½åƒ¹':'Low','æ—¥æœŸ':'Date','æˆäº¤è‚¡æ•¸':'Volume'}) ","date":"2020-12-05","objectID":"/twse-7-interactive-candlestick-charts/:3:2","tags":["Python","TWSE","Plotly"],"title":"TWSE [7] Interactive Candlestick Charts","uri":"/twse-7-interactive-candlestick-charts/"},{"categories":["Python","TWSE"],"content":"Fig4 subplots from plotly.subplots import make_subplots fig = make_subplots(rows=2, cols=1) fig.add_trace(go.Candlestick(x=df['Date'], open=df['Open'], high=df['High'], low=df['Low'], close=df['Close'], increasing_line_color= '#3D9970', decreasing_line_color= '#FF4136', increasing_fillcolor='#3D9970', decreasing_fillcolor='#FF4136')) fig.add_trace(go.Bar(y=df['Volume'],x = df['Date'],marker = dict(color=df['color'])), row=2, col=1) fig.update_layout( paper_bgcolor='#EEEEEE', plot_bgcolor='#EEEEEE', title='TWSE\u003cbr\u003eStock Code:2330', yaxis_title='Price', xaxis_rangeslider_visible=False) fig.show() fig.show() ","date":"2020-12-05","objectID":"/twse-7-interactive-candlestick-charts/:3:3","tags":["Python","TWSE","Plotly"],"title":"TWSE [7] Interactive Candlestick Charts","uri":"/twse-7-interactive-candlestick-charts/"},{"categories":["Python","TWSE"],"content":"Fig5 Change subplot sizes trace1 = go.Candlestick(x=df['Date'], open=df['Open'], high=df['High'], low=df['Low'], close=df['Close'], increasing_line_color= '#3D9970', decreasing_line_color= '#FF4136', increasing_fillcolor='#3D9970', decreasing_fillcolor='#FF4136') trace2 = go.Bar(y=df['Volume'],x = df['Date'],marker = dict(color=df['color']),yaxis='y2') data = [trace1, trace2] layout = go.Layout(yaxis2=dict(domain=[0, 0.3]), yaxis=dict(domain=[0.35,1]), xaxis_rangeslider_visible=False, title='\u003cb\u003eTWSE\u003c/b\u003e\u003cbr\u003eStock Code:2330', title_x = 0.5, title_font_size = 20, paper_bgcolor='#EEEEEE', plot_bgcolor='#EEEEEE', showlegend = False, hovermode = 'x unified', hoverlabel_bgcolor = 'rgba(255,255,255,0.9)', hoverlabel_namelength = 0) fig = go.Figure(data=data, layout=layout) fig.show() fig.show() ","date":"2020-12-05","objectID":"/twse-7-interactive-candlestick-charts/:3:4","tags":["Python","TWSE","Plotly"],"title":"TWSE [7] Interactive Candlestick Charts","uri":"/twse-7-interactive-candlestick-charts/"},{"categories":["Python","TWSE"],"content":"Freepik from www.flaticon.com MySQL to Dataframe ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:0:0","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"SQLé€£ç·š user = 'root' pw = \"YourPassworrd\" conn=MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw,charset='utf8') cursor=conn.cursor() cursor.execute(\"CREATE DATABASE IF NOT EXISTS TWSE DEFAULT CHARSET=utf8 DEFAULT COLLATE=utf8_unicode_ci\" ) engine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=\"TWSE\")) df = pd.read_sql(\"SELECT* FROM `twse` WHERE `Stock Code` = 2330 AND `Date` BETWEEN '2019/11/10 00:00:00' AND '2020/1/10 23:59:59'\", engine, coerce_float=True, parse_dates=True) ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:1:0","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"è®€å–è³‡æ–™åº«Tableè‡³Dataframe import pandas as pd df = pd.read_sql('SELECT* FROM `twse`', engine, index_col= 'Stock Code', coerce_float=True, parse_dates='Date') df ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:2:0","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"1 å–å‡ºæŒ‡å®šcolå€¼ print(df.['Opening Price']) ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:2:1","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"2 å–å‡ºæŒ‡å®šindexå€¼ print(df.loc['2330']) ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:2:2","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"3 å–å‡ºæŒ‡å®šindex and colå€¼ print(df.loc['2330']['Opening Price']) ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:2:3","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"4 å–å‡ºå¤šå€‹colå€¼ df[['Opening Price', 'Closing Price']] ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:2:4","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"5 æ¬„ä½åç¨± df.columns ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:2:5","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"6 è³‡æ–™ df.values ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:2:6","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"7 æ¬„ä½Type df.dtypes ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:2:7","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"8 indexå€¼ df.index ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:2:8","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"9 é‡æ–°å‘½å df.rename(columns={'Opening Price': 'Open'}) ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:2:9","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"# å¯¦ä½œ è®€å–æŒ‡å®šindexå€¼è‡³Dataframe df = pd.read_sql('SELECT* FROM `twse`, engine, index_col= 'Stock Code', coerce_float=True, parse_dates='Date') ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:2:10","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"mplfinance [æ–°ç‰ˆ] pip install mplfinance import mplfinance as mpf ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:3:0","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"æ¯æ—¥æ”¶ç›¤è¡Œæƒ… SQLé€£ç·š user = 'root' pw = \"YourPassworrd\" conn=MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw,charset='utf8') cursor=conn.cursor() cursor.execute(\"CREATE DATABASE IF NOT EXISTS TWSE DEFAULT CHARSET=utf8 DEFAULT COLLATE=utf8_unicode_ci\" ) engine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=\"TWSE\")) df = pd.read_sql(\"SELECT* FROM `twse` WHERE `Stock Code` = 2330 AND `Date` BETWEEN '2019/11/10 00:00:00' AND '2020/1/10 23:59:59'\", engine, coerce_float=True, parse_dates=True) é‡æ–°èª¿æ•´Dataframe 1 åˆªæ‰å¤šé¤˜çš„Col df = df.drop(columns = ['Stock Code','Change','Transaction','Trade Value']) 2 é‡æ–°å‘½åCol df = df.rename(columns = {'Opening Price': 'Open','Highest Price':'High','Closing Price':'Close', 'Lowest Price':'Low','Closing Price':'Close','Trade Volume':'Volume'}) 3 df[â€˜Dateâ€™]å‹æ…‹æ”¹è®Š df['Date'] = pd.to_datetime(df['Date']) 4 é‡æ–°æ’åº neworder = ['Open','High','Low','Close','Volume'] df = df.reindex(columns=neworder) Candlestick chart åŸºæœ¬ mpf.plot(df,type='candle') ç¾åŒ– mc = mpf.make_marketcolors(up='#5ac390',down='#fd6a6c',volume='in',edge='None',) s = mpf.make_mpf_style(base_mpl_style='fivethirtyeight',gridstyle='None',marketcolors=mc) fig = mpf.figure(style=s,figsize=(20,20)) ax1 = fig.add_axes([0,0.3,1,0.4]) ax2 = fig.add_axes([0,0.1,1,0.2]) mav=(3,6,9) mpf.plot(df, type='candle', style=s, volume=ax2, mav=(3,6,9), panel_ratios=(4,1), xrotation=0, ax = ax1, update_width_config = dict(candle_width = 0.95), scale_width_adjustment = dict(lines=2)) ax1.legend(['mav '+str(mav[0]),'mav '+str(mav[1]),'mav '+str(mav[2])], loc='best', bbox_to_anchor=(0.2, 1.1), fontsize = 20, frameon = True, edgecolor = 'w', facecolor = 'w' ) ax1.set_title( label = '\\nTWSE\\n\\nStock Code:2330\\n', fontdict={'fontsize':30, 'fontweight':'bold', 'color':'k'}, loc='center' ) ax1.set_ylabel('Price',fontdict={'weight': 'bold', 'size': 20}) ax2.set_ylabel('Volume',fontdict={'weight': 'bold', 'size': 20}) ax1.yaxis.set_label_position(\"left\") ax1.yaxis.tick_left() yticks = np.arange(min(df['Volume']), max(df['Volume']), round( (max(df['Volume']) - min(df['Volume']))/5 )) ax2.set_yticks(yticks) ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:3:1","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"å…é€£SQLç‰ˆ import pandas_datareader.data as web import mplfinance as mpf from IPython.display import Image stock_code = '0050.tw' df = web.DataReader(stock_code, 'yahoo', '2020-11-01') df = df[['Open', 'High', 'Low', 'Close', 'Volume']] åŸºæœ¬ mpf.plot(df, type='candle', mav=(5,20), volume=True, title='\\n{stock_code}'.format(stock_code=stock_code), savefig='test_1.png') Image('test_1.png') ç¾åŒ– import matplotlib.pyplot as plt import numpy as np mc = mpf.make_marketcolors(up='#5ac390',down='#fd6a6c',volume='in',edge='None',) s = mpf.make_mpf_style(base_mpl_style='fivethirtyeight',gridstyle='None',marketcolors=mc) fig = mpf.figure(style=s,figsize=(20,15)) ax1 = fig.add_axes([0.05,0.3,0.95,0.5]) ax2 = fig.add_axes([0.05,0.1,0.95,0.2]) mav = (3,6,9) mpf.plot(df, type='candle', style=s, volume=ax2, mav=mav, panel_ratios=(4,1), xrotation=0, ax = ax1, update_width_config = dict(candle_width = 0.95), scale_width_adjustment = dict(lines=2)) ax1.legend(['mav '+str(mav[0]),'mav '+str(mav[1]),'mav '+str(mav[2])], loc='best', bbox_to_anchor=(0.2, 1.1), fontsize = 20, frameon = True, edgecolor = 'w', facecolor = 'w') ax1.set_title( label = '\\n\\nStock Code:{}\\n'.format(stock_code), fontdict={'fontsize':30, 'fontweight':'bold', 'color':'k'}, loc='center') ax1.set_xticks([]) ax1.set_ylabel('Price',fontdict={'weight': 'bold', 'size': 20}) ax2.set_ylabel('Volume',fontdict={'weight': 'bold', 'size': 20}) ax1.yaxis.set_label_position(\"left\") ax1.yaxis.tick_left() yticks = np.arange(min(df['Volume']), max(df['Volume']), round( (max(df['Volume']) - min(df['Volume']))/5 )) ax2.set_yticks(yticks) plt.savefig('test_2.png', dpi=300) MACD import matplotlib.pyplot as plt import numpy as np mc = mpf.make_marketcolors(up='#5ac390',down='#fd6a6c',volume='in',edge='None',) s = mpf.make_mpf_style(base_mpl_style='fivethirtyeight',gridstyle='None',marketcolors=mc) mc = mpf.make_marketcolors(up='#5ac390',down='#fd6a6c',volume='in',edge='None',) s = mpf.make_mpf_style(base_mpl_style='fivethirtyeight',gridstyle='None',marketcolors=mc) exp12 = df['Close'].ewm(span=12, adjust=False).mean() exp26 = df['Close'].ewm(span=26, adjust=False).mean() macd = exp12 - exp26 signal = macd.ewm(span=9, adjust=False).mean() histogram = macd - signal fig = plt.figure(figsize=(20,20)) ax1 = fig.add_axes([0.05,0.4,0.94,0.5]) ax2 = fig.add_axes([0.05,0.015,0.94,0.2]) ax3 = fig.add_axes([0.05,0.2,0.94,0.2]) strDate = [str(e).split(' ')[0] for e in df['Close'].index] plt.bar(strDate, histogram, color = '#7f7f7f') plt.plot(strDate, macd, color = 'b') plt.plot(strDate, signal, color = 'r') mav = (3,6,9) mpf.plot(df, type='candle', style=s, volume=ax2, mav=mav, panel_ratios=(4,1), xrotation=0, ax = ax1, update_width_config = dict(candle_width = 0.95), scale_width_adjustment = dict(lines=2)) ax1.legend(['mav '+str(mav[0]),'mav '+str(mav[1]),'mav '+str(mav[2])], loc='best', bbox_to_anchor=(0.2, 1.1), fontsize = 20, frameon = True, edgecolor = 'w', facecolor = 'w') ax3.legend(['macd','signal'], loc='best', bbox_to_anchor=(0.2, 1.1), fontsize = 20, frameon = True, edgecolor = 'w', facecolor = 'w') ax1.set_title( label = 'MACD\\n\\nStock Code:{}\\n'.format(stock_code), fontdict={'fontsize':30, 'fontweight':'bold', 'color':'k'}, loc='center') ax1.set_ylabel('Price',fontdict={'weight': 'bold', 'size': 20}) ax2.set_ylabel('Volume',fontdict={'weight': 'bold', 'size': 20}) ax1.yaxis.set_label_position(\"left\") ax1.yaxis.tick_left() yticks = np.arange(min(df['Volume']), max(df['Volume']), round( (max(df['Volume']) - min(df['Volume']))/5 )) ax2.set_yticks(yticks) ax1.set_xticks([]) ax3.set_xticks([]) ax1.set(frame_on=False) ax2.set(frame_on=False) ax3.set(frame_on=False) plt.savefig('test_3.png', dpi=300) ","date":"2020-11-29","objectID":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/:3:2","tags":["Python","TWSE","MySQL","mplfinance","dataframe","pd.read_sql"],"title":"TWSE [6] MySQL to Dataframe \u0026 mplfinance Kç·šåœ–","uri":"/twse-6-mysql-to-dataframe-mplfinance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"Freepik from www.flaticon.com mpl_finance [èˆŠç‰ˆ] ","date":"2020-11-29","objectID":"/twse-5-mpl_finance-k%E7%B7%9A%E5%9C%96/:0:0","tags":["Python","TWSE","MySQL","mpl_finance"],"title":"TWSE [5] mpl_finance Kç·šåœ–","uri":"/twse-5-mpl_finance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"SQLé€£ç·š ","date":"2020-11-29","objectID":"/twse-5-mpl_finance-k%E7%B7%9A%E5%9C%96/:1:0","tags":["Python","TWSE","MySQL","mpl_finance"],"title":"TWSE [5] mpl_finance Kç·šåœ–","uri":"/twse-5-mpl_finance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"å€‹è‚¡æœˆæˆäº¤è³‡è¨Š import MySQLdb user = 'root' pw = \"YourPassworrd\" conn=MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw,charset='utf8') cursor=conn.cursor() cursor.execute('USE STOCK') ","date":"2020-11-29","objectID":"/twse-5-mpl_finance-k%E7%B7%9A%E5%9C%96/:1:1","tags":["Python","TWSE","MySQL","mpl_finance"],"title":"TWSE [5] mpl_finance Kç·šåœ–","uri":"/twse-5-mpl_finance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"mpl_finance import matplotlib.pyplot as plt import mpl_finance as mpf %matplotlib inline ","date":"2020-11-29","objectID":"/twse-5-mpl_finance-k%E7%B7%9A%E5%9C%96/:2:0","tags":["Python","TWSE","MySQL","mpl_finance"],"title":"TWSE [5] mpl_finance Kç·šåœ–","uri":"/twse-5-mpl_finance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"åŸºæœ¬è¨­å®š p = [int(e) for e in input(\"è«‹è¼¸å…¥èµ·å§‹æ—¥æœŸå’ŒçµæŸæ—¥æœŸ\").split(\" \")] # ä»¥ç©ºæ ¼éš”é–‹ period = \"`Date` BETWEEN '{}/{}/{} 00:00:00' AND '{}/{}/{} 23:59:59'\".format(p[0],p[1],p[2],p[3],p[4],p[5]) def sql_execute(column_name): SQL = \"SELECT {} FROM `twse` WHERE `Stock Code` = {} AND {} ORDER BY `Date`\" cursor.execute(SQL.format(column_name, 1234, period)) result = cursor.fetchall() return result def get_data(column_name): sql_data = [e[0] for e in sql_execute(column_name)] return sql_data ","date":"2020-11-29","objectID":"/twse-5-mpl_finance-k%E7%B7%9A%E5%9C%96/:3:0","tags":["Python","TWSE","MySQL","mpl_finance"],"title":"TWSE [5] mpl_finance Kç·šåœ–","uri":"/twse-5-mpl_finance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"å®Œæ•´ç¨‹å¼ç¢¼ import MySQLdb import matplotlib.pyplot as plt import mpl_finance as mpf %matplotlib inline user = 'root' pw = \"YourPassworrd\" conn=MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw,charset='utf8') cursor=conn.cursor() cursor.execute('USE STOCK') p = [int(e) for e in input(\"è«‹è¼¸å…¥èµ·å§‹æ—¥æœŸå’ŒçµæŸæ—¥æœŸ\").split(\" \")] period = \"`Date` BETWEEN '{}/{}/{} 00:00:00' AND '{}/{}/{} 23:59:59'\".format(p[0],p[1],p[2],p[3],p[4],p[5]) def get_data(column_name): sql_data = [e[0] for e in sql_execute(column_name)] return sql_data def sql_execute(column_name): SQL = \"SELECT {} FROM `twse` WHERE `Stock Code` = {} AND {} ORDER BY `Date`\" cursor.execute(SQL.format(column_name, 1234, period)) result = cursor.fetchall() return result op = get_data('`Opening Price`') cp = get_data('`Closing Price`') h = get_data('`Highest Price`') l = get_data('`Lowest Price`') D = [e[0] for e in sql_execute('`Date`')] fig = plt.figure(figsize=(20, 8)) ax = fig.add_subplot(1, 1, 1) ax.set_xticks(range(0, len(D), int(round(len(D)/7,0)))) ax.set_xticklabels(D[::int(round(len(D)/7,0))]) mpf.candlestick2_ochl(ax, op, cp, h, l, width=0.6, colorup='r', colordown='g', alpha=1); Icons made by Freepik from www.flaticon.com","date":"2020-11-29","objectID":"/twse-5-mpl_finance-k%E7%B7%9A%E5%9C%96/:4:0","tags":["Python","TWSE","MySQL","mpl_finance"],"title":"TWSE [5] mpl_finance Kç·šåœ–","uri":"/twse-5-mpl_finance-k%E7%B7%9A%E5%9C%96/"},{"categories":["Python","TWSE"],"content":"Freepik from www.flaticon.com TWSEçš„è³‡æ–™å­˜å…¥MySQL ","date":"2020-11-29","objectID":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/:0:0","tags":["Python","TWSE","dataframe","df.to_sql","MySQL"],"title":"TWSE [4] è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","uri":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/"},{"categories":["Python","TWSE"],"content":"SQLé€£ç·š ","date":"2020-11-29","objectID":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/:1:0","tags":["Python","TWSE","dataframe","df.to_sql","MySQL"],"title":"TWSE [4] è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","uri":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/"},{"categories":["Python","TWSE"],"content":"1 åŸºæœ¬è¨­å®š import MySQLdb user = 'root' pw = \"YourPassworrd\" ","date":"2020-11-29","objectID":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/:1:1","tags":["Python","TWSE","dataframe","df.to_sql","MySQL"],"title":"TWSE [4] è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","uri":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/"},{"categories":["Python","TWSE"],"content":"2 ä¸ä½¿ç”¨ä¸­æ–‡ conn = MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw) cursor=conn.cursor() ","date":"2020-11-29","objectID":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/:1:2","tags":["Python","TWSE","dataframe","df.to_sql","MySQL"],"title":"TWSE [4] è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","uri":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/"},{"categories":["Python","TWSE"],"content":"3 å¯ä½¿ç”¨ä¸­æ–‡ / charset=â€˜utf8â€™ / conn=MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw,charset='utf8') cursor=conn.cursor() ","date":"2020-11-29","objectID":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/:1:3","tags":["Python","TWSE","dataframe","df.to_sql","MySQL"],"title":"TWSE [4] è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","uri":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/"},{"categories":["Python","TWSE"],"content":"create_engine ","date":"2020-11-29","objectID":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/:2:0","tags":["Python","TWSE","dataframe","df.to_sql","MySQL"],"title":"TWSE [4] è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","uri":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/"},{"categories":["Python","TWSE"],"content":"pymysql sqlalchemy pip install pymysql sqlalchemy from sqlalchemy import create_engine engine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=\"STOCK\")) ","date":"2020-11-29","objectID":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/:2:1","tags":["Python","TWSE","dataframe","df.to_sql","MySQL"],"title":"TWSE [4] è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","uri":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/"},{"categories":["Python","TWSE"],"content":"å€‹è‚¡æœˆæˆäº¤è³‡è¨Š/en/ ","date":"2020-11-29","objectID":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/:3:0","tags":["Python","TWSE","dataframe","df.to_sql","MySQL"],"title":"TWSE [4] è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","uri":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/"},{"categories":["Python","TWSE"],"content":"å®Œæ•´ç¨‹å¼ç¢¼ import urllib.request, json import json import time import datetime import pandas as pd from sqlalchemy import create_engine import MySQLdb user = 'root' pw = \"YourPassworrd\" engine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=\"STOCK\")) conn = MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw) cursor=conn.cursor() create_table = ''' `Stock Code` varchar(20) NOT NULL, `Date` date NOT NULL, `Trade Volume` bigint(20) NOT NULL, `Trade Value` bigint(20) NOT NULL, `Opening Price` float NOT NULL, `Highest Price` float NOT NULL, `Lowest Price` float NOT NULL, `Closing Price` float NOT NULL, `Change` float NOT NULL, `Transaction` bigint(20) NOT NULL ''' cursor.execute(\"CREATE DATABASE IF NOT EXISTS STOCK DEFAULT CHARSET=utf8 DEFAULT COLLATE=utf8_unicode_ci\" ) cursor.execute('USE STOCK') cursor.execute('''CREATE TABLE IF NOT EXISTS TWSE ({})'''.format(create_table)) cursor.execute('ALTER TABLE TWSE RENAME TO TWSE_tempt') conn.commit() data ={} date_now = datetime.datetime.now() stock_list = [2330,1234] m = int(input(\"è«‹è¼¸å…¥æ¬²æŠ“å–æœˆä»½æ•¸\"))-1 for j in range(0,len(stock_list)): for i in range (m,-1,-1): date = date_now - i*datetime.timedelta(days = 30.4375) url = \"http://www.twse.com.tw/en/exchangeReport/STOCK_DAY?response=jsn\u0026date={}\u0026stockNo={}\".format(str(date).split(' ')[0].replace('-',''),stock_list[j]) with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) df = pd.DataFrame(data['data'][0:len(data['data'])]) df.columns = data['fields'] df[\"Stock Code\"] = stock_list[j] df = df.set_index('Stock Code') df = df.applymap(lambda x: str(x.replace(',',''))) df.to_sql('TWSE_tempt', con = engine, if_exists = 'append', index=True) time.sleep(10) print(\"[Stock Code: #{}][{}] loading......\".format(str(stock_list[j]),data['title'].split(\" \")[0])) cursor.execute('CREATE TABLE TWSE ({})'.format(create_table)) cursor.execute('''INSERT INTO TWSE SELECT* FROM TWSE_tempt GROUP BY `Stock Code`, `Date` HAVING count(*)\u003e0''') cursor.execute('DROP TABLE TWSE_tempt') conn.commit() conn.close() print(\"All done ! ! !\") ","date":"2020-11-29","objectID":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/:3:1","tags":["Python","TWSE","dataframe","df.to_sql","MySQL"],"title":"TWSE [4] è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","uri":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/"},{"categories":["Python","TWSE"],"content":"æ¯æ—¥æ”¶ç›¤è¡Œæƒ… ","date":"2020-11-29","objectID":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/:4:0","tags":["Python","TWSE","dataframe","df.to_sql","MySQL"],"title":"TWSE [4] è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","uri":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/"},{"categories":["Python","TWSE"],"content":"å®Œæ•´ç¨‹å¼ç¢¼ import urllib.request, json import json import time import datetime import pandas as pd from sqlalchemy import create_engine import MySQLdb user = 'root' pw = \"YourPassworrd\" conn=MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw,charset='utf8') cursor=conn.cursor() cursor.execute(\"CREATE DATABASE IF NOT EXISTS TWSE DEFAULT CHARSET=utf8 DEFAULT COLLATE=utf8_unicode_ci\" ) engine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=\"TWSE\")) create_table = ''' `è­‰åˆ¸ä»£è™Ÿ` varchar(20) NOT NULL, `è­‰åˆ¸åç¨±` varchar(20) NOT NULL, `æˆäº¤è‚¡æ•¸` bigint(20), `æˆäº¤ç­†æ•¸` bigint(20), `æˆäº¤é‡‘é¡` float, `é–‹ç›¤åƒ¹` float NOT NULL, `æœ€é«˜åƒ¹` float NOT NULL, `æœ€ä½åƒ¹` float NOT NULL, `æ”¶ç›¤åƒ¹` float NOT NULL, `æ¼²è·Œåƒ¹å·®` float, `æœ€å¾Œæ­ç¤ºè²·åƒ¹` float, `æœ€å¾Œæ­ç¤ºè²·é‡` float, `æœ€å¾Œæ­ç¤ºè³£åƒ¹` float, `æœ€å¾Œæ­ç¤ºè³£é‡` bigint(20), `æœ¬ç›Šæ¯”` float, `æ—¥æœŸ` date NOT NULL ''' cursor.execute('USE TWSE') cursor.execute('''CREATE TABLE IF NOT EXISTS `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` ({})'''.format(create_table)) cursor.execute('ALTER TABLE `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` RENAME TO `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…_tempt`') date = datetime.datetime.now() n = int(input('æŠ“å–næ—¥è³‡æ–™')) for i in range(n): url = \"https://www.twse.com.tw/exchangeReport/MI_INDEX?response=jsn\u0026date={}\u0026type=ALL\".format(str(date).split(' ')[0].replace('-','')) with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) if data['stat'] ==\"OK\": df = pd.DataFrame(data['data9'][0:len(data['data9'])]) df.columns = data['fields9'] df = df.drop(columns = 'æ¼²è·Œ(+/-)') df = df.set_index('è­‰åˆ¸ä»£è™Ÿ') df = df.applymap(lambda x: str(x.replace(',',''))) df[\"æ—¥æœŸ\"] = str(date).split(' ')[0].replace('-','/') df.to_sql('æ¯æ—¥æ”¶ç›¤è¡Œæƒ…_tempt', con = engine, if_exists = 'append', index=True) print(url) time.sleep(4) else: print(data['stat']) date = date - datetime.timedelta(days = 1) cursor.execute('CREATE TABLE `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` ({})'.format(create_table)) cursor.execute('''INSERT INTO `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` SELECT* FROM `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…_tempt` GROUP BY `è­‰åˆ¸ä»£è™Ÿ`, `æ—¥æœŸ` HAVING count(*)\u003e0''') cursor.execute('DROP TABLE `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…_tempt`') conn.commit() conn.close() print(\"All done ! ! !\") ","date":"2020-11-29","objectID":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/:4:1","tags":["Python","TWSE","dataframe","df.to_sql","MySQL"],"title":"TWSE [4] è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","uri":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/"},{"categories":["Python","TWSE"],"content":"å–å‡ºè³‡æ–™ ","date":"2020-11-29","objectID":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/:5:0","tags":["Python","TWSE","dataframe","df.to_sql","MySQL"],"title":"TWSE [4] è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","uri":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/"},{"categories":["Python","TWSE"],"content":"å€‹è‚¡æœˆæˆäº¤è³‡è¨Š 1 å›å‚³å…¨éƒ¨ cursor.fetchall() 2 å›å‚³ä¸€å€‹å€¼ cursor.fetchone() 3 å›å‚³å¤šå€‹å€¼ cursor.fetchmany() 4 å¯¦éš›ä½¿ç”¨ cursor.execute(\"SELECT `Opening Price` FROM `twse` where `Stock Code` = 2330\") result = cursor.fetchall() print(result) 5 resultå‹æ…‹ print(type(result)) tuple print(result[1][0]) 6 å–å‡ºç‰¹å®šæ™‚é–“å…§è³‡æ–™ å›å‚³ Opening Price Date BETWEEN 2019/10/10 ~ 2020/1/10 cursor.execute(\"SELECT `Opening Price` FROM `twse` WHERE `Stock Code` = 2330 AND `Date` BETWEEN '2019/10/10 00:00:00' AND '2020/1/10 23:59:59'\") result = cursor.fetchall() print(result) ","date":"2020-11-29","objectID":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/:5:1","tags":["Python","TWSE","dataframe","df.to_sql","MySQL"],"title":"TWSE [4] è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","uri":"/twse-4-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5mysql/"},{"categories":["Python","TWSE"],"content":"Freepik from www.flaticon.com TWSEçš„è³‡æ–™å­˜å…¥SQLite ","date":"2020-11-28","objectID":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/:0:0","tags":["Python","TWSE","dataframe","df.to_sql","SQLite"],"title":"TWSE [3] è³‡æ–™å­˜å…¥SQLite","uri":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/"},{"categories":["Python","TWSE"],"content":"å€‹è‚¡æœˆæˆäº¤è³‡è¨Š ","date":"2020-11-28","objectID":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/:1:0","tags":["Python","TWSE","dataframe","df.to_sql","SQLite"],"title":"TWSE [3] è³‡æ–™å­˜å…¥SQLite","uri":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/"},{"categories":["Python","TWSE"],"content":"1 SQLiteé€£ç·š import sqlite3 conn = sqlite3.connect('Python_Stock_TWSE.db') c = conn.cursor() ","date":"2020-11-28","objectID":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/:1:1","tags":["Python","TWSE","dataframe","df.to_sql","SQLite"],"title":"TWSE [3] è³‡æ–™å­˜å…¥SQLite","uri":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/"},{"categories":["Python","TWSE"],"content":"2 å»ºç«‹Table c.execute('CREATE TABLE IF NOT EXISTS TWSE2330_tempt (è‚¡ç¥¨ä»£ç¢¼, æ—¥æœŸ, æˆäº¤è‚¡æ•¸, æˆäº¤é‡‘é¡, é–‹ç›¤åƒ¹, æœ€é«˜åƒ¹, æœ€ä½åƒ¹, æ”¶ç›¤åƒ¹, æ¼²è·Œåƒ¹å·®, æˆäº¤ç­†æ•¸)') ","date":"2020-11-28","objectID":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/:1:2","tags":["Python","TWSE","dataframe","df.to_sql","SQLite"],"title":"TWSE [3] è³‡æ–™å­˜å…¥SQLite","uri":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/"},{"categories":["Python","TWSE"],"content":"3 åˆªé™¤Table c.execute('DROP TABLE TWSE2330_tempt') ","date":"2020-11-28","objectID":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/:1:3","tags":["Python","TWSE","dataframe","df.to_sql","SQLite"],"title":"TWSE [3] è³‡æ–™å­˜å…¥SQLite","uri":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/"},{"categories":["Python","TWSE"],"content":"# å®Œæ•´ç¨‹å¼ç¢¼ import pandas as pd import urllib.request, json import datetime import time import sqlite3 conn = sqlite3.connect('Python_Stock_TWSE.db') c = conn.cursor() c.execute('CREATE TABLE IF NOT EXISTS TWSE (è‚¡ç¥¨ä»£ç¢¼ int, æ—¥æœŸ date, æˆäº¤è‚¡æ•¸ float, æˆäº¤é‡‘é¡ float, é–‹ç›¤åƒ¹ float, æœ€é«˜åƒ¹ float, æœ€ä½åƒ¹ float, æ”¶ç›¤åƒ¹ float, æ¼²è·Œåƒ¹å·® float, æˆäº¤ç­†æ•¸ float)') conn.commit() date_now = datetime.datetime.now() stock_list = [2330,1234] m = int(input(\"è«‹è¼¸å…¥æ¬²æŠ“å–æœˆä»½æ•¸\"))-1 for j in range(0,len(stock_list)): for i in range (m,-1,-1): date = date_now - i*datetime.timedelta(days = 30.4375) url = \"http://www.twse.com.tw/exchangeReport/STOCK_DAY?response=jsn\u0026date={}\u0026stockNo={}\".format(str(date).split(' ')[0].replace('-',''),stock_list[j]) with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) df = pd.DataFrame(data['data'][0:len(data['data'])]) df.columns = data['fields'] df[\"è‚¡ç¥¨ä»£ç¢¼\"] = stock_list[j] df = df.set_index('è‚¡ç¥¨ä»£ç¢¼') df.to_sql('TWSE', conn, if_exists='append', index = True) conn.commit() print(\"[#{}] {} is loading...\".format(stock_list[j], data['date'])) time.sleep(5) conn.close() print(\"Done\") ","date":"2020-11-28","objectID":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/:1:4","tags":["Python","TWSE","dataframe","df.to_sql","SQLite"],"title":"TWSE [3] è³‡æ–™å­˜å…¥SQLite","uri":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/"},{"categories":["Python","TWSE"],"content":"è³‡æ–™åº«è³‡æ–™é‡è¤‡å•é¡Œè§£æ±º ","date":"2020-11-28","objectID":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/:2:0","tags":["Python","TWSE","dataframe","df.to_sql","SQLite"],"title":"TWSE [3] è³‡æ–™å­˜å…¥SQLite","uri":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/"},{"categories":["Python","TWSE"],"content":"1 é¸å‡ºæ²’æœ‰é‡è¤‡çš„è³‡æ–™ SELECT* FROM TWSE GROUP BY è‚¡ç¥¨ä»£ç¢¼, æ—¥æœŸ HAVING count(*)\u003e0 ","date":"2020-11-28","objectID":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/:2:1","tags":["Python","TWSE","dataframe","df.to_sql","SQLite"],"title":"TWSE [3] è³‡æ–™å­˜å…¥SQLite","uri":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/"},{"categories":["Python","TWSE"],"content":"2 TWSE_temptç•¶ä½œç·©å­˜ å°‡TWSEæ”¹æˆTWSE_temptç•¶ä½œç·©å­˜ ï¼Œå†æ–°å¢ä¸€å€‹TWSE INSERT INTO TWSE SELECT* FROM TWSE_tempt GROUP BY è‚¡ç¥¨ä»£ç¢¼, æ—¥æœŸ HAVING count(*)\u003e0 c.execute('''INSERT INTO TWSE SELECT* FROM TWSE_tempt GROUP BY è‚¡ç¥¨ä»£ç¢¼, æ—¥æœŸ HAVING count(*)\u003e0''') ","date":"2020-11-28","objectID":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/:2:2","tags":["Python","TWSE","dataframe","df.to_sql","SQLite"],"title":"TWSE [3] è³‡æ–™å­˜å…¥SQLite","uri":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/"},{"categories":["Python","TWSE"],"content":"# å®Œæ•´ç¨‹å¼ç¢¼ import pandas as pd import urllib.request, json import datetime import time import sqlite3 conn = sqlite3.connect('Python_Stock_TWSE.db') c = conn.cursor() c.execute('CREATE TABLE IF NOT EXISTS TWSE (è‚¡ç¥¨ä»£ç¢¼ int, æ—¥æœŸ date, æˆäº¤è‚¡æ•¸ float, æˆäº¤é‡‘é¡ float, é–‹ç›¤åƒ¹ float, æœ€é«˜åƒ¹ float, æœ€ä½åƒ¹ float, æ”¶ç›¤åƒ¹ float, æ¼²è·Œåƒ¹å·® float, æˆäº¤ç­†æ•¸ float)') c.execute('ALTER TABLE TWSE RENAME TO TWSE_tempt') conn.commit() date_now = datetime.datetime.now() stock_list = [2330,1234] m = int(input(\"è«‹è¼¸å…¥æ¬²æŠ“å–æœˆä»½æ•¸\"))-1 for j in range(0,len(stock_list)): for i in range (m,-1,-1): date = date_now - i*datetime.timedelta(days = 30.4375) url = \"http://www.twse.com.tw/exchangeReport/STOCK_DAY?response=jsn\u0026date={}\u0026stockNo={}\".format(str(date).split(' ')[0].replace('-',''),stock_list[j]) with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) df = pd.DataFrame(data['data'][0:len(data['data'])]) df.columns = data['fields'] df[\"è‚¡ç¥¨ä»£ç¢¼\"] = stock_list[j] df = df.set_index('è‚¡ç¥¨ä»£ç¢¼') df.to_sql('TWSE_tempt', conn, if_exists='append', index = True) print(\"[{}] Month: {} is loading......\".format(str(stock_list[j]),str(date).split('-')[1])) time.sleep(5) c.execute('CREATE TABLE TWSE (è‚¡ç¥¨ä»£ç¢¼ int, æ—¥æœŸ date, æˆäº¤è‚¡æ•¸ float, æˆäº¤é‡‘é¡ float, é–‹ç›¤åƒ¹ float, æœ€é«˜åƒ¹ float, æœ€ä½åƒ¹ float, æ”¶ç›¤åƒ¹ float, æ¼²è·Œåƒ¹å·® float, æˆäº¤ç­†æ•¸ float)') c.execute('''INSERT INTO TWSE SELECT* FROM TWSE_tempt GROUP BY è‚¡ç¥¨ä»£ç¢¼, æ—¥æœŸ HAVING count(*)\u003e0''') c.execute('DROP TABLE TWSE_tempt') print(\"Done\") conn.commit() conn.close() ","date":"2020-11-28","objectID":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/:2:3","tags":["Python","TWSE","dataframe","df.to_sql","SQLite"],"title":"TWSE [3] è³‡æ–™å­˜å…¥SQLite","uri":"/twse-3-%E8%B3%87%E6%96%99%E5%AD%98%E5%85%A5sqlite/"},{"categories":["Python","TWSE"],"content":"Freepik from www.flaticon.com DataFrameå­˜å…¥CSVæª” ","date":"2020-11-28","objectID":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/:0:0","tags":["Python","TWSE","dataframe","df.to_csv"],"title":"TWSE [2] å°‡DataFrameå­˜å…¥CSVæª” \u0026 æŠ“å–å¤šç­†è³‡æ–™","uri":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/"},{"categories":["Python","TWSE"],"content":"å€‹è‚¡æœˆæˆäº¤è³‡è¨Š ","date":"2020-11-28","objectID":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/:1:0","tags":["Python","TWSE","dataframe","df.to_csv"],"title":"TWSE [2] å°‡DataFrameå­˜å…¥CSVæª” \u0026 æŠ“å–å¤šç­†è³‡æ–™","uri":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/"},{"categories":["Python","TWSE"],"content":"1 ç›¸å°è·¯å¾‘ df.to_csv('æª”æ¡ˆåç¨±.csv') ","date":"2020-11-28","objectID":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/:1:1","tags":["Python","TWSE","dataframe","df.to_csv"],"title":"TWSE [2] å°‡DataFrameå­˜å…¥CSVæª” \u0026 æŠ“å–å¤šç­†è³‡æ–™","uri":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/"},{"categories":["Python","TWSE"],"content":"2 çµ•å°è·¯å¾‘ df.to_csv (r'è·¯å¾‘\\æª”æ¡ˆåç¨±.csv') ","date":"2020-11-28","objectID":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/:1:2","tags":["Python","TWSE","dataframe","df.to_csv"],"title":"TWSE [2] å°‡DataFrameå­˜å…¥CSVæª” \u0026 æŠ“å–å¤šç­†è³‡æ–™","uri":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/"},{"categories":["Python","TWSE"],"content":"3 å–å¾—è·¯å¾‘ import os os.getcwd() ","date":"2020-11-28","objectID":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/:1:3","tags":["Python","TWSE","dataframe","df.to_csv"],"title":"TWSE [2] å°‡DataFrameå­˜å…¥CSVæª” \u0026 æŠ“å–å¤šç­†è³‡æ–™","uri":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/"},{"categories":["Python","TWSE"],"content":"4 df.to_csv ä½¿ç”¨ 1 ä»¥\"/â€œéš”é–‹ df.to_csv ('æª”æ¡ˆåç¨±.csv', sep='/') 2 å°‡æª”æ¡ˆé‡è¤‡å¯«å…¥ df.to_csv ('æª”æ¡ˆåç¨±.csv', mode = 'a') 3 æ›¿æ›ç©ºå€¼ df.to_csv ('æª”æ¡ˆåç¨±.csv', na_rep='NA') 4 å°æ•¸4ä½ df.to_csv ('æª”æ¡ˆåç¨±.csv', float_format='%.4f') 5 ä¸ä¿ç•™åˆ—åheader df.to_csv ('æª”æ¡ˆåç¨±.csv', header=0) 6 ä¸ä¿ç•™å¼•ç´¢å€¼index df.to_csv ('æª”æ¡ˆåç¨±.csv', index=0) # å®Œæ•´ç¨‹å¼ç¢¼ import pandas as pd import urllib.request, json import time stock_list = [1101,1234,2330,2337] date = 20200813 for j in range(0,len(stock_list)): url = \"http://www.twse.com.tw/en/exchangeReport/STOCK_DAY?response=jsn\u0026date={}\u0026stockNo={}\".format(date,stock_list[j]) with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) stock_data.append(data) df = pd.DataFrame(data['data'][0:len(data['data'])]) df.columns = data['fields'] df[\"Stock Code\"] = stock_list[j] df = df.set_index('Stock Code') df = df.applymap(lambda x: str(x.replace(',',''))) print(\"[#{}] {} is loading...\".format(stock_list[j], data['date'])) df.to_csv (r'C:\\Users\\User\\Downloads\\Python\\Python_Stock_TWSE_type = 2330.csv', mode='a', header=0) time.sleep(5) ","date":"2020-11-28","objectID":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/:1:4","tags":["Python","TWSE","dataframe","df.to_csv"],"title":"TWSE [2] å°‡DataFrameå­˜å…¥CSVæª” \u0026 æŠ“å–å¤šç­†è³‡æ–™","uri":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/"},{"categories":["Python","TWSE"],"content":"æŠ“å–å¤šç­†è³‡æ–™ ","date":"2020-11-28","objectID":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/:2:0","tags":["Python","TWSE","dataframe","df.to_csv"],"title":"TWSE [2] å°‡DataFrameå­˜å…¥CSVæª” \u0026 æŠ“å–å¤šç­†è³‡æ–™","uri":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/"},{"categories":["Python","TWSE"],"content":"å€‹è‚¡æœˆæˆäº¤è³‡è¨Š import urllib.request, json import datetime import pandas as pd date_now = datetime.datetime.now() stock_list = [2330,1234] m = int(input(\"è«‹è¼¸å…¥æ¬²æŠ“å–æœˆä»½æ•¸\"))-1 for j in range(0,len(stock_list)): for i in range (m,-1,-1): date = date_now - i*datetime.timedelta(days = 30.4375) url = \"http://www.twse.com.tw/exchangeReport/STOCK_DAY?response=jsn\u0026date={}\u0026stockNo={}\".format(str(date).split(' ')[0].replace('-',''),stock_list[j]) with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) df = pd.DataFrame(data['data'][0:len(data['data'])]) df.columns = data['fields'] df[\"è‚¡ç¥¨ä»£ç¢¼\"] = stock_list[j] df = df.set_index('è‚¡ç¥¨ä»£ç¢¼') print(df) ","date":"2020-11-28","objectID":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/:2:1","tags":["Python","TWSE","dataframe","df.to_csv"],"title":"TWSE [2] å°‡DataFrameå­˜å…¥CSVæª” \u0026 æŠ“å–å¤šç­†è³‡æ–™","uri":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/"},{"categories":["Python","TWSE"],"content":"æ¯æ—¥æ”¶ç›¤è¡Œæƒ… import urllib.request, json import datetime import time import pandas as pd date = datetime.datetime.now() n = int(input('æŠ“å–næ—¥è³‡æ–™')) for i in range(n): url = \"https://www.twse.com.tw/exchangeReport/MI_INDEX?response=jsn\u0026date={}\u0026type=ALL\".format(str(date).split(' ')[0].replace('-','')) with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) if data['stat'] ==\"OK\": df = pd.DataFrame(data['data9'][0:len(data['data9'])]) df.columns = data['fields9'] print(url) time.sleep(4) else: print(data['stat']) date = date - datetime.timedelta(days = 1) ","date":"2020-11-28","objectID":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/:2:2","tags":["Python","TWSE","dataframe","df.to_csv"],"title":"TWSE [2] å°‡DataFrameå­˜å…¥CSVæª” \u0026 æŠ“å–å¤šç­†è³‡æ–™","uri":"/twse-2-%E5%B0%87dataframe%E5%AD%98%E5%85%A5csv%E6%AA%94/"},{"categories":["Python","TWSE"],"content":"               ","date":"2020-11-27","objectID":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/","tags":["Python","TWSE","jsn","dataframe"],"title":"TWSE [1] jsnæª”è§£æ","uri":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/"},{"categories":["Python","TWSE"],"content":"Freepik from www.flaticon.com ","date":"2020-11-27","objectID":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/:0:0","tags":["Python","TWSE","jsn","dataframe"],"title":"TWSE [1] jsnæª”è§£æ","uri":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/"},{"categories":["Python","TWSE"],"content":"TWSEè‚¡ç¥¨è³‡æ–™ ","date":"2020-11-27","objectID":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/:1:0","tags":["Python","TWSE","jsn","dataframe"],"title":"TWSE [1] jsnæª”è§£æ","uri":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/"},{"categories":["Python","TWSE"],"content":"1 å€‹è‚¡æœˆæˆäº¤è³‡è¨Š å€‹è‚¡æœˆæˆäº¤è³‡è¨Šä»¥å°ç©é›»2330ç‚ºä¾‹ é»é¸ åˆ—å°/HTML æ›´æ”¹ html ç‚º jsn æ›´æ”¹ 20200813ç‚º 20200713ï¼Œå³å¯æ‰¾åˆ°7æœˆè³‡æ–™ æ›´æ”¹ stockNo=2330 ç‚º stockNo=1234ï¼Œå³å¯æ‰¾åˆ°é»‘æ¾äº¤æ˜“è³‡ https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=jsn\u0026date=20200713\u0026stockNo=2330 https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=jsn\u0026date=20200713\u0026stockNo=1234 åœ¨exchangeReportå‰åŠ ä¸Š /en/ è½‰æ›æˆè‹±æ–‡ç‰ˆ https://www.twse.com.tw/en/exchangeReport/STOCK_DAY?response=jsn\u0026date=20200713\u0026stockNo=1234 stock_list = [1234, 2330] date = 20200813 for j in range(0,len(stock_list)): url = \"http://www.twse.com.tw/en/exchangeReport/STOCK_DAY?response=jsn\u0026date={}\u0026stockNo={}\".format(date,stock_list[j]) print(url) `` ","date":"2020-11-27","objectID":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/:1:1","tags":["Python","TWSE","jsn","dataframe"],"title":"TWSE [1] jsnæª”è§£æ","uri":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/"},{"categories":["Python","TWSE"],"content":"2 æ¯æ—¥æ”¶ç›¤è¡Œæƒ… æ¯æ—¥æ”¶ç›¤è¡Œæƒ…-å…¨éƒ¨ é»é¸ åˆ—å°/HTML æ›´æ”¹ html ç‚º jsn æ›´æ”¹ 20200827 ç‚º 20200828ï¼Œå³å¯æ‰¾åˆ°8æœˆ28æ—¥è³‡æ–™ åœ¨exchangeReportå‰åŠ ä¸Š /en/ è½‰æ›æˆè‹±æ–‡ç‰ˆ https://www.twse.com.tw/en/exchangeReport/MI_INDEX?response=jsn\u0026date=20200828\u0026type=ALL ","date":"2020-11-27","objectID":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/:1:2","tags":["Python","TWSE","jsn","dataframe"],"title":"TWSE [1] jsnæª”è§£æ","uri":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/"},{"categories":["Python","TWSE"],"content":"è§£æJsonæª” ","date":"2020-11-27","objectID":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/:2:0","tags":["Python","TWSE","jsn","dataframe"],"title":"TWSE [1] jsnæª”è§£æ","uri":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/"},{"categories":["Python","TWSE"],"content":"1 å€‹è‚¡æœˆæˆäº¤è³‡è¨Š/en/ 1 è§£æ import urllib.request, json stock_list = [2330] date = 20200813 for j in range(0,len(stock_list)): url = \"http://www.twse.com.tw/en/exchangeReport/STOCK_DAY?response=jsn\u0026date={}\u0026stockNo={}\".format(date,stock_list[j]) with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) print(data) 2 Json Editor for i in range(0, len(data['data'])): print(data['data'][i]) print(data['fields']) print(data['date']) print(data['title']) 3 ä»¥DataFrameå‘ˆç¾è³‡æ–™ 1 DataFrameå‘ˆç¾ import pandas as pd df = pd.DataFrame(data['data'][0:len(data['data'])]) 2 è¨­å®šæ¬„ä½ df.columns = data['fields'] 3 å¢åŠ Stock Codeè‡³df df[\"Stock Code\"] = stock_list[j] 4 å°‡Stock Code è¨­ç‚º index df = df.set_index('Stock Code') 5 å°‡é€—è™Ÿæ‹¿æ‰ df = df.applymap(lambda x: str(x.replace(',',''))) # å®Œæ•´ç¨‹å¼ç¢¼ import pandas as pd import urllib.request, json stock_list = [2330] date = 20200813 for j in range(0,len(stock_list)): url = \"http://www.twse.com.tw/en/exchangeReport/STOCK_DAY?response=jsn\u0026date={}\u0026stockNo={}\".format(date,stock_list[j]) with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) df = pd.DataFrame(data['data'][0:len(data['data'])]) df.columns = data['fields'] df[\"Stock Code\"] = stock_list[j] df = df.set_index('Stock Code') df = df.applymap(lambda x: str(x.replace(',',''))) df ","date":"2020-11-27","objectID":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/:2:1","tags":["Python","TWSE","jsn","dataframe"],"title":"TWSE [1] jsnæª”è§£æ","uri":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/"},{"categories":["Python","TWSE"],"content":"2 æ¯æ—¥æ”¶ç›¤è¡Œæƒ… è§£æJsonæª” 1 è§£æ import urllib.request, json import datetime date = datetime.datetime.now() url = \"https://www.twse.com.tw/exchangeReport/MI_INDEX?response=jsn\u0026date={}\u0026type=ALL\".format(str(date).split(' ')[0].replace('-','')) with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) print(data) print(data['fields9']) print(data['data9']) 2 ä»¥DataFrameå‘ˆç¾ import pandas as pd df = pd.DataFrame(data['data9'][0:len(data['data9'])]) df.columns = data['fields9'] 3 å°‡æ¼²è·Œ(+/-)åˆªé™¤ df = df.drop(columns = 'æ¼²è·Œ(+/-)') 4 å°‡è­‰åˆ¸ä»£è™Ÿè¨­ç‚ºindex df = df.set_index('è­‰åˆ¸ä»£è™Ÿ') 5 å°‡é€—è™Ÿæ‹¿æ‰ df = df.applymap(lambda x: str(x.replace(',',''))) 6 åŠ å…¥æ—¥æœŸ df[\"æ—¥æœŸ\"] = str(date).split(' ')[0].replace('-','/') # å®Œæ•´ç¨‹å¼ç¢¼ import urllib.request, json import pandas as pd import datetime date = datetime.datetime.now() url = \"https://www.twse.com.tw/exchangeReport/MI_INDEX?response=jsn\u0026date={}\u0026type=ALL\".format(str(date).split(' ')[0].replace('-','')) with urllib.request.urlopen(url) as jsonfile: data = json.loads(jsonfile.read().decode()) df = pd.DataFrame(data['data9'][0:len(data['data9'])]) df.columns = data['fields9'] df = df.drop(columns = 'æ¼²è·Œ(+/-)') df = df.set_index('è­‰åˆ¸ä»£è™Ÿ') df = df.applymap(lambda x: str(x.replace(',',''))) df[\"æ—¥æœŸ\"] = str(date).split(' ')[0].replace('-','/') df ","date":"2020-11-27","objectID":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/:2:2","tags":["Python","TWSE","jsn","dataframe"],"title":"TWSE [1] jsnæª”è§£æ","uri":"/twse-1-jsn%E6%AA%94%E8%A7%A3%E6%9E%90/"}]