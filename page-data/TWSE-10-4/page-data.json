{
    "componentChunkName": "component---src-templates-post-jsx",
    "path": "/TWSE-10-4/",
    "result": {"data":{"site":{"siteMetadata":{"title":"RN"}},"markdownRemark":{"id":"5891f396-11aa-55b9-b766-888ed2c6814f","excerpt":"找出一段時間的資料 6 刪除重複資料 參考資料\r\nmongo 删除重复数据\r\npymongo去除重复数据\r\npymongo: remove duplicates (map reduce?) MongoDB執行 準備重複資料 執行程式碼/SQL/ Python執行 準備重複資料 執行程式碼/Python/ 7 $orderby 參考資料\r\n$orderby\r\ncursor.sort() 先複製collection，避免出錯 不改變原始資料 執行程式碼/SQL/ 執行程式碼/Python/","html":"<h5><code class=\"language-text\">find({'Date': {\"$&amp;#0036;gte\": start,\"$&amp;#0036;lte\": end}})</code></h5>\n<h6>找出一段時間的資料</h6>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">start <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>datetime<span class=\"token punctuation\">(</span><span class=\"token number\">2021</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\nend <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>datetime<span class=\"token punctuation\">(</span><span class=\"token number\">2021</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">22</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> mycol<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">'Date'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"$gte\"</span><span class=\"token punctuation\">:</span> start<span class=\"token punctuation\">,</span><span class=\"token string\">\"$lte\"</span><span class=\"token punctuation\">:</span> end<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span><span class=\"token string\">\"Date\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></code></pre></div>\n<h4>6 刪除重複資料</h4>\n<blockquote>\n<p><strong>參考資料</strong><br>\r\n<a href=\"https://segmentfault.com/a/1190000020056997\">mongo 删除重复数据</a><br>\r\n<a href=\"http://ldllidonglin.github.io/blog/2015/12/14/2015-12-14-mongodb%E5%8E%BB%E9%99%A4%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE/\">pymongo去除重复数据</a><br>\r\n<a href=\"https://stackoverflow.com/questions/34722866/pymongo-remove-duplicates-map-reduce\">pymongo: remove duplicates (map reduce?)</a></p>\n</blockquote>\n<h5>MongoDB執行</h5>\n<h6>準備重複資料</h6>\n<img src='https://i.imgur.com/T6o6ocf.jpg' width='100%'>\n<h6>執行程式碼/SQL/</h6>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>getCollection<span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\r\n    {\r\n        $<span class=\"token keyword\">group</span>:{_id:{Title:<span class=\"token string\">'$Title'</span>}<span class=\"token punctuation\">,</span>count:{$sum:<span class=\"token number\">1</span>}<span class=\"token punctuation\">,</span>dups:{$addToSet:<span class=\"token string\">'$_id'</span>}}\r\n    }<span class=\"token punctuation\">,</span>\r\n    {\r\n        $<span class=\"token keyword\">match</span>:{count:{$gt:<span class=\"token number\">1</span>}}\r\n    }\r\n\r\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>forEach<span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span>{\r\n\r\n         it<span class=\"token punctuation\">.</span>dups<span class=\"token punctuation\">.</span>shift<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            db<span class=\"token punctuation\">.</span>getCollection<span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">(</span>{_id: {$<span class=\"token operator\">in</span>: it<span class=\"token punctuation\">.</span>dups}}<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    }<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>db<span class=\"token punctuation\">.</span>getCollection<span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\r\n    {\r\n        $<span class=\"token keyword\">group</span>:{_id:{Title:<span class=\"token string\">'$Title'</span>}<span class=\"token punctuation\">,</span>count:{$sum:<span class=\"token number\">1</span>}<span class=\"token punctuation\">,</span>dups:{$addToSet:<span class=\"token string\">'$_id'</span>}}\r\n    }<span class=\"token punctuation\">,</span>\r\n    {\r\n        $<span class=\"token keyword\">match</span>:{count:{$gt:<span class=\"token number\">1</span>}}\r\n    }\r\n\r\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>forEach<span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span>{\r\n\r\n         it<span class=\"token punctuation\">.</span>dups<span class=\"token punctuation\">.</span>shift<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            db<span class=\"token punctuation\">.</span>getCollection<span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">(</span>{_id: {$<span class=\"token operator\">in</span>: it<span class=\"token punctuation\">.</span>dups}}<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    }<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n</code></pre></div>\n<img src='https://i.imgur.com/t7p0bjf.png' width='100%'>\n<h5>Python執行</h5>\n<h6>準備重複資料</h6>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    mydict <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">\"Title\"</span><span class=\"token punctuation\">:</span> title<span class=\"token punctuation\">,</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">:</span> text <span class=\"token punctuation\">}</span>\r\n    x <span class=\"token operator\">=</span> mycol<span class=\"token punctuation\">.</span>insert_one<span class=\"token punctuation\">(</span>mydict<span class=\"token punctuation\">)</span></code></pre></div>\n<img src='https://i.imgur.com/elKxfJ9.jpg' width='100%'>\n<h6>執行程式碼/Python/</h6>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">cursor <span class=\"token operator\">=</span> mycol<span class=\"token punctuation\">.</span>aggregate<span class=\"token punctuation\">(</span>\r\n    <span class=\"token punctuation\">[</span>\r\n        <span class=\"token punctuation\">{</span><span class=\"token string\">\"$group\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"$Title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"unique_ids\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"$addToSet\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"$_id\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"count\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"$sum\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">{</span><span class=\"token string\">\"$match\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"count\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">\"$gte\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">)</span>\r\n\r\nresponse <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n<span class=\"token keyword\">for</span> doc <span class=\"token keyword\">in</span> cursor<span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">del</span> doc<span class=\"token punctuation\">[</span><span class=\"token string\">\"unique_ids\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\r\n    <span class=\"token keyword\">for</span> <span class=\"token builtin\">id</span> <span class=\"token keyword\">in</span> doc<span class=\"token punctuation\">[</span><span class=\"token string\">\"unique_ids\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\r\n        response<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span>\r\n\r\nmycol<span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"$in\"</span><span class=\"token punctuation\">:</span> response<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<img src='https://i.imgur.com/sEj2NQS.jpg' width='100%'>\n<h4>7 <a href=\"https://docs.mongodb.com/manual/reference/operator/meta/orderby/\">$orderby</a></h4>\n<blockquote>\n<p><strong>參考資料</strong><br>\r\n<a href=\"https://docs.mongodb.com/manual/reference/operator/meta/orderby/\">$orderby</a><br>\r\n<a href=\"https://docs.mongodb.com/manual/reference/method/cursor.sort/\">cursor.sort()</a></p>\n</blockquote>\n<img src='https://i.imgur.com/2nnO2dz.jpg' width='100%'>\n<blockquote>\n<p>先複製collection，避免出錯</p>\n</blockquote>\n<h5>不改變原始資料</h5>\n<h6>執行程式碼/SQL/</h6>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">db<span class=\"token punctuation\">.</span>getCollection<span class=\"token punctuation\">(</span><span class=\"token string\">'2021_鉅亨網_copy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span> { <span class=\"token keyword\">Date</span>: <span class=\"token operator\">-</span><span class=\"token number\">1</span> } <span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\r\n<p>If MongoDB requires using <strong>more than 100 megabytes</strong> of system memory for the <strong>blocking sort operation</strong>, MongoDB returns an error unless the query specifies <a href=\"https://docs.mongodb.com/manual/reference/method/cursor.allowDiskUse/#cursor.allowDiskUse\" target=\"_blank\" rel=\"noopener noreffer\"><code>cursor.allowDiskUse()</code></a> <strong>(New in MongoDB 4.4). </strong><code>allowDiskUse()</code> allows MongoDB to use temporary files on disk to store data exceeding the 100 megabyte system memory limit while processing a blocking sort operation.</p>\n <p align=\"right\">\r\n 原文參考自：\r\n <a href=\"https://docs.mongodb.com/manual/reference/operator/meta/orderby/\" style=\"text-decoration:none;\">$orderby</a>\r\n </p>\r\n</blockquote>\n<h6>執行程式碼/Python/</h6>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> mycol<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span><span class=\"token string\">\"Date\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></code></pre></div>","frontmatter":{"title":"📈 TWSE-10-4-MongoDB+Python","date":"January 20, 2021","update":null,"tags":["TWSE"],"series":null},"fields":{"slug":"/TWSE-10-4/","readingTime":{"minutes":1.8}}},"seriesList":{"edges":[{"node":{"id":"84f12206-b35b-569c-9a52-90932eba4126","fields":{"slug":"/TWSE-1/"},"frontmatter":{"title":"📈 TWSE-1-json檔解析"}}},{"node":{"id":"98ac704b-948d-5e27-b018-5e74d19a2321","fields":{"slug":"/TWSE-2/"},"frontmatter":{"title":"📈 TWSE-2-將DataFrame存入CSV檔 & 抓取多筆資料"}}},{"node":{"id":"cbc00f9f-691d-55bb-b94d-9626ccd82c85","fields":{"slug":"/TWSE-3/"},"frontmatter":{"title":"📈 TWSE-3-TWSE的資料存入SQLite"}}},{"node":{"id":"86351f17-7bd3-5d53-b5c0-b8a09c915143","fields":{"slug":"/TWSE-4/"},"frontmatter":{"title":"📈 TWSE-4-資料存入MySQL及取出"}}},{"node":{"id":"fb2f8d77-486a-51de-be15-df09463393a8","fields":{"slug":"/TWSE-5/"},"frontmatter":{"title":"📈 TWSE-5-mpl_finance K線圖"}}},{"node":{"id":"f61afa98-58c0-5b78-8a49-d195b14ad223","fields":{"slug":"/TWSE-6/"},"frontmatter":{"title":"📈 TWSE-6-MySQL to Dataframe & mplfinance K線圖"}}},{"node":{"id":"a02d0528-84ff-5573-b188-9292da9a5fda","fields":{"slug":"/TWSE-7/"},"frontmatter":{"title":"📈 TWSE-7-Interactive Candlestick Charts"}}},{"node":{"id":"d6651b52-be20-5a3d-87a8-b8036f1bff68","fields":{"slug":"/TWSE-8/"},"frontmatter":{"title":"📈 TWSE-8-plotly | Chart Studio | 1"}}},{"node":{"id":"354205b6-2680-5494-9688-421c384c2e7c","fields":{"slug":"/TWSE-9/"},"frontmatter":{"title":"📈 TWSE-9-Bs4 + 鉅亨網"}}},{"node":{"id":"c5dd3d84-ee79-50ff-bbb7-4081479a3c49","fields":{"slug":"/TWSE-10-1/"},"frontmatter":{"title":"📈 TWSE-10-1-MongoDB+Python"}}},{"node":{"id":"891d93d2-e527-5635-bfb0-23c478c5e65f","fields":{"slug":"/TWSE-10-2/"},"frontmatter":{"title":"📈 TWSE-10-2-MongoDB+Python"}}},{"node":{"id":"cb12e004-6706-503c-be88-311feff22a6c","fields":{"slug":"/TWSE-10-3/"},"frontmatter":{"title":"📈 TWSE-10-3-MongoDB+Python"}}},{"node":{"id":"5891f396-11aa-55b9-b766-888ed2c6814f","fields":{"slug":"/TWSE-10-4/"},"frontmatter":{"title":"📈 TWSE-10-4-MongoDB+Python"}}},{"node":{"id":"8b6644eb-6972-55ca-8d28-d43250b9b5d7","fields":{"slug":"/TWSE-11/"},"frontmatter":{"title":"📈 TWSE-11-Wordcloud + MongoDB"}}},{"node":{"id":"16e41194-8361-5114-8171-1bebe6f4c75e","fields":{"slug":"/TWSE-12/"},"frontmatter":{"title":"📈 TWSE-12-Efficient Frontier"}}},{"node":{"id":"b2d27c4b-8019-5ba4-923d-8e66c8772c61","fields":{"slug":"/TWSE-13/"},"frontmatter":{"title":"📈 TWSE-13-Selenium + 鉅亨網"}}},{"node":{"id":"686b1422-7e63-516f-a3a1-30b86e86aa8c","fields":{"slug":"/About/"},"frontmatter":{"title":"😶 About"}}},{"node":{"id":"51baac29-b12a-5cdc-ae5b-db1fa86fe935","fields":{"slug":"/C-1/"},"frontmatter":{"title":"🖥️ C-Set up Visual Studio Code"}}},{"node":{"id":"4dd46789-25c7-56ec-869d-d4114e3f7c71","fields":{"slug":"/VSCode-imgur/"},"frontmatter":{"title":"🖥️ Visual Studio Code + Imgur"}}},{"node":{"id":"1b91a9d3-1f8a-5c85-8423-9b119011250b","fields":{"slug":"/OCW/"},"frontmatter":{"title":"📓 Online Course"}}},{"node":{"id":"9e148609-92c6-5429-8913-89c5b9ff96bc","fields":{"slug":"/projects/"},"frontmatter":{"title":"💼 Projects"}}},{"node":{"id":"1af50d73-8f14-52c1-9da7-a27f5b7b3cae","fields":{"slug":"/Santander-Customer-Satisfaction/"},"frontmatter":{"title":"🏅 Santander Customer Satisfaction"}}},{"node":{"id":"6436c9fe-28ac-5565-8857-564eda123d31","fields":{"slug":"/torchstudio/"},"frontmatter":{"title":"🖥️ torchstudio"}}},{"node":{"id":"8c3a5f31-3dc2-525e-bba8-5641fe5e1e24","fields":{"slug":"/Neo4j/"},"frontmatter":{"title":"🖥️ Neo4j"}}},{"node":{"id":"8d1c35a3-682b-5993-bc72-ca7156680598","fields":{"slug":"/MongoDB-Query-Operators/"},"frontmatter":{"title":"🖥️ MongoDB Query Operators"}}}]},"previous":{"fields":{"slug":"/TWSE-10-3/"},"frontmatter":{"title":"📈 TWSE-10-3-MongoDB+Python"}},"next":{"fields":{"slug":"/TWSE-11/"},"frontmatter":{"title":"📈 TWSE-11-Wordcloud + MongoDB"}}},"pageContext":{"id":"5891f396-11aa-55b9-b766-888ed2c6814f","series":null,"previousPostId":"cb12e004-6706-503c-be88-311feff22a6c","nextPostId":"8b6644eb-6972-55ca-8d28-d43250b9b5d7"}},
    "staticQueryHashes": []}