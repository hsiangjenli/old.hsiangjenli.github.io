{
    "componentChunkName": "component---src-pages-search-jsx",
    "path": "/search/",
    "result": {"data":{"allMarkdownRemark":{"nodes":[{"excerpt":"ğŸ•·ï¸ Web-Scraping TWSEï½œå°ç£è­‰åˆ¸äº¤æ˜“æ‰€çˆ¬èŸ² ANUEï½œé‰…äº¨ç¶²çˆ¬èŸ² Dcard API ä¸²æ¥ ğŸ¤– Artifical Intelligence âš™ï¸ Machine Learning ğŸ¦— Mini Projects","fields":{"slug":"/projects/"},"frontmatter":{"date":"February 22, 2022","title":"ğŸ’¼ Projects","tags":["projects","Web-Scraping","AI","ML"]},"rawMarkdownBody":"## ğŸ•·ï¸ Web-Scraping\r\n- **TWSEï½œå°ç£è­‰åˆ¸äº¤æ˜“æ‰€çˆ¬èŸ²**\r\n- **ANUEï½œé‰…äº¨ç¶²çˆ¬èŸ²**\r\n- **Dcard API ä¸²æ¥**\r\n---\r\n## ğŸ¤– Artifical Intelligence\r\n\r\n---\r\n\r\n## âš™ï¸ Machine Learning \r\n\r\n---\r\n## ğŸ¦— Mini Projects"},{"excerpt":"ğŸ§‹ Taiwan ä¸­è¯é–‹æ”¾å¹³å° Ewant ğŸª™ Free Coursera Step 1 Financial aid Image Step 2 Image Step 3 Image Step 4 ç†ç”±: 150å€‹è‹±æ–‡å­— Image Udemy StudyCamp å°ç£ç·šä¸Šå­¸ç¿’è«–å£‡ IBM cognitive class.ai Open P-TECH Coursera MongoDB Univerâ€¦","fields":{"slug":"/OCW/"},"frontmatter":{"date":"February 20, 2022","title":"ğŸ““ Online Course","tags":["OCW"]},"rawMarkdownBody":"## ğŸ§‹ Taiwan\r\n- ### [ä¸­è¯é–‹æ”¾å¹³å°](https://www.openedu.tw/)\r\n---\r\n- ### [Ewant](https://www.ewant.org/)\r\n---\r\n\r\n## ğŸª™ Free\r\n- ### [Coursera](https://www.coursera.org/)\r\n  <details>\r\n\r\n    - Step 1 Financial aid\r\n    ![Image](https://i.imgur.com/Nb822V0.png)\r\n    - Step 2\r\n    ![Image](https://i.imgur.com/ZrycTFo.png)\r\n    - Step 3\r\n    ![Image](https://i.imgur.com/nWYZnZo.png)\r\n    - Step 4 ç†ç”±: **150**å€‹è‹±æ–‡å­—\r\n    ![Image](https://i.imgur.com/p9Uvhag.png)\r\n  </details>\r\n\r\n---\r\n- ### [Udemy](https://www.udemy.com/)\r\n    - [StudyCamp å°ç£ç·šä¸Šå­¸ç¿’è«–å£‡](https://vip.studycamp.tw/c/udemy/udemy-free-coupon-code)\r\n---\r\n- ### IBM\r\n    - [cognitive class.ai](https://cognitiveclass.ai/)\r\n    - [Open P-TECH](https://skillsbuild.org/students)\r\n    - Coursera\r\n---\r\n- ### [MongoDB University](https://university.mongodb.com/)\r\n  > æä¾›ä¸­æ–‡**å­—å¹•**\r\n---\r\n- ### [aws training and certification](https://www.aws.training/Certification)\r\n  > æä¾›ä¸­æ–‡**å­—å¹•**\r\n---\r\n- ### [NVIDIA æ·±åº¦å­¸ç¿’æ©Ÿæ§‹](https://www.nvidia.com/zh-tw/training/)\r\n  > æä¾›ä¸­æ–‡**æ•™å­¸**\r\n\r\n> **âš ï¸ å…¶ä»–è³‡æ–™**\r\n> \r\n> ---\r\n> 1. [NKUST](https://acad.nkust.edu.tw/p/404-1004-27716-1.php)\r\n> 1. [6000+ OpenCourseWare (OCW) Courses and Where to Find Them](https://www.classcentral.com/report/ocw-courses/)"},{"excerpt":"è¨»å†ŠImgur API Image VScode è¼¸å…¥Client_id Client_secret  Image ä½¿ç”¨  +  +  Image åƒè€ƒè³‡æ–™ VS Code â€“ Markdwon åˆ©å™¨ vscode-imgur","fields":{"slug":"/VSCode-imgur/"},"frontmatter":{"date":"February 20, 2022","title":"ğŸ–¥ï¸ Visual Studio Code + Imgur","tags":["Visual Studio Code","Markdown","Imgur"]},"rawMarkdownBody":"## è¨»å†Š[Imgur API](https://api.imgur.com/oauth2/addclient)\r\n![Image](https://i.imgur.com/BZshbmf.png)\r\n## VScode è¼¸å…¥Client_id Client_secret\r\n> #### ` File/Preference/Setting/æ”¶å°‹ Client `\r\n>   \r\n> ![Image](https://i.imgur.com/rO4Rmb6.png)\r\n\r\n## ä½¿ç”¨\r\n### `Ctrl` + `Alt` + `V`\r\n\r\n![Image](https://i.imgur.com/nzgUE82.png)\r\n\r\n> **åƒè€ƒè³‡æ–™**\r\n> - [VS Code â€“ Markdwon åˆ©å™¨ vscode-imgur](https://turn2easy.com/2019/05/18/vs-code-markdwon-%E5%88%A9%E5%99%A8-vscode-imgur/)"},{"excerpt":"å®‰è£ Update pkg Image Open MSYS2 MSY Image Open MSYS2 MinGWx64 Image\r\n4. gcc version Image\r\n5. Install gdb debugger Variable Path Search Edit the system environment variable Click Environments Variableâ€¦","fields":{"slug":"/C-1/"},"frontmatter":{"date":"February 19, 2022","title":"ğŸ–¥ï¸ C-Set up Visual Studio Code","tags":["C","Visual Studio Code"]},"rawMarkdownBody":"## å®‰è£\r\n1. Update pkg\r\n```shell\r\npacman -Syu\r\n```\r\n![Image](https://i.imgur.com/f1JTNWE.png)\r\n\r\n2. Open MSYS2 MSY\r\n```shell\r\npacman -Su\r\n```\r\n![Image](https://i.imgur.com/MdWcJE9.png)\r\n\r\n3. Open MSYS2 MinGWx64\r\n```shell\r\npacman -S mingw-w64-x86_64-gcc\r\n```\r\n![Image](https://i.imgur.com/No7dPmu.png)\r\n4. gcc version\r\n```shell\r\ngcc --version\r\n```\r\n![Image](https://i.imgur.com/2qsaXMi.png)\r\n5. Install gdb debugger\r\n```shell\r\npacman -S mingw-w64-x86_64-gdb\r\n```\r\n6. Variable Path\r\n```shell\r\nC:\\msys64\\mingw64\\bin\r\n```\r\n  - Search **Edit the system environment variable**\r\n  - Click **Environments Variable**\r\n  - Open **path** at system variable\r\n  - Click new button and paste the path\r\n![Image](https://i.imgur.com/UmYMQLw.png)\r\n\r\n## VSC-extension\r\n1. Search **c c++**\r\n![Image](https://i.imgur.com/fnG61dT.png)\r\n2. Search **code runner**\r\n![Image](https://i.imgur.com/XCd8yQI.png)\r\n3. Run in Terminal\r\n![Image](https://i.imgur.com/KfL4irU.png)\r\n\r\n> **åƒè€ƒè³‡æ–™**\r\n> 1. [How to Download and Install C Cpp Toolset ( gcc g++ gdb ) in Windows 10 using mingw-w64 and msys2](https://www.youtube.com/watch?v=0HD0pqVtsmw)\r\n> 1. [How to Set up Visual Studio Code for C and C++ Programming](https://youtu.be/77v-Poud_io)"},{"excerpt":"æäº«ç´ ğŸ“ åœ‹ç«‹é«˜é›„ç§‘æŠ€å¤§å­¸ é‡‘èç³»ï¼ˆ2022ï¼‰ âœ‰ï¸ hsiangjenli@gmail.com ğŸ”§ Python, Flask, HTML, CSS, MySQL ğŸŒ TOEIC 725 è­‰ç…§ Microsoft-Azure AI Fundamentals é‡‘èå¸‚å ´å¸¸è­˜èˆ‡è·æ¥­é“å¾· ä¿¡è¨—æ¥­æ¥­å‹™äººå“¡ è­‰åˆ¸å•†æ¥­å‹™å“¡ é‡‘èç§‘æŠ€åŠ› ç¶“æ­· 2021.09 ~ 2022.01-åœ‹ç«‹é«˜é›„ç§‘æŠ€å¤§å­¸-é«˜ç»ç§‘æŠ€ä¸åˆ†â€¦","fields":{"slug":"/About/"},"frontmatter":{"date":"February 07, 2022","title":"ğŸ˜¶ About","tags":["about"]},"rawMarkdownBody":"\r\n## **æäº«ç´**\r\n\r\nğŸ“ **åœ‹ç«‹é«˜é›„ç§‘æŠ€å¤§å­¸ é‡‘èç³»ï¼ˆ2022ï¼‰**  \r\nâœ‰ï¸ **hsiangjenli@gmail.com**  \r\nğŸ”§ **Python, Flask, HTML, CSS, MySQL**  \r\nğŸŒ **TOEIC 725**\r\n\r\n## **è­‰ç…§**\r\n\r\n1. ***Microsoft-Azure AI Fundamentals***\r\n2. **é‡‘èå¸‚å ´å¸¸è­˜èˆ‡è·æ¥­é“å¾·**\r\n3. **ä¿¡è¨—æ¥­æ¥­å‹™äººå“¡**\r\n4. **è­‰åˆ¸å•†æ¥­å‹™å“¡**\r\n5. **é‡‘èç§‘æŠ€åŠ›**\r\n\r\n## **ç¶“æ­·**\r\n\r\n- **2021.09 ~ 2022.01-åœ‹ç«‹é«˜é›„ç§‘æŠ€å¤§å­¸-é«˜ç»ç§‘æŠ€ä¸åˆ†ç³»-è³‡æ–™ç§‘å­¸ åŠ©æ•™**\r\n\r\n## **ç«¶è³½ç¶“é©—**\r\n\r\n1. **2022-åœ‹ç«‹é«˜é›„ç§‘æŠ€å¤§å­¸-é›»æ©Ÿç³»-äººå·¥æ™ºæ…§æš¨é¡ç¥ç¶“ç¶²è·¯è¯åˆå°ˆé¡Œå±• ğŸ¥‡ ç¬¬ä¸€å**\r\n2. **2020-Fintech Space-æ ¡åœ’æˆæœå±• ğŸ… å„ªé¸**\r\n\r\n---\r\n\r\n1. **2021-åœ‹ç«‹å°åŒ—å•†æ¥­å¤§å­¸-Finteché‡‘èæœå‹™-é›¶è‚¡äº¤æ˜“ğŸ“ˆ**\r\n5. **2020-åœ‹ç«‹å°åŒ—å•†æ¥­å¤§å­¸-Finteché‡‘èæœå‹™-è¨˜å¸³è»Ÿé«”ğŸ’¸**\r\n6. **2020-å…†è±éŠ€è¡Œ-Fintechå‰µæ„ç«¶è³½**\r\n7. **2020-â½Ÿâ¼­éŠ€â¾-å•†æ¥­ç«¶è³½**\r\n8. **2020-åœ‹ç«‹é«˜é›„ç§‘æŠ€å¤§å­¸-å…¨åœ‹å¤§å°ˆé™¢æ ¡æ™ºæ…§æ‡‰ç”¨å‰µæ–°å‰µæ„ç«¶è³½**\r\n\r\n## **Project**\r\n\r\n1. **2022-æ¯”ç‰¹å¹£åƒ¹æ ¼/æ¼²è·Œé æ¸¬**\r\n1. **TWSEï½œå°ç£è­‰åˆ¸äº¤æ˜“æ‰€çˆ¬èŸ²**\r\n1. **ANUEï½œé‰…äº¨ç¶²çˆ¬èŸ²**\r\n---\r\n1. **ğŸ“±2020-LINE BOT**\r\n2. **ğŸ²2022-Teachable Machine --Tic-Tac-Toe**\r\n\r\n## ä¿®èª²ç¶“æ­·\r\n\r\n1. **é«˜ç§‘-è²¡ç®¡ç¢©-é‡åŒ–æŠ•è³‡èˆ‡ç¨‹å¼äº¤æ˜“**\r\n2. **é«˜ç§‘-é›»æ©Ÿç³»-äººå·¥æ™ºæ…§**\r\n3. **é«˜ç§‘-å·¥ç®¡ç³»-è³‡æ–™æ¢å‹˜å°è«–**\r\n4. **é«˜ç§‘-åšé›…æ•™è‚²ä¸­å¿ƒ-ç¨‹å¼è¨­è¨ˆæ•™å­¸åŠ©æ•™åŸ¹è¨“-æ¨å‹•å¤§å­¸{ç¨‹å¼è¨­è¨ˆ}æ•™å­¸**\r\n\r\n---\r\n\r\n1. ***Coursera-IBM-Exploratory Data Analysis for Machine Learning***\r\n2. ***Coursera-IBM-Supervised Machine Learning - Regression***\r\n3. ***AWS-Math for Machine Learning***\r\n4. **_NVIDIA_-æ·±åº¦å­¸ç¿’åŸºç¤ç†è«–èˆ‡å¯¦è¸**"},{"excerpt":"Selenium + é‰…äº¨ç¶² + MonogoDB åƒè€ƒè³‡æ–™ é«˜çº§çˆ¬è™«: è®© Selenium æ§åˆ¶ä½ çš„æµè§ˆå™¨å¸®ä½ çˆ¬ åœ¨Windowsä¸Šå®‰è£Python & Selenium + ç°¡æ˜“æ•™å­¸ Selenium Record and Playback tool Selenium IDE Selenium Record and Playback tool for ease of getting acqâ€¦","fields":{"slug":"/TWSE-13/"},"frontmatter":{"date":"February 01, 2021","title":"ğŸ“ˆ TWSE-13-Selenium + é‰…äº¨ç¶²","tags":["TWSE"]},"rawMarkdownBody":"\n# Selenium + é‰…äº¨ç¶² + MonogoDB\n\n\n> åƒè€ƒè³‡æ–™\n> 1. [é«˜çº§çˆ¬è™«: è®© Selenium æ§åˆ¶ä½ çš„æµè§ˆå™¨å¸®ä½ çˆ¬](https://mofanpy.com/tutorials/data-manipulation/scraping/selenium/)\n> 1. [åœ¨Windowsä¸Šå®‰è£Python & Selenium + ç°¡æ˜“æ•™å­¸](https://medium.com/@NorthBei/%E5%9C%A8windows%E4%B8%8A%E5%AE%89%E8%A3%9Dpython-selenium-%E7%B0%A1%E6%98%93%E6%95%99%E5%AD%B8-eade1cd2d12d)\n\n\n## Selenium Record and Playback tool\n1. [Selenium IDE](https://chrome.google.com/webstore/detail/selenium-ide/mooikfkahbdckldjjndioackbalphokd?hl=en)\n> Selenium Record and Playback tool for ease of getting acquainted with Selenium WebDriver.\n1. [ChromeDriver - WebDriver for Chrome](https://sites.google.com/a/chromium.org/chromedriver/)\n\n<img src=\"https://i.imgur.com/tLyq6ao.jpg\" width = \"100%\"/>\n\n```python\nimport selenium\nselenium.__version__\n```\n\n### é–‹å•ŸGoogleé¦–é \n\n```python\nfrom selenium import webdriver\n```\n\n```python\nbrowser = webdriver.Chrome()\nbrowser.get('http://google.com/')\n```\n### é–‹å•Ÿé‰…äº¨ç¶²[å°è‚¡æ–°è](https://news.cnyes.com/news/cat/tw_stock_news?exp=a#TODO)\n\n```python\nbrowser = webdriver.Chrome()\ndriver.get(\"https://news.cnyes.com/news/cat/tw_stock_news?exp=a\")\n```\n\n#### document.body.scrollHeight\n\n> åƒè€ƒè³‡æ–™\n> 1. [How can I scroll a web page using selenium webdriver in python?](https://stackoverflow.com/questions/20986631/how-can-i-scroll-a-web-page-using-selenium-webdriver-in-python)\n> 1. [[çˆ¬èŸ²å¯¦æˆ°] å¦‚ä½•é€éSelenium è‡ªå‹•å°‡é é¢æ²å‹•è‡³æœ€ä¸‹æ–¹æŠ“å–è³‡æ–™?](https://www.youtube.com/watch?v=49Mwqbu2cMo)\n> 1. [ç”¨pythonå¯¦ç¾selenium è‡ªå‹•åŒ–æ¸¬è©¦](https://iter01.com/552647.html)\n\n```python\ndriver.execute_script(\"window.scrollTo(0, document.body.scrollHeight);\")\n\nprint(driver.execute_script(\"return document.body.scrollHeight\"))\n```\n\n```python\npause_time = 10\n\nfor i in range(10):\n    driver.execute_script(\"window.scrollTo(0, document.body.scrollHeight);\")\n    time.sleep(pause_time)\n```\n\n\n\n#### ChromeOptions()\n\n> åƒè€ƒè³‡æ–™\n> 1. [Python selenium.webdriver.ChromeOptions() Examples](https://www.programcreek.com/python/example/100025/selenium.webdriver.ChromeOptions)\n> 1. [Python selenium.webdriver æ¨¡å—ï¼ŒChromeOptions() å®ä¾‹æºç ](http://codingdict.com/sources/py/selenium.webdriver/6817.html)\n> 1. [Python webdriver.ChromeOptionsæ–¹æ³•ä»£ç¢¼ç¤ºä¾‹](https://vimsky.com/zh-tw/examples/detail/python-method-selenium.webdriver.ChromeOptions.html)\n\n\n```python\nstart = time.time()\ndriver = webdriver.Chrome()\ndriver.get(\"https://news.cnyes.com/news/cat/tw_stock_news?exp=a\")\n\nfor i in range(2):\n    driver.execute_script(\"window.scrollTo(0, document.body.scrollHeight);\")\n    time.sleep(pause_time)\ndriver.close()\nend = time.time()\n\nprint(end - start)\n```\n\n```python\nstart = time.time()\noptions = webdriver.ChromeOptions()\noptions.add_experimental_option(\"prefs\", {'ignore_image': 2})\noptions.add_argument('--headless')\noptions.add_argument('--disable-gpu')\n\ndriver = webdriver.Chrome(chrome_options=options)\n\ndriver.get(\"https://news.cnyes.com/news/cat/tw_stock_news?exp=a\")\n\nfor i in range(2):\n    driver.execute_script(\"window.scrollTo(0, document.body.scrollHeight);\")\n    time.sleep(pause_time)\ndriver.close()\nend = time.time()\n\nprint(end - start)\n```\n> åŸ·è¡Œæ™‚é–“æ¯”è¼ƒ\n> <img src=\"https://i.imgur.com/B0WK34l.jpg\" width = \"100%\"/>\n\n### Bs4\n\n```python\noptions = webdriver.ChromeOptions()\noptions.add_experimental_option(\"prefs\", {'ignore_image': 2})\noptions.add_argument('--headless')\noptions.add_argument('--disable-gpu')\n\ndriver = webdriver.Chrome(chrome_options=options)\n\ndriver.get(\"https://news.cnyes.com/news/cat/tw_stock_news?exp=a\")\n\nfor i in range(2):\n    driver.execute_script(\"window.scrollTo(0, document.body.scrollHeight);\")\n    time.sleep(pause_time)\nsoup = BeautifulSoup(driver.page_source, 'html.parser')\ndriver.close()\n```\n#### MongoDB\n\n##### æŠ“å‡ºå·²å­˜æª”çš„past_post_ids\n\n```python\nmyclient = pymongo.MongoClient(\"mongodb://localhost:27017/\")\nmydb = myclient[\"article\"]\nmycol = mydb[\"2021_é‰…äº¨ç¶²\"]\n\npast_post_ids = []\n\nend = datetime.datetime.now()\nstart = end - datetime.timedelta(days = 3)\n\nfor x in mycol.find({'Date': {\"$gte\": start,\"$lte\": end}}):\n    past_post_ids.append(x[\"post_id\"])\n```\n##### å¾ç¶²ç«™ä¸ŠæŠ“ä¸‹ä¾†çš„post_ids\n```python\nhrefs = soup.find_all('a')\npost_ids = []\nimport regex as re\nfor href in hrefs:\n    if re.match('/news/id/', str(href.get('href'))):\n        post_id = str(href.get('href')).split('/')[-1].split('?')[0]\n        post_ids.append(post_id)\n```\n##### past_post_ids&post_idså·®é›†\n\n```python\nA = ['A','B','C','D']\nB = ['B','F']\nC = []\nfor x in B:\n    if x in A:\n        None\n    else:\n        C.append(x)\nC\n```\n\n```python\nnew_post_ids = []\nfor _id in post_ids:\n    if _id in past_post_ids:\n        None\n    else:\n        new_post_ids.append(_id)\n        \nprint(len(past_post_ids))\nprint(len(post_ids))\nprint(len(new_post_ids))\n```\n\n> åœ–ç‰‡è§£èªª\n> <img src=\"https://i.imgur.com/KY0ljVm.png\" width = \"100%\"/>\n> [Set (mathematics)](https://en.wikipedia.org/wiki/Set_(mathematics)#Basic_operations)\n\n\n#### å­˜æˆurls\n\n```python\nurls = ['https://news.cnyes.com/news/id/{}?exp=a'.format(e) for e in new_post_ids]\n```\n\n```python\ndef get_text(i):\n    post_id = urls[i].split('/')[5].split('?')[0]\n    data = urllib.request.urlopen(urls[i])\n    soup = BeautifulSoup(data, 'html.parser')\n    \n    P = soup.find_all('p')\n    text = ''\n    for i,p in zip(range(0,len(P)),P):\n        if i >=4:\n            text = text + p.getText()\n        i += 1\n\n    tags = soup.find_all('a')\n    n_tags = []\n    for tag in tags:\n        if re.match('/tag/', str(tag.get('href'))):\n            n_tags.append(str(tag.get('href'))[5:len(str(tag.get('href')))])\n\n    title = soup.find('h1').getText()\n    T = soup.find('time')\n    Date = datetime.datetime.strptime(T['datetime'], \"%Y-%m-%dT%H:%M:%S+08:00\")\n    \n    return(Date,post_id,title,n_tags,text)\n```\n\n```python\nfor i in range(0,len(urls)):\n    print(get_text(i))\n```\n\n### å®Œæ•´ç¨‹å¼ç¢¼\n\n```python\nimport pymongo\n\nimport urllib\nfrom bs4 import BeautifulSoup\nfrom selenium import webdriver\nfrom selenium.webdriver.chrome.options import Options\n\nimport regex as re\n\nimport datetime\nimport time\n\npause_time = 10\noptions = webdriver.ChromeOptions()\noptions.add_experimental_option(\"prefs\", {'ignore_image': 2})\noptions.add_argument('--headless')\noptions.add_argument('--disable-gpu')\n\ndriver = webdriver.Chrome(chrome_options=options)\n\ndriver.get(\"https://news.cnyes.com/news/cat/tw_stock_news?exp=a\")\n\nfor i in range(2):\n    driver.execute_script(\"window.scrollTo(0, document.body.scrollHeight);\")\n    time.sleep(pause_time)\n    \nsoup = BeautifulSoup(driver.page_source, 'html.parser')\n\ndriver.close()\n\nhrefs = soup.find_all('a')\n\npost_ids = []\npast_post_ids = []\nnew_post_ids = []\n\nfor href in hrefs:\n    if re.match('/news/id/', str(href.get('href'))):\n        post_id = str(href.get('href')).split('/')[-1].split('?')[0]\n        post_ids.append(post_id)\n        \nmyclient = pymongo.MongoClient(\"mongodb://localhost:27017/\")\nmydb = myclient[\"article\"]\nmycol = mydb[\"2021_é‰…äº¨ç¶²\"]\n\nend = datetime.datetime.now()\nstart = end - datetime.timedelta(days = 3)\n\nfor x in mycol.find({'Date': {\"$gte\": start,\"$lte\": end}}):\n    past_post_ids.append(x[\"post_id\"])\nnew_post_ids = []\nfor _id in post_ids:\n    if _id in past_post_ids:\n        None\n    else:\n        new_post_ids.append(_id)\n        \nurls = ['https://news.cnyes.com/news/id/{}?exp=a'.format(e) for e in new_post_ids]\n\ndef get_text(i):\n    post_id = urls[i].split('/')[5].split('?')[0]\n    data = urllib.request.urlopen(urls[i])\n    soup = BeautifulSoup(data, 'html.parser')\n    \n    P = soup.find_all('p')\n    text = ''\n    for i,p in zip(range(0,len(P)),P):\n        if i >=4:\n            text = text + p.getText()\n        i += 1\n\n    tags = soup.find_all('a')\n    n_tags = []\n    for tag in tags:\n        if re.match('/tag/', str(tag.get('href'))):\n            n_tags.append(str(tag.get('href'))[5:len(str(tag.get('href')))])\n\n    title = soup.find('h1').getText()\n    T = soup.find('time')\n    Date = datetime.datetime.strptime(T['datetime'], \"%Y-%m-%dT%H:%M:%S+08:00\")\n    \n    return(Date,post_id,title,n_tags,text)\n\nfor i in range(0,len(urls)):\n    data = get_text(i)\n    print(i, end = ' ')\n    mydict = { \"Date\": data[0], \"post_id\":data[1],\"Title\": data[2], \"Tags\":data[3] , \"text\": data[4] }\n    x = mycol.insert_one(mydict)\ncursor = mycol.aggregate(\n    [{\"$group\": {\"_id\": \"$Title\",\n                 \"unique_ids\": {\"$addToSet\": \"$_id\"},\n                 \"count\": {\"$sum\": 1}}},\n     {\"$match\": {\"count\": { \"$gte\": 2 }}}])\n\nresponse = []\n\nfor doc in cursor:\n    del doc[\"unique_ids\"][0]\n    for id in doc[\"unique_ids\"]:\n        response.append(id)\n\nmycol.remove({\"_id\": {\"$in\": response}})\n```\n\n\n\n\n\n\n"},{"excerpt":"Python + æŠ•è³‡å­¸/Efficient Frontier/ SQL é€£æ¥/æ–¹æ³•ä¸€/ å ±é…¬ç‡ åƒè€ƒè³‡æ–™\npandas.DataFrame.pct_change åŸºæœ¬ ä»Šæ—¥ & æ˜¨æ—¥ pct_change() è®Šç•°æ•¸ var() æ¨™æº–å·® std() å…±è®Šç•°æ•¸ cov() åƒè€ƒå…¬å¼\n ç°¡å–®å¯¦è­‰      1 0 2 1 0 0 -1 3 1.5 -1.5 2 1 0 -1.5 -1.5 1 0 â€¦","fields":{"slug":"/TWSE-12/"},"frontmatter":{"date":"January 27, 2021","title":"ğŸ“ˆ TWSE-12-Efficient Frontier","tags":["TWSE"]},"rawMarkdownBody":"\n# Python + æŠ•è³‡å­¸/Efficient Frontier/\n## SQL é€£æ¥/æ–¹æ³•ä¸€/\n\n```python\nfrom sqlalchemy import create_engine\n\nimport pandas as pd\n\nimport matplotlib\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nimport numpy as np\nfrom functools import reduce\nimport scipy.optimize as solver\n```\n\n\n\n```python\nuser = 'root'\npw = \"YourPassword\"\ndb = \"TWSE\"\nengine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=db))\n```\n\n```python\ndf_2330 = pd.read_sql(\"SELECT * FROM `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` WHERE `è­‰åˆ¸ä»£è™Ÿ` = 2330 AND `æ—¥æœŸ` BETWEEN '2020/10/20 00:00:00' AND '2021/1/10 23:59:59' ORDER BY `æ—¥æœŸ`\", engine, coerce_float=True, parse_dates=True)\ndf_tw = pd.read_sql(\"SELECT * FROM `ç™¼è¡Œé‡åŠ æ¬Šè‚¡åƒ¹æŒ‡æ•¸` WHERE `æ—¥æœŸ` BETWEEN '2020/10/20 00:00:00' AND '2021/1/10 23:59:59'\", engine, coerce_float=True, parse_dates=True)\n```\n### å ±é…¬ç‡\n> **åƒè€ƒè³‡æ–™**\n> [pandas.DataFrame.pct_change](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pct_change.html)\n> $$ \n> Return = \\frac{D_{1} - D_{0}}{D_{0}} \n> $$\n\n#### åŸºæœ¬\n##### ä»Šæ—¥ & æ˜¨æ—¥\n\n```python\nprint('ä»Šæ—¥  æ˜¨æ—¥')\n\nfor i,j in zip(df_2330['æ”¶ç›¤åƒ¹'],df_2330['æ”¶ç›¤åƒ¹'].shift(1)) :\n    print(i, j)\n```\n\n<img src = \"https://i.imgur.com/7lkgNrl.jpg\" width = \"100%\" />\n\n```python\nReturn = pd.DataFrame((df_2330['æ”¶ç›¤åƒ¹']  - df_2330['æ”¶ç›¤åƒ¹'].shift(1))/df_2330['æ”¶ç›¤åƒ¹'].shift(1))\nReturn = Return.rename(columns = {'æ”¶ç›¤åƒ¹':'Return'})\nReturn\n```\n\n#### pct_change()\n\n```python\ndf_2330['æ”¶ç›¤åƒ¹'].pct_change()\ndf_tw['æ”¶ç›¤æŒ‡æ•¸'].pct_change()\n```\n```python\ndf = pd.DataFrame(df_2330['æ”¶ç›¤åƒ¹'].pct_change())\ndf['TW']  = df_tw['æ”¶ç›¤æŒ‡æ•¸'].pct_change()\ndf = df.rename(columns = {'æ”¶ç›¤åƒ¹':'2330'})\n```\n\n### è®Šç•°æ•¸$Ïƒ^2$\n\n#### [var()](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.var.html)\n\n```python\ndf_tw['æ”¶ç›¤æŒ‡æ•¸'].pct_change().var()\n```\n\n### æ¨™æº–å·®$Ïƒ$\n\n#### [std()](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.std.html)\n\n```python\ndf_tw['æ”¶ç›¤æŒ‡æ•¸'].pct_change().std()\n\nstd = df_tw['æ”¶ç›¤æŒ‡æ•¸'].pct_change().var()**(1/2)\n```\n\n\n\n### å…±è®Šç•°æ•¸$Ïƒ_{a,b}$\n\n#### [cov()](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.cov.html)\n\n> **åƒè€ƒå…¬å¼**\n> $$cov_{x,y} = \\frac{\\sum{}^{} ({x_i} - \\overline{x})({y_i} - \\overline{y})}{N-1}$$\n\n##### ç°¡å–®å¯¦è­‰\n\n```python\ndf_test = pd.DataFrame([(1, 2), (0, 3), (2, 0), (1, 1)],\n                  columns=['dogs', 'cats'])\ndf_test.cov()\n```\n\n\n|        $$dog$$         | $$dog_i - \\overline{dog} $$ |         $$cats$$         | $$cat_i - \\overline{cat} $$ |               $${Dev_{dog}}\\times{Dev_{cat}}$$               |\n| :--------------------: | :-------------------------: | :----------------------: | :-------------------------: | :----------------------------------------------------------: |\n|         **1**          |            **0**            |          **2**           |            **1**            |                            **0**                             |\n|         **0**          |           **-1**            |          **3**           |           **1.5**           |                           **-1.5**                           |\n|         **2**          |            **1**            |          **0**           |          **-1.5**           |                           **-1.5**                           |\n|         **1**          |            **0**            |          **1**           |           **-1**            |                            **0**                             |\n| $$\\overline{dog} = 1$$ |                             | $$\\overline{cat} = 1.5$$ |                             | $${\\frac{\\sum{}^{} ({Dev_{dog}}\\times{Dev_{cat}})}{4-1}} = -1$$ |\n\n##### $ Ïƒ_{2330,TW} $\n> **è£œå……è³‡æ–™**\n> $$ Ïƒ_{2330,TW} $$\n> <p align = \"right\" ><a href=\"https://drive.google.com/file/d/1w_wYTHxTBQZzPiWNjn-eNIu6UjXAVzyb/view?usp=sharing\" target=\"_blank\" rel=\"noopener noreffer\">Excelè¨ˆç®—éç¨‹</a></p>\n\n\n```python\ndf.cov()\n\n>>> 0.000097\n```\n\n### ç›¸é—œä¿‚æ•¸$Ï_{a,b}$\n\n#### [corr()](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.corr.html)\n\n```python\ndf.corr()\n```\n\n\n\n|      |   2330   |    TW    |\n| :--: | :------: | :------: |\n| 2330 | 1.000000 | 0.895857 |\n|  TW  | 0.895857 | 1.000000 |\n\n### $\\beta$ä¿‚æ•¸\n> **åƒè€ƒå…¬å¼**\n> $${\\beta} = \\frac{Ïƒ_{i,m}}{Ïƒ^2}$$</h2>\n\n```python\nBeta = df.cov()['TW'][0]/df_tw['æ”¶ç›¤æŒ‡æ•¸'].pct_change().var()\n```\n\n## SQL é€£æ¥/æ–¹æ³•äºŒ/\n\n```python\nfrom sqlalchemy import create_engine\n\nimport pandas as pd\n\nimport matplotlib\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nimport numpy as np\nfrom functools import reduce\nimport scipy.optimize as solver\n```\n\n\n\n```python\nuser = 'root'\npw = \"YourPassword\"\ndb = \"TWSE\"\nengine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=db))\n\nStart = '2020/10/20 00:00:00'\nEnd = '2021/1/10 23:59:59'\n\nSQL = '''\nSELECT `æ”¶ç›¤åƒ¹` FROM `{}` WHERE `è­‰åˆ¸ä»£è™Ÿ` = '{}' AND `æ—¥æœŸ` BETWEEN '{}' AND '{}' ORDER BY `æ—¥æœŸ`\n'''\n\nstock_codes = ['2330','2317','1234']\n\ndef getSQL(stock_code):\n    df = pd.read_sql(SQL.format('æ¯æ—¥æ”¶ç›¤è¡Œæƒ…',stock_code, Start, End), engine, coerce_float=True, parse_dates=True)\n    return df\n\ndef Tsql(stock_codes):\n    for i in range(0,len(stock_codes)):\n        globals()[i] = getSQL(stock_codes[i])\n        if i == 0:\n            df = pd.DataFrame(globals()[i].pct_change())\n            df = df.rename(columns = {'æ”¶ç›¤åƒ¹':stock_codes[i]})\n        else:\n            df['{}'.format(stock_codes[i])] = globals()[i].pct_change()\n    df = df.replace([np.inf, -np.inf], 0)\n    return df\n\nreturns = Tsql(stock_codes)\n```\n\n\n\n<img src = \"https://i.imgur.com/yUyf3O0.jpg\" width = \"100%\">\n\n### é æœŸå ±é…¬$E(r)$\n\n```python\nExpected_R = returns.mean() * 252\n```\n### æ¬Šé‡$W_{i}$\n```python\nW = np.array([0.5,0.3,0.2])\n```\n### æŠ•è³‡çµ„åˆå ±é…¬ç‡$R_{P}$\n> **åƒè€ƒå…¬å¼**\n> $$R_{P} = \\sum{W_{i}\\times{R_{i}}}$$\n\n\n```python\nPortfolio_R = sum(W * Expected_R)\n```\n\n\n\n## é‡åŒ–æŠ•è³‡/Efficient Frontier/\n\n### éš¨æ©Ÿæ¬Šé‡$W_{i}$\n\n```python\nW = np.random.rand(len(stock_codes))\nW = W/sum(W)\nW\n```\n\n### æŠ•è³‡çµ„åˆé¢¨éšª$Ïƒ_{P}^2$\n#### åŸºæœ¬å…¬å¼\n\n> **åƒè€ƒå…¬å¼**\n> $$Ïƒ_{P}^2 = \\sum{ {W_{i}^2} {Ïƒ_{i}^2}} + \\sum\\sum{ W_{i} W_{j} {Ïƒ_{i,j}}  } $$\n> $$Ïƒ_{P}^2 = \\sum{ {W_{i}^2} {Ïƒ_{i}^2}} + \\sum\\sum{ W_{i} W_{j} {Ï_{i,j}} {Ïƒ_{i}} {Ïƒ_{j}}  } $$\n\n\n#### çŸ©é™£ç°¡å–®è¨ˆç®—\n\n> **åƒè€ƒè³‡æ–™**\n\n[[work] ç†è§£çŸ©é™£ä¹˜æ³•](https://www.itread01.com/content/1543280103.html)\n\\\\[ \\begin{bmatrix} 1&2\\\\\\3&4 \\end{bmatrix} \\times \\begin{bmatrix} 4&-6\\\\\\ -2&3 \\end{bmatrix} = \\begin{bmatrix} A_1&A_2\\\\\\B_1&B_2  \\end{bmatrix} = \\begin{bmatrix} 0&0\\\\\\4& -6  \\end{bmatrix}\\\\]\n\n\n|                                      |                                         |\n| ------------------------------------ | --------------------------------------- |\n| $A_{1} = 1\\times4 + 2\\times(-2) = 0$ | $A_{2} = 1\\times(-6) + 2\\times(3) = 0$  |\n| $B_{1} = 3\\times4 + 4\\times(-2) = 4$ | $B_{2} = 3\\times(-6) + 4\\times(3) = -6$ |\n\n\n\n\n\n#### ä½¿ç”¨çŸ©é™£ç°¡åŒ–$Ïƒ_{P}^2$è¨ˆç®—\n\n> **åƒè€ƒè³‡æ–™**\n> <a href=\"https://www.masterlink.com.tw/about/riskmanagment/manage/market.aspx\" target=\"_blank\" rel=\"noopener noreffer\">VaR é¢¨éšªå€¼è¡¡é‡(Value at Riskï¼›VaR)</a><br>\n> <a href=\"https://kknews.cc/zh-tw/finance/lp3kr9g.html\" target=\"_blank\" rel=\"noopener noreffer\">å¦‚ä½•è¨ˆç®—æŠ•è³‡çµ„åˆçš„é¢¨éšªå’Œå›å ±</a></p>\n> \n$$Ïƒ_{P}^2 = \\begin{bmatrix}W_1&W_2&W_3\\end{bmatrix} \\times \\begin{bmatrix}Ïƒ_{1}^2&Ïƒ_{2,1}&Ïƒ_{3,1} \\\\\\ Ïƒ_{1,2}&Ïƒ_{2}^2&Ïƒ_{3,2} \\\\\\ Ïƒ_{1,3}&Ïƒ_{2,3}&Ïƒ_{3}^2\\end{bmatrix} \\times \\begin{bmatrix}W_1\\\\\\ W_2\\\\\\ W_3\\end{bmatrix}$$\n\n\n\n<style type=\"text/css\">\n.tg  {border-collapse:collapse;border-spacing:0;}\n.tg td{border-color:black;border-style:none;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{border-color:black;border-style:none;border-width:1px;font-family:Arial, sans-serif;font-size:14px;\n  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-io4b{background-color:#efefef;border-color:inherit;color:#000000;font-weight:bold;text-align:center;vertical-align:top}\n.tg .tg-c3ow{border-color:inherit;text-align:center;vertical-align:top}\n.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}\n</style>\n<table class=\"tg\">\n<thead>\n  <tr>\n      <th class=\"tg-io4b\" colspan=\"3\"><h2>æ­¥é©Ÿä¸€</h2></th>\n  </tr>\n</thead>\n<tbody>\n  <tr>\n    <td class=\"tg-c3ow\" colspan=\"3\">\n\n$$\\begin{bmatrix}W_1&W_2&W_3\\end{bmatrix} \\times \\begin{bmatrix}Ïƒ_{1}^2&Ïƒ_{2,1}&Ïƒ_{3,1} \\\\\\ Ïƒ_{1,2}&Ïƒ_{2}^2&Ïƒ_{3,2} \\\\\\ Ïƒ_{1,3}&Ïƒ_{2,3}&Ïƒ_{3}^2\\end{bmatrix}$$</td>\n  </tr>\n  <tr>\n    <td class=\"tg-0pky\">\n\n$W_{1}Ïƒ_{1}^2 + W_{2}Ïƒ_{1,2}+ W_{3}Ïƒ_{1,3}$</td>\n    <td class=\"tg-0pky\">\n\n$ W_{1}Ïƒ_{2,1}+ W_{2}Ïƒ_{2}^2+ W_{3}Ïƒ_{2,3}$</td>\n    <td class=\"tg-0pky\">\n\n$ W_{1}Ïƒ_{3,1}+ W_{2}Ïƒ_{3,2}+ W_{3}Ïƒ_{3}^2$</td>\n  </tr>\n  <tr>\n      <td class=\"tg-io4b\" colspan=\"3\"><h2>æ­¥é©ŸäºŒ</h2></td>\n  </tr>\n  <tr>\n    <td class=\"tg-c3ow\" colspan=\"3\">\n    \n$$\\begin{bmatrix} W_{1}Ïƒ_{1}^2 + W_{2}Ïƒ_{1,2}+ W_{3}Ïƒ_{1,3},& W_{1}Ïƒ_{2,1}+ W_{2}Ïƒ_{2}^2+ W_{3}Ïƒ_{2,3},& W_{1}Ïƒ_{3,1}+ W_{2}Ïƒ_{3,2}+ W_{3}Ïƒ_{3}^2\\end{bmatrix} \\times \\begin{bmatrix}W_1\\\\\\ W_2\\\\\\ W_3\\end{bmatrix}$$</td>\n  </tr>\n  <tr>\n    <td class=\"tg-0pky\">\n    \n$W_{1}^2Ïƒ_{1}^2$</td>\n    <td class=\"tg-0pky\">\n    \n$ W_{1}W_{2}Ïƒ_{2,1}$</td>\n    <td class=\"tg-0pky\">\n    \n$ W_{1}W_{2}Ïƒ_{3,1}$</td>\n  </tr>\n  <tr>\n    <td class=\"tg-0pky\">\n    \n$ W_{1} W_{2}Ïƒ_{1,2}$</td>\n    <td class=\"tg-0pky\">\n    \n$ W_{2}^2Ïƒ_{2}^2$</td>\n    <td class=\"tg-0pky\">\n    \n$ W_{2}W_{3}Ïƒ_{3,2}$</td>\n  </tr>\n  <tr>\n    <td class=\"tg-0pky\">\n    \n$ W_{1} W_{3}Ïƒ_{1,3}$</td>\n    <td class=\"tg-0pky\">\n    \n$ W_{2}W_{3}Ïƒ_{2,3}$</td>\n    <td class=\"tg-0pky\">\n    \n$ W_{3}^2Ïƒ_{3}^2$</td>\n  </tr>\n</tbody>\n</table>\n\n#### ç”¨Pythonè¡¨ç¤º\n> **åƒè€ƒè³‡æ–™**\n> 1. [Python-ç¹ªè£½æ•ˆç‡å‰ç·£(Efficient Frontier)](https://ycy-tw.github.io/2020/03/28/Python-%E7%B9%AA%E8%A3%BD%E6%95%88%E7%8E%87%E5%89%8D%E7%B7%A3(Efficient%20Frontier)/)\n> 1. [Pythoné‡‘èå¤§æ•¸æ“šåˆ†æâ€”â€”ç¬¬11ç«  çµ±è¨ˆå­¸ï¼ˆ2ï¼‰æŠ•è³‡çµ„åˆå„ªåŒ– ç­†è¨˜](https://www.twblogs.net/a/5b7f57ea2b717767c6af118b)\n\n\n##### æ–¹æ³•ä¸€\n> **ä»¥ä¸‹ç¨‹å¼ç¢¼ä¾†æºï¼Œåƒè€ƒè‡ªï¼š**\n> [Python-ç¹ªè£½æ•ˆç‡å‰ç·£(Efficient Frontier)](https://ycy-tw.github.io/2020/03/28/Python-%E7%B9%AA%E8%A3%BD%E6%95%88%E7%8E%87%E5%89%8D%E7%B7%A3(Efficient%20Frontier)/)\n>\n> ```python\n> Portfolio_risk = np.sqrt(reduce(np.dot, [W, cov_matrix, W.T]))\n> ```\n\n##### æ–¹æ³•äºŒ\n\n> **åƒè€ƒè³‡æ–™**\n> [Python Lambda](https://www.w3schools.com/python/python_lambda.asp)\n> ```python\n> Portfolio_risk = lambda a, b,c: np.sqrt(np.dot(np.dot(a,b),c))\n> Portfolio_risk(W, cov_matrix,W.T)\n> ```\n\n\n\n### éš¨æ©Ÿç”Ÿæˆ10000ç­†æ¬Šé‡\n> **ä»¥ä¸‹ç¨‹å¼ç¢¼ä¾†æºï¼Œåƒè€ƒè‡ªï¼š**\n> [Python-ç¹ªè£½æ•ˆç‡å‰ç·£(Efficient Frontier)](https://ycy-tw.github.io/2020/03/28/Python-%E7%B9%AA%E8%A3%BD%E6%95%88%E7%8E%87%E5%89%8D%E7%B7%A3(Efficient%20Frontier)/)\n> \n> ```python\nExpected_R = returns.mean() * 252\ncov_matrix = returns.cov()*252\nall_Portfolio_risk = []\nall_return = []\nExpected_R = returns.mean() * 252\n\nstop = 0\n\nwhile stop < 10000:\n    try:\n        stop += 1\n        W = np.random.rand(len(stock_codes))\n        W = W/sum(W)\n        all_return.append(sum(Expected_R * W))\n        all_Portfolio_risk.append(np.sqrt(reduce(np.dot, [W, cov_matrix, W.T])))\n    except:\n        pass\n\nSR = np.array(all_return)/np.array(all_Portfolio_risk)\n```\n\n#### ç•«åœ–\n##### Fig 1\n```python\nfig = plt.figure(figsize = (20,10))\nax = fig.add_subplot()\nax.plot(all_Portfolio_risk, all_return, 'o',alpha=1)\nfig.savefig('Efficient_Frontier_1.png',dpi=300, bbox_inches='tight')\n```\n<img src=\"https://i.imgur.com/k9uKXJg.png\" width = \"100%\"/>\n\n##### Fig 2\n###### æ–¹æ³•ä¸€\n```python\n#åŸºæœ¬è¨­å®š\nfig = plt.figure(figsize = (20,8))\nrisk_free = 0.01\nSR = (np.array(all_return)-risk_free)/np.array(all_Portfolio_risk)\n\n#å­—é«”å¤§å°è¨­å®š\nlabel_size = 27\ntick_size = 15\nTitle_size = 40\n\n#Title\nTitle = 'Efficient Frontier'\n\n#æ ¼ç·š\nplt.grid(True)\n\n#æ•£é»åœ–\nplt.scatter(all_Portfolio_risk, all_return, c=SR,alpha=1)\n\n#X,Yè»¸æ¨™ç±¤\nplt.xlabel('$Ïƒ_{P}$', fontsize=label_size, fontweight='bold')\nplt.ylabel('$E(R)$', fontsize=label_size, fontweight='bold')\n\n#X,Yè»¸å­—é«”è¨­å®š\nplt.xticks(fontsize=tick_size, fontweight='bold')\nplt.yticks(fontsize=tick_size, fontweight='bold')\n\n#color barè¨­å®š\ncbar = plt.colorbar(label='$Sharpe$ $Ratio$')\nax = cbar.ax\nax.tick_params(labelsize=tick_size) \ncbar_Title = ax.yaxis.label\nfont = matplotlib.font_manager.FontProperties(size=label_size)\ncbar_Title.set_font_properties(font)\n\nplt.title(Title, fontsize=Title_size,family = 'monospace',ha = 'center')\n\n#åœ–ç‰‡å„²å­˜\nplt.savefig('Efficient_Frontier_2.png',dpi=300, bbox_inches='tight')\n```\n###### æ–¹æ³•äºŒ\n\n```python\nfig = plt.figure(figsize = (20,8))\nlabel_size = 27\ntick_size = 15\nTitle_size = 40\nTitle = 'Efficient Frontier'\nrisk_free = 0.01\nSR = (np.array(all_return)-risk_free)/np.array(all_Portfolio_risk)\n\n\nax = fig.add_subplot()\nax.grid(True)\nax_main = ax.scatter(all_Portfolio_risk, all_return, c=SR,alpha=1)\n\nax.set_title(Title, fontsize=Title_size,family = 'monospace',ha = 'center')\nax.set_xlabel('$Ïƒ_{P}$', fontsize=label_size, fontweight='bold')\nax.set_ylabel('$E(R)$', fontsize=label_size, fontweight='bold')\n\nax.tick_params(labelsize=tick_size) \n\n\ncbar = fig.colorbar(ax_main, ax=ax, label = '$Sharpe$ $Ratio$')\ncbar = cbar.ax\ncbar.tick_params(labelsize=tick_size) \ncbar_Title = cbar.yaxis.label\nfont = matplotlib.font_manager.FontProperties(size=label_size)\ncbar_Title.set_font_properties(font)\nfig.savefig('Efficient_Frontier_3.png',dpi=300, bbox_inches='tight')\n```\n\n\n\n\n\n<img src=\"https://i.imgur.com/Uog91y0.png\" width = '100%'/>\n\n### [scipy.optimize.minimize](https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html)\n\n#### min($Ïƒ_{P}$)\n\n```python\ndef standard_deviation(W):\n    return Portfolio_risk(W, cov_matrix,W.T)\n```\n\n**ä»¥ä¸‹ç¨‹å¼ç¢¼ä¾†æºï¼Œåƒè€ƒè‡ªï¼š**\n[Python-ç¹ªè£½æ•ˆç‡å‰ç·£(Efficient Frontier)](https://ycy-tw.github.io/2020/03/28/Python-%E7%B9%AA%E8%A3%BD%E6%95%88%E7%8E%87%E5%89%8D%E7%B7%A3(Efficient%20Frontier)/)\n\n```python\nx0 = [1/len(stock_codes) for e in range(len(stock_codes))]\n\nbounds = tuple((0, 1) for x in range(len(stock_codes)))\n\nconstraints = [{'type': 'eq', 'fun': lambda x: sum(x) - 1}]\n\nmin_Portfolio_risk = solver.minimize(standard_deviation, x0=x0, constraints=constraints, bounds=bounds)\n\nmvp_risk = min_Portfolio_risk.fun\nmvp_return = sum(min_Portfolio_risk.x * Expected_R)\n\n\nprint('é¢¨éšªæœ€å°åŒ–æŠ•è³‡çµ„åˆé æœŸå ±é…¬ç‡ç‚º:' + str(round(mvp_return,2)))\nprint('é¢¨éšªæœ€å°åŒ–æŠ•è³‡çµ„åˆé¢¨éšªç‚º:' + str(round(mvp_risk,2)))\n```\n\n\n> **è£œå……è³‡æ–™**\n[scipy.optimize.minimize](https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html)\n\n<img src=\"https://i.imgur.com/m2P2B2d.jpg\" width = \"100%\"/>\n\n> **ä»¥ä¸‹ç¨‹å¼ç¢¼ä¾†æºï¼Œåƒè€ƒè‡ªï¼š**\n\n[Python-ç¹ªè£½æ•ˆç‡å‰ç·£(Efficient Frontier)](https://ycy-tw.github.io/2020/03/28/Python-%E7%B9%AA%E8%A3%BD%E6%95%88%E7%8E%87%E5%89%8D%E7%B7%A3(Efficient%20Frontier)/)\n\n```python\nfor i in range(0,len(stock_codes)):\n    print(stock_codes[i]+' ä½”æŠ•è³‡çµ„åˆæ¬Šé‡ : ' + str(format(min_Portfolio_risk.x[i], '.4f')))\n```\n\n$$SR = \\frac{R_{P} - R_{f}}{Ïƒ_{P}}$$\n\n```python\nrisk_free = 0.01\nSR = (np.array(all_return)-risk_free)/np.array(all_Portfolio_risk)\n```\n\n```python\nx0 = [1/len(stock_codes) for e in range(len(stock_codes))]\nbounds = tuple((0, 1) for x in range(len(stock_codes)))\n\nefficient_fronter_return_range = np.arange(min(all_return), max(all_return),(max(all_return) - min(all_return))/20)\nefficient_fronter_risk_list = []\n\nfor i in efficient_fronter_return_range:\n    constraints = [{'type': 'eq', 'fun': lambda x: sum(x) - 1},\n                   {'type': 'eq', 'fun': lambda x: sum(x * Expected_R) - i}]\n    efficient_fronter = solver.minimize(standard_deviation, x0=x0, constraints=constraints, bounds=bounds)\n    efficient_fronter_risk_list.append(efficient_fronter.fun)\n```\n\n\n\n```python\nlabel_size = 27\ntick_size = 15\nTitle_size = 40\nTitle = 'Efficient Frontier'\n\nfig = plt.figure(figsize = (20,8))\n\nax = fig.add_subplot()\nax.grid(True)\n\nax_main = ax.scatter(all_Portfolio_risk, all_return, c=SR,alpha=1)\n\nax.set_title(Title, fontsize=Title_size,family = 'monospace',ha = 'center')\nax.set_xlabel('$Ïƒ_{P}$', fontsize=label_size, fontweight='bold')\nax.set_ylabel('$E(R)$', fontsize=label_size, fontweight='bold')\n\nax.tick_params(labelsize=tick_size) \n\nax.plot(efficient_fronter_risk_list, efficient_fronter_return_range, linewidth=5, color='#251f6b')\nax.plot(mvp_risk, mvp_return,'o',color='r', markerfacecolor='#ed1313',  markersize=15)\n\ncbar = fig.colorbar(ax_main, ax=ax, label = '$Sharpe$ $Ratio$')\ncbar = cbar.ax\ncbar.tick_params(labelsize=tick_size) \ncbar_Title = cbar.yaxis.label\nfont = matplotlib.font_manager.FontProperties(size=label_size)\ncbar_Title.set_font_properties(font)\nfig.savefig('Efficient_Frontier_4.png',dpi=300, bbox_inches='tight')\n```\n\n<img src=\"https://i.imgur.com/X2kXG6k.png\" width = \"100%\"/>\n\n### å®Œæ•´ç¨‹å¼ç¢¼/SQL/\n\n```python\nfrom sqlalchemy import create_engine\n\nimport pandas as pd\n\nimport matplotlib\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nimport numpy as np\nfrom functools import reduce\nimport scipy.optimize as solver\n\nuser = 'root'\npw = \"YourPassword\"\ndb = \"TWSE\"\nengine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=db))\n\nStart = '2020/10/20 00:00:00'\nEnd = '2021/1/10 23:59:59'\n\nSQL = '''\nSELECT `æ”¶ç›¤åƒ¹` FROM `{}` WHERE `è­‰åˆ¸ä»£è™Ÿ` = '{}' AND `æ—¥æœŸ` BETWEEN '{}' AND '{}' ORDER BY `æ—¥æœŸ`\n'''\n\nstock_codes = ['2330','2317','1234']\n\ndef getSQL(stock_code):\n    df = pd.read_sql(SQL.format('æ¯æ—¥æ”¶ç›¤è¡Œæƒ…',stock_code, Start, End), engine, coerce_float=True, parse_dates=True)\n    return df\n\ndef Tsql(stock_codes):\n    for i in range(0,len(stock_codes)):\n        globals()[i] = getSQL(stock_codes[i])\n        if i == 0:\n            df = pd.DataFrame(globals()[i].pct_change())\n            df = df.rename(columns = {'æ”¶ç›¤åƒ¹':stock_codes[i]})\n        else:\n            df['{}'.format(stock_codes[i])] = globals()[i].pct_change()\n    df = df.replace([np.inf, -np.inf,np.nan], 0)\n    return df\n\nreturns = Tsql(stock_codes)\n\nExpected_R = returns.mean() * 252\ncov_matrix = returns.cov()*252\n\nPortfolio_risk = lambda a, b,c: np.sqrt(np.dot(np.dot(a,b),c))\nall_Portfolio_risk = []\nall_return = []\n\nstop = 0\n\nwhile stop < 10000:\n    try:\n        stop += 1\n        W = np.random.rand(len(stock_codes))\n        W = W/sum(W)\n        all_return.append(sum(Expected_R * W))\n        all_Portfolio_risk.append(Portfolio_risk(W, cov_matrix,W.T))\n    except:\n        pass\n\ndef standard_deviation(W):\n    return Portfolio_risk(W, cov_matrix,W.T)\n\nx0 = [1/len(stock_codes) for e in range(len(stock_codes))]\nbounds = tuple((0, 1) for x in range(len(stock_codes)))\nconstraints = [{'type': 'eq', 'fun': lambda x: sum(x) - 1}]\n\nmin_Portfolio_risk = solver.minimize(standard_deviation, x0=x0, constraints=constraints, bounds=bounds)\nmvp_risk = min_Portfolio_risk.fun\nmvp_return = sum(min_Portfolio_risk.x * Expected_R)\n\n\nprint('é¢¨éšªæœ€å°åŒ–æŠ•è³‡çµ„åˆé æœŸå ±é…¬ç‡ç‚º:' + str(round(mvp_return,2)))\nprint('é¢¨éšªæœ€å°åŒ–æŠ•è³‡çµ„åˆé¢¨éšªç‚º:' + str(round(mvp_risk,2)))\n\nfor i in range(0,len(stock_codes)):\n    print(stock_codes[i]+' ä½”æŠ•è³‡çµ„åˆæ¬Šé‡ : ' + str(format(min_Portfolio_risk.x[i], '.4f')))\n\nrisk_free = 0.01\nSR = (np.array(all_return)-risk_free)/np.array(all_Portfolio_risk)\n\nstart = round(min(all_return),6)\nend = round(max(all_return),4)\n\nefficient_fronter_return_range = np.arange(start, end,(max(all_return) - min(all_return))/30)\nefficient_fronter_risk_list = []\n\nfor i in efficient_fronter_return_range:\n    constraints = [{'type': 'eq', 'fun': lambda x: sum(x) - 1},\n                   {'type': 'eq', 'fun': lambda x: sum(x * Expected_R) - i}]\n    efficient_fronter = solver.minimize(standard_deviation, x0=x0, constraints=constraints, bounds=bounds)\n    efficient_fronter_risk_list.append(efficient_fronter.fun)\n\nlabel_size = 27\ntick_size = 15\nTitle_size = 40\nTitle = 'Efficient Frontier'\n\nfig = plt.figure(figsize = (20,8))\n\nax = fig.add_subplot()\nax.grid(True)\n\nax_main = ax.scatter(all_Portfolio_risk, all_return, c=SR,alpha=1)\n\nax.set_title(Title, fontsize=Title_size,family = 'monospace',ha = 'center')\nax.set_xlabel('$Ïƒ_{P}$', fontsize=label_size, fontweight='bold')\nax.set_ylabel('$E(R)$', fontsize=label_size, fontweight='bold')\n\nax.tick_params(labelsize=tick_size) \n\nax.plot(efficient_fronter_risk_list, efficient_fronter_return_range, linewidth=5, color='#251f6b')\nax.plot(mvp_risk, mvp_return,'o',color='r', markerfacecolor='#ed1313',  markersize=15)\n\ncbar = fig.colorbar(ax_main, ax=ax, label = '$Sharpe$ $Ratio$')\ncbar = cbar.ax\ncbar.tick_params(labelsize=tick_size) \ncbar_Title = cbar.yaxis.label\nfont = matplotlib.font_manager.FontProperties(size=label_size)\ncbar_Title.set_font_properties(font)\nfig.savefig('Efficient_Frontier_4.png',dpi=300, bbox_inches='tight')\n```\n\n### å®Œæ•´ç¨‹å¼ç¢¼/å…SQL/\n\n```python\nimport pandas_datareader.data as web\nimport mplfinance as mpf\nimport matplotlib\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nimport numpy as np\nimport scipy.optimize as solver\nstock_code = ['2330','3008','6409','1234','2337','2412']\nstock_codes = ['{}.tw'.format(e) for e in stock_code]\n\ndf = web.DataReader(stock_codes, 'yahoo', '2020-05-01')\n\nreturns = df['Close'].pct_change()\nExpected_R = returns.mean() * 252\ncov_matrix = returns.cov()*252\n\nPortfolio_risk = lambda a, b,c: np.sqrt(np.dot(np.dot(a,b),c))\nall_Portfolio_risk = []\nall_return = []\n\nstop = 0\n\nwhile stop < 50000:\n    try:\n        stop += 1\n        W = np.random.rand(len(stock_codes))\n        W = W/sum(W)\n        all_return.append(sum(Expected_R * W))\n        all_Portfolio_risk.append(Portfolio_risk(W, cov_matrix,W.T))\n    except:\n        pass\n\ndef standard_deviation(W):\n    return Portfolio_risk(W, cov_matrix,W.T)\n\nx0 = [1/len(stock_codes) for e in range(len(stock_codes))]\nbounds = tuple((0, 1) for x in range(len(stock_codes)))\nconstraints = [{'type': 'eq', 'fun': lambda x: sum(x) - 1}]\n\nmin_Portfolio_risk = solver.minimize(standard_deviation, x0=x0, constraints=constraints, bounds=bounds)\nmvp_risk = min_Portfolio_risk.fun\nmvp_return = sum(min_Portfolio_risk.x * Expected_R)\n\n\nprint('é¢¨éšªæœ€å°åŒ–æŠ•è³‡çµ„åˆé æœŸå ±é…¬ç‡ç‚º:' + str(round(mvp_return,2)))\nprint('é¢¨éšªæœ€å°åŒ–æŠ•è³‡çµ„åˆé¢¨éšªç‚º:' + str(round(mvp_risk,2)))\n\nfor i in range(0,len(stock_codes)):\n    print(stock_codes[i]+' ä½”æŠ•è³‡çµ„åˆæ¬Šé‡ : ' + str(format(min_Portfolio_risk.x[i], '.4f')))\n\nrisk_free = 0.01\nSR = (np.array(all_return)-risk_free)/np.array(all_Portfolio_risk)\n\nstart = round(min(all_return),6)\nend = round(max(all_return),4)\n\nefficient_fronter_return_range = np.arange(start, end,(max(all_return) - min(all_return))/30)\nefficient_fronter_risk_list = []\n\nfor i in efficient_fronter_return_range:\n    constraints = [{'type': 'eq', 'fun': lambda x: sum(x) - 1},\n                   {'type': 'eq', 'fun': lambda x: sum(x * Expected_R) - i}]\n    efficient_fronter = solver.minimize(standard_deviation, x0=x0, constraints=constraints, bounds=bounds)\n    efficient_fronter_risk_list.append(efficient_fronter.fun)\n\nlabel_size = 27\ntick_size = 15\nTitle_size = 40\nTitle = 'Efficient Frontier'\n\nfig = plt.figure(figsize = (20,8))\n\nax = fig.add_subplot()\nax.grid(True)\n\nax_main = ax.scatter(all_Portfolio_risk, all_return, c=SR,alpha=1)\n\nax.set_title(Title, fontsize=Title_size,family = 'monospace',ha = 'center')\nax.set_xlabel('$Ïƒ_{P}$', fontsize=label_size, fontweight='bold')\nax.set_ylabel('$E(R)$', fontsize=label_size, fontweight='bold')\n\nax.tick_params(labelsize=tick_size) \n\nax.plot(efficient_fronter_risk_list, efficient_fronter_return_range, linewidth=5, color='#251f6b')\nax.plot(mvp_risk, mvp_return,'o',color='r', markerfacecolor='#ed1313',  markersize=15)\n\ncbar = fig.colorbar(ax_main, ax=ax, label = '$Sharpe$ $Ratio$')\ncbar = cbar.ax\ncbar.tick_params(labelsize=tick_size) \ncbar_Title = cbar.yaxis.label\nfont = matplotlib.font_manager.FontProperties(size=label_size)\ncbar_Title.set_font_properties(font)\nfig.savefig('Efficient_Frontier_4.png',dpi=300, bbox_inches='tight')\n```\n\n"},{"excerpt":"Wordcloud + MongoDB img  MongoDBé€£ç·š import æŠ“å‡ºæ–‡ç« å…§å®¹ Wordcloudåœ– fig 1 fig 2 å­˜åˆ°äº†ä¸€äº›ç„¡é—œç·Šè¦çš„è³‡æ–™ é‡è¤‡æ€§é«˜çš„é–‹é ­ã€å½¢å®¹è©     å°‡ç¬¦è™Ÿç§»é™¤ è‡ªå»ºè© userdict  ä¸­æ–‡æ–·è© jieba åœç”¨è© stopwords.txt  WordCloudåœ– è®€å–txtæª” import Read .txt  ç•«åœ–","fields":{"slug":"/TWSE-11/"},"frontmatter":{"date":"January 26, 2021","title":"ğŸ“ˆ TWSE-11-Wordcloud + MongoDB","tags":["TWSE"]},"rawMarkdownBody":"\n# Wordcloud + MongoDB\n\n## img\n## [`wordcloud.jpg`](https://drive.google.com/file/d/1Id-SEIc5kHHZx0Q62JnI6moJH4BWIWPu/view?usp=sharing)\n\n## MongoDBé€£ç·š\n```python\nmyclient = pymongo.MongoClient(\"mongodb://localhost:27017/\")\nmydb = myclient[\"article\"]\nmycol = mydb[\"2021_é‰…äº¨ç¶²\"]\n```\n### import\n```python\n%matplotlib inline\nimport matplotlib.pyplot as plt\nfrom wordcloud import WordCloud\nfrom PIL import Image\nimport numpy as np\nimport jieba\nimport nltk\nimport pymongo\n```\n### æŠ“å‡ºæ–‡ç« å…§å®¹\n```python\nText = \"\"\nfor x in mycol.find({}):\n    Text = Text + x[\"text\"]\n```\n### Wordcloudåœ–\n```python\nmask = np.array(Image.open('wordcloud.jpg'))\n\nwordcloud = WordCloud(background_color=\"white\",\n                      width=1000, \n                      height=860,\n                      margin=2, \n                      font_path=\"msjhbd.ttc\", \n                      mask=mask).generate(Text)\n\nplt.figure(figsize=(20,20))\nplt.imshow(wordcloud)\nplt.axis(\"off\")\nplt.show()\n```\n#### fig 1\n\n<img src = \"https://i.imgur.com/w7yXGuL.png\" width = \"100%\"/>\n\n#### fig 2\n\n<img src = \"https://i.imgur.com/djIz7rn.jpg\" width = \"100%\"/>\n\n\n\n> 1. å­˜åˆ°äº†ä¸€äº›ç„¡é—œç·Šè¦çš„è³‡æ–™<br>\n> 1. é‡è¤‡æ€§é«˜çš„é–‹é ­ã€å½¢å®¹è©    `ex: å…¶ä¸­ã€ä»Šå¹´ã€ä¸éã€å¦å¤–......`\n\n### å°‡ç¬¦è™Ÿç§»é™¤\n\n```python\nText = Text.translate({ord(c):None for c in list(\"(),.â€œâ€ï¼ˆï¼‰ã€Œã€ï¼Œã€‚ã€ï¼šï¼›ï¼|\\n/ ã€Šã€‹ã€”ã€•ã€ˆã€‰ï¼Ÿ\")})\n```\n\n### è‡ªå»ºè© userdict\n\n## [`userdict.txt`](https://drive.google.com/file/d/1AYA7M_yYBl-a-F5fo7UyDKMfj0Dt-v5L/view?usp=sharing)\n\n```python\njieba.load_userdict(\"userdict.txt\")\n```\n\n### ä¸­æ–‡æ–·è© jieba\n\n```python\nterms = jieba.cut(Text)\n```\n\n### åœç”¨è© stopwords.txt\n## [`stopwords.txt`](https://drive.google.com/file/d/1mlYor3CvvUijM3RdKJdav55PQYcfM8vB/view?usp=sharing)\n\n```python\nstopwords = list()\nwith open(\"stopwords.txt\", \"r\", encoding = \"utf-8\") as fp:\n    stopwords = [word.strip() for word in fp.readlines()]\n    keyterms = [keyterm for keyterm in terms if keyterm not in stopwords]\n\nText = \"/\".join(keyterms)\n```\n\n### WordCloudåœ–\n\n```python\nmask = np.array(Image.open('wordcloud.jpg'))\n\nwordcloud = WordCloud(background_color=\"white\",\n                      width=1000, \n                      height=860, \n                      margin=2, \n                      font_path=\"msjhbd.ttc\", \n                      mask=mask).generate(Text)\n\nplt.figure(figsize=(20,20))\nplt.imshow(wordcloud)\nplt.axis(\"off\")\nplt.show()\n```\n\n\n\n<img src = \"https://i.imgur.com/OYxB22I.png\" width = \"100%\"/>\n\n## è®€å–txtæª” \n\n### import\n```python\n%matplotlib inline\nimport matplotlib.pyplot as plt\nfrom wordcloud import WordCloud\nfrom PIL import Image\nimport numpy as np\nimport jieba\nimport nltk\n```\n### Read *.txt*\n\n## [`test_text.txt`](https://drive.google.com/file/d/1jLms-N-OUATzar8btI6OBcc-AM9McL9Y/view?usp=sharing)\n\n```python\nwith open(\"test_text.txt\", \"r\", encoding = \"utf-8\") as fp:\n    Text = fp.read()\n```\n### ç•«åœ–\n```python\nText = Text.translate({ord(c):None for c in list(\"(),.â€œâ€ï¼ˆï¼‰ã€Œã€ï¼Œã€‚ã€ï¼šï¼›ï¼|\\n/ ã€Šã€‹ã€”ã€•ã€ˆã€‰ï¼Ÿ\")})\n\njieba.load_userdict(\"userdict.txt\")\nterms = jieba.cut(Text)\n\nstopwords = list()\nwith open(\"stopwords.txt\", \"r\", encoding = \"utf-8\") as fp:\n    stopwords = [word.strip() for word in fp.readlines()]\n    keyterms = [keyterm for keyterm in terms if keyterm not in stopwords]\n\nText = \"/\".join(keyterms)\n\nmask = np.array(Image.open('wordcloud.jpg'))\n\nwordcloud = WordCloud(background_color=\"white\",\n                      width=1000, \n                      height=860, \n                      margin=2, \n                      font_path=\"msjhbd.ttc\", \n                      mask=mask).generate(Text)\n\nplt.figure(figsize=(20,20))\nplt.imshow(wordcloud)\nplt.axis(\"off\")\nplt.show()\n```\n"},{"excerpt":"æ‰¾å‡ºä¸€æ®µæ™‚é–“çš„è³‡æ–™ 6 åˆªé™¤é‡è¤‡è³‡æ–™ åƒè€ƒè³‡æ–™\r\nmongo åˆ é™¤é‡å¤æ•°æ®\r\npymongoå»é™¤é‡å¤æ•°æ®\r\npymongo: remove duplicates (map reduce?) MongoDBåŸ·è¡Œ æº–å‚™é‡è¤‡è³‡æ–™ åŸ·è¡Œç¨‹å¼ç¢¼/SQL/ PythonåŸ·è¡Œ æº–å‚™é‡è¤‡è³‡æ–™ åŸ·è¡Œç¨‹å¼ç¢¼/Python/ 7 $orderby åƒè€ƒè³‡æ–™\r\n$orderby\r\ncursor.sort() å…ˆè¤‡è£½coâ€¦","fields":{"slug":"/TWSE-10-4/"},"frontmatter":{"date":"January 20, 2021","title":"ğŸ“ˆ TWSE-10-4-MongoDB+Python","tags":["TWSE"]},"rawMarkdownBody":"\r\n##### `find({'Date': {\"$&#0036;gte\": start,\"$&#0036;lte\": end}})`\r\n###### æ‰¾å‡ºä¸€æ®µæ™‚é–“çš„è³‡æ–™\r\n```python\r\nstart = datetime.datetime(2021, 1, 21, 0)\r\nend = datetime.datetime(2021, 1, 22, 20)\r\nfor x in mycol.find({'Date': {\"$gte\": start,\"$lte\": end}}).sort(\"Date\"):\r\n    print(x)\r\n```\r\n#### 6 åˆªé™¤é‡è¤‡è³‡æ–™\r\n\r\n> **åƒè€ƒè³‡æ–™**<br>\r\n> [mongo åˆ é™¤é‡å¤æ•°æ®](https://segmentfault.com/a/1190000020056997)<br>\r\n> [pymongoå»é™¤é‡å¤æ•°æ®](http://ldllidonglin.github.io/blog/2015/12/14/2015-12-14-mongodb%E5%8E%BB%E9%99%A4%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE/)<br>\r\n> [pymongo: remove duplicates (map reduce?)](https://stackoverflow.com/questions/34722866/pymongo-remove-duplicates-map-reduce)\r\n\r\n##### MongoDBåŸ·è¡Œ\r\n###### æº–å‚™é‡è¤‡è³‡æ–™\r\n\r\n<img src = \"https://i.imgur.com/T6o6ocf.jpg\" width = \"100%\"/>\r\n\r\n###### åŸ·è¡Œç¨‹å¼ç¢¼/SQL/\r\n```SQL\r\ndb.getCollection(\"test\").aggregate([\r\n    {\r\n        $group:{_id:{Title:'$Title'},count:{$sum:1},dups:{$addToSet:'$_id'}}\r\n    },\r\n    {\r\n        $match:{count:{$gt:1}}\r\n    }\r\n\r\n    ]).forEach(function(it){\r\n\r\n         it.dups.shift();\r\n            db.getCollection(\"test\").remove({_id: {$in: it.dups}});\r\n\r\n    });db.getCollection(\"test\").aggregate([\r\n    {\r\n        $group:{_id:{Title:'$Title'},count:{$sum:1},dups:{$addToSet:'$_id'}}\r\n    },\r\n    {\r\n        $match:{count:{$gt:1}}\r\n    }\r\n\r\n    ]).forEach(function(it){\r\n\r\n         it.dups.shift();\r\n            db.getCollection(\"test\").remove({_id: {$in: it.dups}});\r\n\r\n    });\r\n\r\n```\r\n<img src = \"https://i.imgur.com/t7p0bjf.png\" width = \"100%\"/>\r\n\r\n##### PythonåŸ·è¡Œ\r\n###### æº–å‚™é‡è¤‡è³‡æ–™\r\n```python\r\nfor i in range(10):\r\n    mydict = { \"Title\": title, \"text\": text }\r\n    x = mycol.insert_one(mydict)\r\n```\r\n\r\n<img src = \"https://i.imgur.com/elKxfJ9.jpg\" width = \"100%\"/>\r\n\r\n###### åŸ·è¡Œç¨‹å¼ç¢¼/Python/\r\n```python\r\ncursor = mycol.aggregate(\r\n    [\r\n        {\"$group\": {\"_id\": \"$Title\", \"unique_ids\": {\"$addToSet\": \"$_id\"}, \"count\": {\"$sum\": 1}}},\r\n        {\"$match\": {\"count\": { \"$gte\": 2 }}}\r\n    ]\r\n)\r\n\r\nresponse = []\r\nfor doc in cursor:\r\n    del doc[\"unique_ids\"][0]\r\n    for id in doc[\"unique_ids\"]:\r\n        response.append(id)\r\n\r\nmycol.remove({\"_id\": {\"$in\": response}})\r\n```\r\n<img src = \"https://i.imgur.com/sEj2NQS.jpg\" width = \"100%\"/>\r\n\r\n#### 7 [$orderby](https://docs.mongodb.com/manual/reference/operator/meta/orderby/)\r\n> **åƒè€ƒè³‡æ–™**<br>\r\n> [$orderby](https://docs.mongodb.com/manual/reference/operator/meta/orderby/)<br>\r\n> [cursor.sort()](https://docs.mongodb.com/manual/reference/method/cursor.sort/)\r\n\r\n<img src = \"https://i.imgur.com/2nnO2dz.jpg\" width = \"100%\"/>\r\n\r\n> å…ˆè¤‡è£½collectionï¼Œé¿å…å‡ºéŒ¯\r\n\r\n##### ä¸æ”¹è®ŠåŸå§‹è³‡æ–™\r\n###### åŸ·è¡Œç¨‹å¼ç¢¼/SQL/\r\n```sql\r\ndb.getCollection('2021_é‰…äº¨ç¶²_copy').find().sort( { Date: -1 } )\r\n```\r\n<blockquote>\r\n<p>If MongoDB requires using <strong>more than 100 megabytes</strong> of system memory for the <strong>blocking sort operation</strong>, MongoDB returns an error unless the query specifies <a href=\"https://docs.mongodb.com/manual/reference/method/cursor.allowDiskUse/#cursor.allowDiskUse\" target=\"_blank\" rel=\"noopener noreffer\"><code>cursor.allowDiskUse()</code></a> <strong>(New in MongoDB 4.4). </strong><code>allowDiskUse()</code> allows MongoDB to use temporary files on disk to store data exceeding the 100 megabyte system memory limit while processing a blocking sort operation.</p>\r\n\r\n <p align=\"right\">\r\n åŸæ–‡åƒè€ƒè‡ªï¼š\r\n <a href=\"https://docs.mongodb.com/manual/reference/operator/meta/orderby/\" style=\"text-decoration:none;\">$orderby</a>\r\n </p>\r\n</blockquote>\r\n\r\n###### åŸ·è¡Œç¨‹å¼ç¢¼/Python/\r\n```python\r\nfor x in mycol.find({}).sort(\"Date\"):\r\n    print(x)\r\n```"},{"excerpt":"5  åƒè€ƒè³‡æ–™\r\nTutorial â€” PyMongo v2.0.1 documentation\r\nw3schools\r\nCollection Methods\r\nFinding duplicate keys with MongoDBâ€™s aggregation framework  å…¨éƒ¨   è¨ˆç®—å…¨éƒ¨æ•¸é‡  ç‰¹å®šè³‡æ–™   æŒ‡å®šæ—¥æœŸä¹‹å‰çš„æ‰€æœ‰è³‡æ–™.sort(\"Date\")","fields":{"slug":"/TWSE-10-3/"},"frontmatter":{"date":"January 20, 2021","title":"ğŸ“ˆ TWSE-10-3-MongoDB+Python","tags":["TWSE"]},"rawMarkdownBody":"\r\n#### 5 `find`\r\n> **åƒè€ƒè³‡æ–™**<br>\r\n> [Tutorial â€” PyMongo v2.0.1 documentation](https://api.mongodb.com/python/2.0.1/tutorial.html)<br>\r\n> [w3schools](https://www.w3schools.com/python/python_mongodb_getstarted.asp)<br>\r\n> [Collection Methods](https://docs.mongodb.com/manual/reference/method/js-collection/)<br>\r\n> [Finding duplicate keys with MongoDBâ€™s aggregation framework](https://blog.mlab.com/2014/03/finding-duplicate-keys-with-the-mongodb-aggregation-framework/#:~:text=While%20MongoDB%20supports%20an%20option,then%20delete%20all%20subsequent%20values.)\r\n\r\n##### `find({})`\r\n###### å…¨éƒ¨\r\n\r\n```python\r\nfor x in mycol.find({}):\r\n    print(x)\r\n```\r\n![](https://i.imgur.com/sNXC0aF.jpg)\r\n##### `find({}).count()`\r\n###### è¨ˆç®—å…¨éƒ¨æ•¸é‡\r\n```python\r\nmycol.find({}).count()\r\n```\r\n##### `find({\"X\":\"XX\"})`\r\n###### ç‰¹å®šè³‡æ–™\r\n```python\r\nfor x in mycol.find({\"Title\":\"å®æ³°äººå£½æ¸›è³‡å†å¢è³‡ ä¸ŸåŒ…è¢±223.9å„„å…ƒè£œè™§æ 2æœˆåº•å‰ç¾å¢19.5å„„å…ƒ\"}):\r\n    print(x)\r\n```\r\n![](https://i.imgur.com/NeddeDj.jpg)\r\n\r\n##### `find({\"X\": {\"$&#0036;lt\": X}}).sort(\"XX\")`\r\n###### æŒ‡å®šæ—¥æœŸä¹‹å‰çš„æ‰€æœ‰è³‡æ–™.sort(\"Date\")\r\n```python\r\nd = datetime.datetime(2021, 1, 21, 23)\r\nfor x in mycol.find({\"Date\": {\"$lt\": d}}).sort(\"Date\"):\r\n    print(x)\r\nprint(mycol.find({\"Date\": {\"$lt\": d}}).sort(\"Date\").count())\r\n```"},{"excerpt":"Python + bs4 + é‰…äº¨ç¶² 1 def get_text(i): 2 importå¥—ä»¶ 3 Create DB,  Collection 4 Insert document","fields":{"slug":"/TWSE-10-2/"},"frontmatter":{"date":"January 20, 2021","title":"ğŸ“ˆ TWSE-10-2-MongoDB+Python","tags":["TWSE"]},"rawMarkdownBody":"### Python + bs4 + é‰…äº¨ç¶²\r\n#### 1 def get_text(i):\r\n```python\r\ndef get_text(i):\r\n    post_id = urls[i].split('/')[5].split('?')[0]\r\n    data = urllib.request.urlopen(urls[i])\r\n    soup = BeautifulSoup(da\r\n    P = soup.find_all('p')\r\n    text = ''\r\n    for i,p in zip(range(0,len(P)),P):\r\n        if i >=4:\r\n            text = text + p.getText()\r\n        i += 1\r\n    tags = soup.find_all('a')\r\n    n_tags = []\r\n    for tag in tags:\r\n        if re.match('/tag/', str(tag.get('href'))):\r\n            n_tags.append(str(tag.get('href'))[5:len(str(tag.get('href')))])\r\n\r\n    title = soup.find('h1').getText()\r\n    T = soup.find('time')\r\n    Date = datetime.datetime.strptime(T['datetime'], \"%Y-%m-%dT%H:%M:%S+08:00\")\r\n    return(Date,post_id,title,n_tags,text)\r\n```\r\n#### 2 importå¥—ä»¶\r\n```python\r\nimport pymongo\r\nimport urllib\r\nfrom bs4 import BeautifulSoup\r\nimport regex as re\r\nimport datetime\r\n```\r\n#### 3 Create DB,  Collection\r\n```python\r\nmyclient = pymongo.MongoClient(\"mongodb://localhost:27017/\")\r\nmydb = myclient[\"article\"]\r\nmycol = mydb[\"2021_é‰…äº¨ç¶²\"]\r\n```\r\n#### 4 Insert document\r\n```python\r\nurl = 'https://news.cnyes.com/news/cat/tw_stock_news?exp=a'\r\ndata = urllib.request.urlopen(url)\r\nsoup = BeautifulSoup(data, 'html.parser')\r\nhrefs = soup.find_all('a')\r\nurls = ['https://news.cnyes.com'+ str(href.get('href')) for href in hrefs if re.match('/news/id/', str(href.get('href')))]\r\nfor i in range(0,len(urls)):\r\n    data = get_text(i)\r\n    mydict = { \"Date\": data[0], \"post_id\":data[1],\"Title\": data[2], \"Tags\":data[3] , \"text\": data[4] }\r\n    x = mycol.insert_one(mydict)\r\n```\r\n![](https://i.imgur.com/IpoR1Fq.jpg)\r\n![](https://i.imgur.com/6Mkm8up.jpg)"},{"excerpt":"NoSQL MonogoDB + Python MonogoDB  åƒè€ƒè³‡æ–™\nWindows MongoDB ä¸‹è¼‰èˆ‡å®‰è£æ•™å­¸\né—œæ–¼ MongoDB çš„ _id æ¬„ä½\nMongoDBçš„_idå’ŒObjectIdæ€éº¼ç†è§£ï¼ŸåŒæ¨£æ˜¯ç¨‹å¼è¨­è¨ˆå¸«ï¼Œç”¨å¿ƒä½ å°±è¶…å‰äº†\nMongoDB Data Types MongoDB Version MongoDB Data Types Robo 3T Download åƒè€ƒè³‡â€¦","fields":{"slug":"/TWSE-10-1/"},"frontmatter":{"date":"January 19, 2021","title":"ğŸ“ˆ TWSE-10-1-MongoDB+Python","tags":["TWSE"]},"rawMarkdownBody":"\n# NoSQL MonogoDB + Python\n## MonogoDB\n1. [` Download `](https://www.mongodb.com/try/download/community)\n\n> **åƒè€ƒè³‡æ–™**\n> [Windows MongoDB ä¸‹è¼‰èˆ‡å®‰è£æ•™å­¸](https://matthung0807.blogspot.com/2019/08/mongodb.html)\n> [é—œæ–¼ MongoDB çš„ _id æ¬„ä½](https://navicat.com/cht/company/aboutus/blog/1097-all-about-mongodb-s-_id-field.html)\n> [MongoDBçš„_idå’ŒObjectIdæ€éº¼ç†è§£ï¼ŸåŒæ¨£æ˜¯ç¨‹å¼è¨­è¨ˆå¸«ï¼Œç”¨å¿ƒä½ å°±è¶…å‰äº†](https://kknews.cc/code/66g54mp.html)\n> [MongoDB Data Types](https://www.w3schools.in/mongodb/data-types/#Different_MongoDB_Data_Types)\n\n### MongoDB Version\n```SQL\ndb.version()\n\n>>> 4.4.2\n```\n### [MongoDB Data Types](https://www.w3schools.in/mongodb/data-types/#Different_MongoDB_Data_Types)\n## Robo 3T\n\n[Download](https://robomongo.org/download)\n\n> **åƒè€ƒè³‡æ–™**\n>  [MongoDB ä½¿ç”¨Robo 3Tå»ºç«‹è³‡æ–™åº«](https://matthung0807.blogspot.com/2019/08/mongodb-robo-3t.html)\n\n\n\n## Python\n\n### [w3schools](https://www.w3schools.com/python/python_mongodb_getstarted.asp)\n\n#### 1 pip install\n\n```powershell\npip install pymongo\n```\n\n#### 2 import\n```python\nimport pymongo\nmyclient = pymongo.MongoClient(\"mongodb://localhost:27017/\")\n```\n#### 3 æ¸¬è©¦ç”¨æ–‡ç« \n```python\n#æ¸¬è©¦æ–‡ç« \ntitle = 'ç›¤ä¸­é›¶è‚¡äº¤æ˜“å°ç©é›»æœ€å—æ­¡è¿ æˆäº¤é‡‘é¡é€¼è¿‘200å„„å…ƒ'\ntext = '''å°è‚¡æ”»ä¸Šæ³¢æ®µæ–°é«˜ï¼Œé€£å¸¶æ€èµ·é›¶è‚¡äº¤æ˜“ç†±æ½®ï¼Œæ ¹æ“šè­‰äº¤æ‰€çµ±è¨ˆï¼Œç›¤ä¸­é›¶è‚¡äº¤æ˜“è‡ªå»å¹´ 10 æœˆ 26 æ—¥å¯¦æ–½ä»¥ä¾†ï¼Œæˆªè‡³ä»Šå¹´ 1 æœˆ 15 æ—¥æ­¢ï¼Œå–®æ—¥å¹³å‡æˆäº¤é‡‘é¡é” 8.73 å„„å…ƒï¼ŒåŠ ä¸Šç›¤å¾Œäº¤æ˜“ï¼Œå–®æ—¥å¹³å‡é‡‘é¡è¶…é 10 å„„å…ƒï¼Œå…¶ä¸­æ¬Šå€¼è‚¡ç‹å°ç©é›» (2330-TW) ç´¯è¨ˆæˆäº¤å€¼é€¼è¿‘ 200 å„„å…ƒï¼Œæ˜¯æœ€ç†±é–€çš„äº¤æ˜“æ¨™çš„ã€‚æ ¹æ“šè­‰äº¤æ‰€çµ±è¨ˆï¼Œç›¤ä¸­é›¶è‚¡äº¤æ˜“å‰ 10 å¤§ç†±é–€æ¨™é¦–æ¨å°ç©é›»ï¼Œäº¤æ˜“é‡‘é¡æ¯”é‡é«˜é” 34%ï¼Œå…¶æ¬¡åˆ†åˆ¥ç‚ºï¼šå¤§ç«‹å…‰ (3008-TW)(12%)ã€è¯ç™¼ç§‘ (2454-TW)(5%)ã€åœ‹å·¨ (2327-TW)(3%)ã€å…ƒå¤§å°ç£ 50(2%)ã€é´»æµ· (2317-TW)(2%)ï¼›å¦å¤–ï¼Œè¯é›» (2303-TW)ã€å°é”é›» (2308-TW)ã€ç‰æ™¶å…‰ (3406-TW)ã€åŒæ¬£é›» (6271-TW) äº¤æ˜“é‡‘é¡ä¹Ÿæœ‰ 1% çš„æ¯”é‡ã€‚ä»¥æˆäº¤è‚¡æ•¸ä¾†çœ‹ï¼Œå°ç©é›»ä»¥å æ•´é«”äº¤æ˜“æ¯”é‡ 8% å±…å† ï¼Œå…¶ä»–ä¾åºåˆ†åˆ¥ç‚ºï¼šè¯é›»ã€é´»æµ·ã€å…ƒå¤§é«˜è‚¡æ¯ã€ç‰å±±é‡‘ (2884-TW)ã€å…ƒå¤§å°ç£ 50ã€é•·æ¦®ã€å…ƒæ™¶ã€æ•¦æ³°èˆ‡ç¬¬ä¸€é‡‘ã€‚ä»¥å°ç©é›»ä¾†èªªï¼Œå‡è¨­æŠ•è³‡äººåœ¨ 10 æœˆ 26 æ—¥ç•¶å¤©é«˜é» 455 å…ƒè²·é€²å°ç©é›»çºŒæŠ±è‡³ä»Šï¼Œä»¥ä»Šå¤©æ”¶ç›¤åƒ¹ 627 å…ƒè¨ˆç®—ï¼ŒæœŸé–“è‚¡åƒ¹ç´„ä¸Šæ¼² 37%ï¼Œå…¶ä»–åŒ…æ‹¬è¯é›»ã€é´»æµ·è‚¡åƒ¹åœ¨æœŸé–“æ”»ä¸Šæ­·å²é«˜é»ï¼ŒåŒæ¨£è®“é›¶è‚¡æŠ•è³‡äººè³ºé€²ä¸€ç­†æ”¶ç›Šã€‚'''\n```\n#### 4 Create DB,  Collection and Insert document\n```python\nmydb = myclient[\"article\"]\nmycol = mydb[\"test\"]\nmydict = { \"Title\": title, \"text\": text }\n\nx = mycol.insert_one(mydict)\n```\n\n<img src = \"https://i.imgur.com/3gU1M88.jpg\" width = \"100%\" />\n<img src = \"https://i.imgur.com/NH2PNU2.jpg\" width = \"100%\" />\n\n#### 5 å°å‡ºæ‰€æœ‰DB\n```python\nprint(myclient.list_database_names())\n```\n####  6 å°å‡ºæ‰€æœ‰collection\n```python\nprint(mydb.list_collection_names())\n```"},{"excerpt":"BeautifulSoup + é‰…äº¨ç¶² åŸå§‹ç¢¼ æ–‡ç« ç¶²å€ æ‰¾åˆ°  regex  å¤šå€‹URLå­˜æˆList å¤šå€‹URLçš„æ–‡ç« è§£æ æ‰¾å‡ºæ–‡ç« çš„æ¨™é¡Œ æ‰¾åˆ° æ‰¾å‡ºæ–‡ç« çš„tags æ‰¾åˆ°    tagså­˜æˆlist æ–‡ç« å…§æ–‡ æ‰¾åˆ°  å–çš„å…§æ–‡  åŒ…è£æˆdef","fields":{"slug":"/TWSE-9/"},"frontmatter":{"date":"January 19, 2021","title":"ğŸ“ˆ TWSE-9-Bs4 + é‰…äº¨ç¶²","tags":["TWSE"]},"rawMarkdownBody":"\n# BeautifulSoup + é‰…äº¨ç¶²\n\n```python\nimport urllib\nfrom bs4 import BeautifulSoup\n\nurl = 'https://news.cnyes.com/news/cat/tw_stock_news?exp=a'\ndata = urllib.request.urlopen(url)\nsoup = BeautifulSoup(data, 'html.parser')\n```\n## åŸå§‹ç¢¼\n```python\nprint(soup)\n```\n### æ–‡ç« ç¶²å€\n#### æ‰¾åˆ° `<a>...</a>`\n\n```python\nhrefs = soup.find_all('a')\n```\n\n#### regex\n```python\nimport regex as re\nfor href in hrefs:\n    if re.match('/news/id/', str(href.get('href'))):\n        print('https://news.cnyes.com'+ str(href.get('href')))\n```\n\n![](https://i.imgur.com/cOqYyCH.jpg)\n\n#### å¤šå€‹URLå­˜æˆList\n\n```python\nurls = ['https://news.cnyes.com'+ str(href.get('href')) for href in hrefs if re.match('/news/id/', str(href.get('href')))]\n```\n\n### å¤šå€‹URLçš„æ–‡ç« è§£æ\n\n```python\ndata = urllib.request.urlopen(urls[0])\nsoup = BeautifulSoup(data, 'html.parser')\n```\n#### æ‰¾å‡ºæ–‡ç« çš„æ¨™é¡Œ\n##### æ‰¾åˆ°`<h1>...</h1>`\n\n```python\ntitle = soup.find('h1').getText()\n```\n\n#### æ‰¾å‡ºæ–‡ç« çš„tags\n\n##### æ‰¾åˆ° `<a>...</a>`\n```python\ntags = soup.find_all('a')\nfor tag in tags:\n    print(tag)\n```\n\n```python\ntags = soup.find_all('a')\nfor tag in tags:\n    print(tag.get('href'))\n```\n![](https://i.imgur.com/ITWN9r4.jpg)\n\n```python\nfor tag in tags:\n    if re.match('/tag/', str(tag.get('href'))):\n        print(str(tag.get('href'))[5:len(str(tag.get('href')))])\n```\n![](https://i.imgur.com/yra17Bg.jpg)\n\n##### tagså­˜æˆlist\n```python\nn_tags = []\nfor tag in tags:\n        if re.match('/tag/', str(tag.get('href'))):\n            n_tags = n_tags.append(str(tag.get('href'))[5:len(str(tag.get('href')))])\n```\n\n\n#### æ–‡ç« å…§æ–‡\n\n\n##### æ‰¾åˆ° `<p>...</p>`\n\n```python\nP = soup.find_all('p')\nprint(P)\n```\n\n##### å–`<p>...</p>`çš„å…§æ–‡\n\n```python\nfor p in P:\n    print(p.getText())\n```\n\n![](https://i.imgur.com/xdrcWhr.jpg)\n\n```python\nfor i,p in zip(range(0,len(P)),P):\n    if i >=4:\n        print(p.getText())\n    i += 1\n```\n##### åŒ…è£æˆdef\n```python\ndef get_text(i):\n    \n    data = urllib.request.urlopen(urls[i])\n    soup = BeautifulSoup(data, 'html.parser')\n    \n    P = soup.find_all('p')\n    text = ''\n    for i,p in zip(range(0,len(P)),P):\n        if i >=4:\n            text = text + p.getText()\n        i += 1\n\n    tags = soup.find_all('a')\n    n_tags = []\n    for tag in tags:\n        if re.match('/tag/', str(tag.get('href'))):\n            n_tags.append(str(tag.get('href'))[5:len(str(tag.get('href')))])\n\n    title = soup.find('h1').getText()\n    \n    return(title,n_tags,text)\n```"},{"excerpt":"plotly | Chart Studio æ¯æ—¥æ”¶ç›¤è¡Œæƒ… 1 è¨»å†Šå¸³è™Ÿ  2 é»é¸SQL Query  3 ä¸‹è¼‰Falcon SQL Client  4 ç™»å…¥SQL è¼¸å…¥MySQLçš„å¸³è™Ÿ, å¯†ç¢¼  5 é»é¸QUERY ç¢ºèªæœ‰ç¢ºå¯¦è®€åˆ°è³‡æ–™åº«  6 é»é¸SCHEDULE 1 é»é¸ Connect to / Chart Studio Enterprise / \n2 Your Chart Studio â€¦","fields":{"slug":"/TWSE-8/"},"frontmatter":{"date":"January 16, 2021","title":"ğŸ“ˆ TWSE-8-plotly | Chart Studio | 1","tags":["TWSE"]},"rawMarkdownBody":"\n# [plotly | Chart Studio](https://chart-studio.plotly.com/feed/#/)\n\n## æ¯æ—¥æ”¶ç›¤è¡Œæƒ…\n\n### 1 è¨»å†Šå¸³è™Ÿ\n![](https://i.imgur.com/tUGwuzY.jpg)\n### 2 é»é¸SQL Query\n![](https://i.imgur.com/HtlvMDO.jpg)\n### 3 ä¸‹è¼‰Falcon SQL Client\n![](https://i.imgur.com/11zmQaS.jpg)\n### 4 ç™»å…¥SQL\n> è¼¸å…¥MySQLçš„å¸³è™Ÿ, å¯†ç¢¼\n\n![](https://i.imgur.com/cm55Xpp.jpg)\n### 5 é»é¸QUERY\n> ç¢ºèªæœ‰ç¢ºå¯¦è®€åˆ°è³‡æ–™åº«\n\n![](https://i.imgur.com/kIRXJCA.jpg)\n### 6 é»é¸**SCHEDULE**\n> 1 é»é¸ Connect to / Chart Studio Enterprise / <br>\n> 2 Your Chart Studio Enterprise Domain / **https://api.plot.ly** /\n\n![](https://i.imgur.com/uqwoSYj.jpg)\n### 7 Authorize\n![](https://i.imgur.com/PPzYfbw.jpg)\n### 8 é»é¸QUERY\n```sql\nSELECT `æ—¥æœŸ`,`æˆäº¤è‚¡æ•¸`,`é–‹ç›¤åƒ¹`,`æœ€é«˜åƒ¹`,`æœ€ä½åƒ¹`,`æ”¶ç›¤åƒ¹`,`color`\nFROM `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` \nWHERE `è­‰åˆ¸ä»£è™Ÿ` = 2330\n```\n![](https://i.imgur.com/NCPN7pA.jpg)\n### 9 é¸æ“‡è¦å¤šä¹…è·‘ä¸€æ¬¡\n![](https://i.imgur.com/NOi9HkA.jpg)\n### 10 é»é¸Live DataSet\n![](https://i.imgur.com/3tk0jJk.jpg)\n\n\n<iframe width=\"100%\" height=\"600\" frameborder=\"0\" scrolling=\"no\" src=\"//plotly.com/~hsiangjenli/15.embed?share_key=FaqYt8fEA36u4olYzePnwm\"></iframe>"},{"excerpt":"Interactive Candlestick Charts Plotly å€‹è‚¡æœˆæˆäº¤è³‡è¨Š SQLé€£ç·š Fig1 Basic fig.show() Fig2 xaxis_rangeslider_visible=False fig.show() Fig3 Color & Title fig.show() æ¯æ—¥æ”¶ç›¤è¡Œæƒ… SQLé€£ç·š rename col /å¯åšå¯ä¸åš/ Fig4 subplots fâ€¦","fields":{"slug":"/TWSE-7/"},"frontmatter":{"date":"December 05, 2020","title":"ğŸ“ˆ TWSE-7-Interactive Candlestick Charts","tags":["TWSE"]},"rawMarkdownBody":"\n# Interactive Candlestick Charts\n\n## Plotly\n\n```shell\npip install plotly\n```\n## å€‹è‚¡æœˆæˆäº¤è³‡è¨Š\n### SQLé€£ç·š\n```python\nuser = 'root'\npw = \"YourPassworrd\"\ndb = \"STOCK\"\n\nengine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=db))\n\ndf = pd.read_sql(\"SELECT* FROM `twse` WHERE `Stock Code` = 2330 \", engine, coerce_float=True, parse_dates=True)\ndf = df.drop(columns = ['Stock Code','Change','Transaction','Trade Value'])\ndf = df.rename(columns = {'Opening Price': 'Open','Highest Price':'High','Closing Price':'Close',\n                        'Lowest Price':'Low','Closing Price':'Close','Trade Volume':'Volume'})\n```\n### Fig1\n#### Basic\n```python\nfig = go.Figure(data=[go.Candlestick(x=df['Date'],\n                open=df['Open'],\n                high=df['High'],\n                low=df['Low'],\n                close=df['Close'])])\n\nfig.write_html(r\"C:\\Users\\User\\Downloads\\Python\\1.html\")\nfig.show()\n```\n#### fig.show()\n\n<iframe src=\"https://d2xihcnwdmcz6tzstvzuow-on.drv.tw/WEB/Plotly.fig_1.htm\" height=\"500\" width=\"100%\" style=\"border:none;\"></iframe>\n\n### Fig2\n#### xaxis_rangeslider_visible=False\n```python\nfig = go.Figure(data=[go.Candlestick(x=df['Date'],\n                open=df['Open'],\n                high=df['High'],\n                low=df['Low'],\n                close=df['Close'])])\n\nfig.update_layout(xaxis_rangeslider_visible=False)\n\nfig.write_html(r\"C:\\Users\\User\\Downloads\\Python\\2.html\")\nfig.show()\n```\n#### fig.show()\n<iframe src=\"https://d2xihcnwdmcz6tzstvzuow-on.drv.tw/WEB/Plotly.fig_2.htm\" height=\"500\" width=\"100%\" style=\"border:none;\"></iframe>\n\n### Fig3\n#### Color & Title\n```python\nfig = go.Figure(data=[go.Candlestick(x=df['Date'],\n                open=df['Open'],\n                high=df['High'],\n                low=df['Low'],\n                close=df['Close'],\n                increasing_line_color= '#5ac390', decreasing_line_color= '#fd6a6c')])\n\nfig.update_layout(\n    title='TWSE Stock Code:2330',\n    yaxis_title='Price',\n    xaxis_rangeslider_visible=False)\n\nfig.write_html(r\"C:\\Users\\User\\Downloads\\Python\\3.html\")                  \nfig.show()\n```\n\n#### fig.show()\n\n<iframe src=\"https://d2xihcnwdmcz6tzstvzuow-on.drv.tw/WEB/Plotly.fig_3.htm\" height=\"500\" width=\"100%\" style=\"border:none;\"></iframe>\n\n## æ¯æ—¥æ”¶ç›¤è¡Œæƒ…\n```python\nimport plotly.graph_objects as go\nimport pandas as pd\n```\n### SQLé€£ç·š\n```python\nimport sqlalchemy\nfrom sqlalchemy import create_engine\n\nuser = 'root'\npw = \"YourPassworrd\"\ndb = \"TWSE\"\nengine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=db))\n\ndf = pd.read_sql(\"SELECT * FROM `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` WHERE `è­‰åˆ¸ä»£è™Ÿ` = 2330\", engine, coerce_float=True, parse_dates=True)\n```\n### rename col /å¯åšå¯ä¸åš/\n```python\ndf = df.rename(columns = {'é–‹ç›¤åƒ¹': 'Open','æœ€é«˜åƒ¹':'High','æ”¶ç›¤åƒ¹':'Close','æœ€ä½åƒ¹':'Low','æ—¥æœŸ':'Date','æˆäº¤è‚¡æ•¸':'Volume'})\n```\n### Fig4\n#### subplots\n```python\nfrom plotly.subplots import make_subplots\n\nfig = make_subplots(rows=2, cols=1)\nfig.add_trace(go.Candlestick(x=df['Date'],\n                open=df['Open'],\n                high=df['High'],\n                low=df['Low'],\n                close=df['Close'],\n                increasing_line_color= '#3D9970', decreasing_line_color= '#FF4136',\n                increasing_fillcolor='#3D9970', decreasing_fillcolor='#FF4136'))\n\nfig.add_trace(go.Bar(y=df['Volume'],x = df['Date'],marker = dict(color=df['color'])), row=2, col=1)\n\nfig.update_layout(\n    paper_bgcolor='#EEEEEE',\n    plot_bgcolor='#EEEEEE',\n    title='TWSE<br>Stock Code:2330',\n    yaxis_title='Price',\n    xaxis_rangeslider_visible=False)\nfig.show()\n```\n#### fig.show()\n<iframe src=\"https://d2xihcnwdmcz6tzstvzuow-on.drv.tw/WEB/Plotly.fig_4.htm\" height=\"500\" width=\"100%\" style=\"border:none;\"></iframe>\n\n### Fig5\n#### Change subplot sizes\n```python\ntrace1 = go.Candlestick(x=df['Date'],\n                open=df['Open'],\n                high=df['High'],\n                low=df['Low'],\n                close=df['Close'],\n                increasing_line_color= '#3D9970', decreasing_line_color= '#FF4136',\n                increasing_fillcolor='#3D9970', decreasing_fillcolor='#FF4136')\n\ntrace2 = go.Bar(y=df['Volume'],x = df['Date'],marker = dict(color=df['color']),yaxis='y2')\n\ndata = [trace1, trace2]\nlayout = go.Layout(yaxis2=dict(domain=[0, 0.3]),\n                   yaxis=dict(domain=[0.35,1]),\n                   \n                   xaxis_rangeslider_visible=False,\n                   title='<b>TWSE</b><br>Stock Code:2330',\n                   title_x = 0.5,\n                   title_font_size = 20,\n                   paper_bgcolor='#EEEEEE',\n                   plot_bgcolor='#EEEEEE',\n                   showlegend = False,\n                   hovermode = 'x unified',\n                   hoverlabel_bgcolor = 'rgba(255,255,255,0.9)',\n                   hoverlabel_namelength = 0)\nfig = go.Figure(data=data, layout=layout)\n\nfig.show()\n```\n#### fig.show()\n<iframe src=\"https://d2xihcnwdmcz6tzstvzuow-on.drv.tw/WEB/Plotly.fig_6.html\" height=\"500\" width=\"100%\" style=\"border:none;\"></iframe>\n\n"},{"excerpt":"SQLé€£ç·š è®€å–è³‡æ–™åº«Tableè‡³Dataframe 1 å–å‡ºæŒ‡å®šcolå€¼ 2 å–å‡ºæŒ‡å®šindexå€¼ 3 å–å‡ºæŒ‡å®šindex and colå€¼ 4 å–å‡ºå¤šå€‹colå€¼ 5 æ¬„ä½åç¨± 6 è³‡æ–™ 7 æ¬„ä½Type 8 indexå€¼ 9 é‡æ–°å‘½å # å¯¦ä½œ è®€å–æŒ‡å®šindexå€¼è‡³Dataframe mplfinance [æ–°ç‰ˆ] æ¯æ—¥æ”¶ç›¤è¡Œæƒ… SQLé€£ç·š é‡æ–°èª¿æ•´Dataframe 1 åˆªæ‰å¤šé¤˜çš„Colâ€¦","fields":{"slug":"/TWSE-6/"},"frontmatter":{"date":"November 29, 2020","title":"ğŸ“ˆ TWSE-6-MySQL to Dataframe & mplfinance Kç·šåœ–","tags":["TWSE"]},"rawMarkdownBody":"\n<div style=\"text-align: right\" Icons made by <a href=\"https://www.flaticon.com/authors/freepik\" title=\"Freepik\">Freepik</a> from <a href=\"https://www.flaticon.com/\" title=\"Flaticon\">www.flaticon.com</a></div>\n\n<h1 style = \"font-family: Verdana;font-weight: 600;\">MySQL to Dataframe\n</h1>\n\n## SQLé€£ç·š\n```python\nuser = 'root'\npw = \"YourPassworrd\"\n\nconn=MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw,charset='utf8')\ncursor=conn.cursor() \n\ncursor.execute(\"CREATE DATABASE IF NOT EXISTS TWSE DEFAULT CHARSET=utf8 DEFAULT COLLATE=utf8_unicode_ci\" )\nengine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=\"TWSE\"))\n\ndf = pd.read_sql(\"SELECT* FROM `twse` WHERE `Stock Code` = 2330 AND `Date` BETWEEN '2019/11/10 00:00:00' AND '2020/1/10 23:59:59'\", engine, coerce_float=True, parse_dates=True) \n```\n## è®€å–è³‡æ–™åº«Tableè‡³Dataframe\n```python\nimport pandas as pd \n\ndf = pd.read_sql('SELECT* FROM `twse`', engine, index_col= 'Stock Code', coerce_float=True, parse_dates='Date')\ndf \n```\n### 1 å–å‡ºæŒ‡å®šcolå€¼\n```python\nprint(df.['Opening Price']) \n```\n### 2 å–å‡ºæŒ‡å®šindexå€¼\n```python\nprint(df.loc['2330'])\n```\n### 3 å–å‡ºæŒ‡å®šindex and colå€¼\n```python\nprint(df.loc['2330']['Opening Price']) \n```\n### 4 å–å‡ºå¤šå€‹colå€¼\n```python\ndf[['Opening Price', 'Closing Price']] \n```\n### 5 æ¬„ä½åç¨±\n```python\ndf.columns \n```\n### 6 è³‡æ–™\n```python\ndf.values\n```\n### 7 æ¬„ä½Type\n```python\ndf.dtypes\n```\n### 8 indexå€¼\n```python\ndf.index\n```\n### 9 é‡æ–°å‘½å\n```python\ndf.rename(columns={'Opening Price': 'Open'}) \n```\n### # å¯¦ä½œ\n> è®€å–æŒ‡å®šindexå€¼è‡³Dataframe\n```python\ndf = pd.read_sql('SELECT* FROM `twse`, engine, index_col= 'Stock Code', coerce_float=True, parse_dates='Date')  \n```\n## mplfinance [æ–°ç‰ˆ]\n```\npip install mplfinance\n```\n```python\nimport mplfinance as mpf \n```\n### æ¯æ—¥æ”¶ç›¤è¡Œæƒ…\n#### SQLé€£ç·š\n```python\nuser = 'root'\npw = \"YourPassworrd\"\n\nconn=MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw,charset='utf8')\ncursor=conn.cursor() \n\ncursor.execute(\"CREATE DATABASE IF NOT EXISTS TWSE DEFAULT CHARSET=utf8 DEFAULT COLLATE=utf8_unicode_ci\" )\nengine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=\"TWSE\"))\n\ndf = pd.read_sql(\"SELECT* FROM `twse` WHERE `Stock Code` = 2330 AND `Date` BETWEEN '2019/11/10 00:00:00' AND '2020/1/10 23:59:59'\", engine, coerce_float=True, parse_dates=True) \n```\n#### é‡æ–°èª¿æ•´Dataframe\n##### 1 åˆªæ‰å¤šé¤˜çš„Col\n```python\ndf = df.drop(columns = ['Stock Code','Change','Transaction','Trade Value'])\n```\n##### 2 é‡æ–°å‘½åCol \n```python\ndf = df.rename(columns = {'Opening Price': 'Open','Highest Price':'High','Closing Price':'Close',\n                       'Lowest Price':'Low','Closing Price':'Close','Trade Volume':'Volume'})\n```\n##### 3 df['Date']å‹æ…‹æ”¹è®Š\n```python\ndf['Date'] = pd.to_datetime(df['Date']) \n```\n##### 4 é‡æ–°æ’åº \n```python\nneworder = ['Open','High','Low','Close','Volume']\ndf = df.reindex(columns=neworder) \n```\n#### Candlestick chart\n##### åŸºæœ¬\n```python\nmpf.plot(df,type='candle') \n```\n<img src = \"https://i.imgur.com/ZHQOYJH.png\" width = \"100%\"/>\n\n##### ç¾åŒ–\n```python\nmc = mpf.make_marketcolors(up='#5ac390',down='#fd6a6c',volume='in',edge='None',)\n\ns  = mpf.make_mpf_style(base_mpl_style='fivethirtyeight',gridstyle='None',marketcolors=mc)\n\nfig = mpf.figure(style=s,figsize=(20,20))\n\nax1 = fig.add_axes([0,0.3,1,0.4])\nax2 = fig.add_axes([0,0.1,1,0.2])\n\nmav=(3,6,9)\n\nmpf.plot(df,\n         type='candle',\n         style=s,\n         volume=ax2,\n         mav=(3,6,9),\n         panel_ratios=(4,1),\n         xrotation=0,\n         ax = ax1,\n         update_width_config = dict(candle_width = 0.95),\n         scale_width_adjustment = dict(lines=2))\n\nax1.legend(['mav '+str(mav[0]),'mav '+str(mav[1]),'mav '+str(mav[2])],\n           loc='best', bbox_to_anchor=(0.2, 1.1),\n           fontsize = 20,\n           frameon = True,\n           edgecolor = 'w',\n           facecolor = 'w'\n           )\nax1.set_title(\n    label = '\\nTWSE\\n\\nStock Code:2330\\n',\n    fontdict={'fontsize':30,\n              'fontweight':'bold',\n              'color':'k'},\n    loc='center'\n             )\n\nax1.set_ylabel('Price',fontdict={'weight': 'bold', 'size': 20})\nax2.set_ylabel('Volume',fontdict={'weight': 'bold', 'size': 20})\n\nax1.yaxis.set_label_position(\"left\")\nax1.yaxis.tick_left()\n\nyticks = np.arange(min(df['Volume']), max(df['Volume']), round( (max(df['Volume']) - min(df['Volume']))/5 ))\nax2.set_yticks(yticks)\n```\n<img src = \"https://i.imgur.com/VvxKi2a.png\" width = \"100%\"/>\n\n### å…é€£SQLç‰ˆ\n\n```python\nimport pandas_datareader.data as web\nimport mplfinance as mpf\nfrom IPython.display import Image\n\nstock_code = '0050.tw'\n\ndf = web.DataReader(stock_code, 'yahoo', '2020-11-01')\ndf = df[['Open', 'High', 'Low', 'Close', 'Volume']]\n```\n\n#### åŸºæœ¬\n\n```python\nmpf.plot(df, type='candle', mav=(5,20), volume=True, title='\\n{stock_code}'.format(stock_code=stock_code), savefig='test_1.png')\n\nImage('test_1.png')\n```\n\n<img src=\"https://i.imgur.com/ipGw9KV.png\" width = \"100%\"/>\n\n#### ç¾åŒ–\n\n```python\nimport matplotlib.pyplot as plt \nimport numpy as np\n\nmc = mpf.make_marketcolors(up='#5ac390',down='#fd6a6c',volume='in',edge='None',)\ns  = mpf.make_mpf_style(base_mpl_style='fivethirtyeight',gridstyle='None',marketcolors=mc)\n\nfig = mpf.figure(style=s,figsize=(20,15))\n\nax1 = fig.add_axes([0.05,0.3,0.95,0.5])\nax2 = fig.add_axes([0.05,0.1,0.95,0.2])\n\nmav = (3,6,9)\nmpf.plot(df,\n         type='candle',\n         style=s,\n         volume=ax2,\n         mav=mav,\n         panel_ratios=(4,1),\n         xrotation=0,\n         ax = ax1,\n         update_width_config = dict(candle_width = 0.95),\n         scale_width_adjustment = dict(lines=2))\n\nax1.legend(['mav '+str(mav[0]),'mav '+str(mav[1]),'mav '+str(mav[2])],\n           loc='best', \n           bbox_to_anchor=(0.2, 1.1),\n           fontsize = 20,\n           frameon = True,\n           edgecolor = 'w',\n           facecolor = 'w')\n\nax1.set_title(\n    label = '\\n\\nStock Code:{}\\n'.format(stock_code),\n    fontdict={'fontsize':30,\n              'fontweight':'bold',\n              'color':'k'},\n    loc='center')\n\nax1.set_xticks([])\nax1.set_ylabel('Price',fontdict={'weight': 'bold', 'size': 20})\nax2.set_ylabel('Volume',fontdict={'weight': 'bold', 'size': 20})\n\nax1.yaxis.set_label_position(\"left\")\nax1.yaxis.tick_left()\n\nyticks = np.arange(min(df['Volume']), max(df['Volume']), round( (max(df['Volume']) - min(df['Volume']))/5 ))\nax2.set_yticks(yticks)\n\nplt.savefig('test_2.png', dpi=300)\n```\n\n<img src=\"https://i.imgur.com/EAGyL8V.png\" width = \"100%\"/>\n\n#### MACD\n\n```python\nimport matplotlib.pyplot as plt \nimport numpy as np\n\nmc = mpf.make_marketcolors(up='#5ac390',down='#fd6a6c',volume='in',edge='None',)\ns  = mpf.make_mpf_style(base_mpl_style='fivethirtyeight',gridstyle='None',marketcolors=mc)\n\nmc = mpf.make_marketcolors(up='#5ac390',down='#fd6a6c',volume='in',edge='None',)\ns  = mpf.make_mpf_style(base_mpl_style='fivethirtyeight',gridstyle='None',marketcolors=mc)\n\nexp12 = df['Close'].ewm(span=12, adjust=False).mean()\nexp26 = df['Close'].ewm(span=26, adjust=False).mean()\n\nmacd = exp12 - exp26\n\nsignal    = macd.ewm(span=9, adjust=False).mean()\nhistogram = macd - signal\n\nfig = plt.figure(figsize=(20,20))\n\nax1 = fig.add_axes([0.05,0.4,0.94,0.5])\nax2 = fig.add_axes([0.05,0.015,0.94,0.2])\nax3 = fig.add_axes([0.05,0.2,0.94,0.2])\n\nstrDate = [str(e).split(' ')[0] for e in df['Close'].index]\nplt.bar(strDate, histogram, color = '#7f7f7f')\nplt.plot(strDate, macd, color = 'b')\nplt.plot(strDate, signal, color = 'r')\n\nmav = (3,6,9)\nmpf.plot(df,\n         type='candle',\n         style=s,\n         volume=ax2,\n         mav=mav,\n         panel_ratios=(4,1),\n         xrotation=0,\n         ax = ax1,\n         update_width_config = dict(candle_width = 0.95),\n         scale_width_adjustment = dict(lines=2))\nax1.legend(['mav '+str(mav[0]),'mav '+str(mav[1]),'mav '+str(mav[2])],\n           loc='best', \n           bbox_to_anchor=(0.2, 1.1),\n           fontsize = 20,\n           frameon = True,\n           edgecolor = 'w',\n           facecolor = 'w')\nax3.legend(['macd','signal'],\n           loc='best', \n           bbox_to_anchor=(0.2, 1.1),\n           fontsize = 20,\n           frameon = True,\n           edgecolor = 'w',\n           facecolor = 'w')\nax1.set_title(\n    label = 'MACD\\n\\nStock Code:{}\\n'.format(stock_code),\n    fontdict={'fontsize':30,\n              'fontweight':'bold',\n              'color':'k'},\n    loc='center')\nax1.set_ylabel('Price',fontdict={'weight': 'bold', 'size': 20})\nax2.set_ylabel('Volume',fontdict={'weight': 'bold', 'size': 20})\nax1.yaxis.set_label_position(\"left\")\nax1.yaxis.tick_left()\nyticks = np.arange(min(df['Volume']), max(df['Volume']), round( (max(df['Volume']) - min(df['Volume']))/5 ))\nax2.set_yticks(yticks)\nax1.set_xticks([])\nax3.set_xticks([])\nax1.set(frame_on=False)\nax2.set(frame_on=False)\nax3.set(frame_on=False)\nplt.savefig('test_3.png', dpi=300)\n```\n\n<img src=\"https://i.imgur.com/JS50WZs.png\" width = \"100%\"/>"},{"excerpt":"mpl_finance [èˆŠç‰ˆ] SQLé€£ç·š å€‹è‚¡æœˆæˆäº¤è³‡è¨Š mpl_finance åŸºæœ¬è¨­å®š å®Œæ•´ç¨‹å¼ç¢¼","fields":{"slug":"/TWSE-5/"},"frontmatter":{"date":"November 29, 2020","title":"ğŸ“ˆ TWSE-5-mpl_finance Kç·šåœ–","tags":["TWSE"]},"rawMarkdownBody":"\n# mpl_finance [èˆŠç‰ˆ]\n\n## SQLé€£ç·š\n### å€‹è‚¡æœˆæˆäº¤è³‡è¨Š\n```python\nimport MySQLdb\n\nuser = 'root'\npw = \"YourPassworrd\"\n\nconn=MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw,charset='utf8')\ncursor=conn.cursor() \ncursor.execute('USE STOCK')\n```\n## mpl_finance\n```python\nimport matplotlib.pyplot as plt\nimport mpl_finance as mpf\n%matplotlib inline\n```\n## åŸºæœ¬è¨­å®š\n```python\np = [int(e) for e in input(\"è«‹è¼¸å…¥èµ·å§‹æ—¥æœŸå’ŒçµæŸæ—¥æœŸ\").split(\" \")] # ä»¥ç©ºæ ¼éš”é–‹\n\nperiod = \"`Date` BETWEEN '{}/{}/{} 00:00:00' AND '{}/{}/{} 23:59:59'\".format(p[0],p[1],p[2],p[3],p[4],p[5])\n\ndef sql_execute(column_name):\n   SQL = \"SELECT {} FROM `twse` WHERE `Stock Code` = {} AND {} ORDER BY `Date`\"\n   cursor.execute(SQL.format(column_name, 1234, period))\n   result = cursor.fetchall()\n   return result\n\ndef get_data(column_name):\n   sql_data = [e[0] for e in sql_execute(column_name)]\n   return sql_data\n```\n## å®Œæ•´ç¨‹å¼ç¢¼\n```python\nimport MySQLdb\nimport matplotlib.pyplot as plt\nimport mpl_finance as mpf\n%matplotlib inline\n\nuser = 'root'\npw = \"YourPassworrd\"\n\nconn=MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw,charset='utf8')\ncursor=conn.cursor() \ncursor.execute('USE STOCK')\n\np = [int(e) for e in input(\"è«‹è¼¸å…¥èµ·å§‹æ—¥æœŸå’ŒçµæŸæ—¥æœŸ\").split(\" \")]\nperiod = \"`Date` BETWEEN '{}/{}/{} 00:00:00' AND '{}/{}/{} 23:59:59'\".format(p[0],p[1],p[2],p[3],p[4],p[5])\n\ndef get_data(column_name):\n   sql_data = [e[0] for e in sql_execute(column_name)]\n   return sql_data\n\ndef sql_execute(column_name):\n   SQL = \"SELECT {} FROM `twse` WHERE `Stock Code` = {} AND {} ORDER BY `Date`\"\n   cursor.execute(SQL.format(column_name, 1234, period))\n   result = cursor.fetchall()\n   return result\n\nop = get_data('`Opening Price`')\ncp = get_data('`Closing Price`')\nh = get_data('`Highest Price`')\nl = get_data('`Lowest Price`')\nD = [e[0] for e in sql_execute('`Date`')]\n\nfig = plt.figure(figsize=(20, 8))\n\nax = fig.add_subplot(1, 1, 1)\nax.set_xticks(range(0, len(D), int(round(len(D)/7,0))))\nax.set_xticklabels(D[::int(round(len(D)/7,0))])\nmpf.candlestick2_ochl(ax, op, cp, h,\nl, width=0.6, colorup='r', colordown='g', alpha=1); \n```\n<img src = \"https://i.imgur.com/pSXpsdo.png\" width = \"100%\"/>"},{"excerpt":"TWSEçš„è³‡æ–™å­˜å…¥MySQL SQLé€£ç·š 1 åŸºæœ¬è¨­å®š 2 ä¸ä½¿ç”¨ä¸­æ–‡ 3 å¯ä½¿ç”¨ä¸­æ–‡ / charset='utf8' / create_engine pymysql sqlalchemy å€‹è‚¡æœˆæˆäº¤è³‡è¨Š/en/ å®Œæ•´ç¨‹å¼ç¢¼ æ¯æ—¥æ”¶ç›¤è¡Œæƒ… å®Œæ•´ç¨‹å¼ç¢¼ å–å‡ºè³‡æ–™ å€‹è‚¡æœˆæˆäº¤è³‡è¨Š 1 å›å‚³å…¨éƒ¨ 2 å›å‚³ä¸€å€‹å€¼ 3 å›å‚³å¤šå€‹å€¼ 4 å¯¦éš›ä½¿ç”¨ 5 resultå‹æ…‹ tuple 6 å–å‡ºç‰¹å®šæ™‚é–“å…§è³‡æ–™ â€¦","fields":{"slug":"/TWSE-4/"},"frontmatter":{"date":"November 29, 2020","title":"ğŸ“ˆ TWSE-4-è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","tags":["TWSE"]},"rawMarkdownBody":"\n# TWSEçš„è³‡æ–™å­˜å…¥MySQL\n\n## SQLé€£ç·š\n### 1 åŸºæœ¬è¨­å®š\n```python\nimport MySQLdb\n\nuser = 'root'\npw = \"YourPassworrd\"\n```\n### 2 ä¸ä½¿ç”¨ä¸­æ–‡\n```python\nconn = MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw)\ncursor=conn.cursor() \n```\n### 3 å¯ä½¿ç”¨ä¸­æ–‡ / charset='utf8' /\n```python\nconn=MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw,charset='utf8')\ncursor=conn.cursor() \n```\n## create_engine\n### pymysql sqlalchemy\n```\npip install pymysql sqlalchemy\n```\n```python\nfrom sqlalchemy import create_engine\n\nengine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=\"STOCK\")) \n```\n## å€‹è‚¡æœˆæˆäº¤è³‡è¨Š/en/\n### å®Œæ•´ç¨‹å¼ç¢¼\n```python\nimport urllib.request, json\nimport json\nimport time\nimport datetime\nimport pandas as pd\nfrom sqlalchemy import create_engine\nimport MySQLdb\n\nuser = 'root'\npw = \"YourPassworrd\"\n\nengine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=\"STOCK\")) \n\nconn = MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw)\ncursor=conn.cursor()\n\ncreate_table = '''\n`Stock Code` varchar(20) NOT NULL,\n`Date` date NOT NULL,\n`Trade Volume` bigint(20) NOT NULL,\n`Trade Value` bigint(20) NOT NULL,\n`Opening Price` float NOT NULL,\n`Highest Price` float NOT NULL,\n`Lowest Price` float NOT NULL,\n`Closing Price` float NOT NULL,\n`Change` float NOT NULL,\n`Transaction` bigint(20) NOT NULL\n'''\n\ncursor.execute(\"CREATE DATABASE IF NOT EXISTS STOCK DEFAULT CHARSET=utf8 DEFAULT COLLATE=utf8_unicode_ci\" )\ncursor.execute('USE STOCK')\ncursor.execute('''CREATE TABLE IF NOT EXISTS TWSE ({})'''.format(create_table))\ncursor.execute('ALTER TABLE TWSE RENAME TO TWSE_tempt')\nconn.commit()\n\ndata ={}\ndate_now = datetime.datetime.now()\nstock_list = [2330,1234]\nm = int(input(\"è«‹è¼¸å…¥æ¬²æŠ“å–æœˆä»½æ•¸\"))-1\n\nfor j in range(0,len(stock_list)):\n   for i in range (m,-1,-1):\n       date = date_now - i*datetime.timedelta(days = 30.4375)\n       url = \"http://www.twse.com.tw/en/exchangeReport/STOCK_DAY?response=jsn&date={}&stockNo={}\".format(str(date).split(' ')[0].replace('-',''),stock_list[j])\n       with urllib.request.urlopen(url) as jsonfile:\n               data = json.loads(jsonfile.read().decode())\n               df = pd.DataFrame(data['data'][0:len(data['data'])])\n               df.columns = data['fields']\n               df[\"Stock Code\"] = stock_list[j]\n               df = df.set_index('Stock Code')\n               df = df.applymap(lambda x: str(x.replace(',','')))\n               df.to_sql('TWSE_tempt', con = engine, if_exists = 'append', index=True)\n               time.sleep(10)\n               print(\"[Stock Code: #{}][{}]    loading......\".format(str(stock_list[j]),data['title'].split(\" \")[0]))            \n\ncursor.execute('CREATE TABLE TWSE ({})'.format(create_table))\ncursor.execute('''INSERT INTO TWSE SELECT* FROM TWSE_tempt GROUP BY `Stock Code`, `Date` HAVING count(*)>0''')\ncursor.execute('DROP TABLE TWSE_tempt')\nconn.commit()\nconn.close()\nprint(\"All done ! ! !\") \n```\n## æ¯æ—¥æ”¶ç›¤è¡Œæƒ…\n### å®Œæ•´ç¨‹å¼ç¢¼\n```python\nimport urllib.request, json\nimport json\nimport time\nimport datetime\nimport pandas as pd\nfrom sqlalchemy import create_engine\nimport MySQLdb\n\nuser = 'root'\npw = \"YourPassworrd\"\n\nconn=MySQLdb.connect(host=\"127.0.0.1\",user=user, passwd=pw,charset='utf8')\ncursor=conn.cursor() \n\ncursor.execute(\"CREATE DATABASE IF NOT EXISTS TWSE DEFAULT CHARSET=utf8 DEFAULT COLLATE=utf8_unicode_ci\" )\nengine = create_engine(\"mysql+pymysql://{}:{}@localhost/{db}\".format(user,pw,db=\"TWSE\"))\n\ncreate_table = '''\n`è­‰åˆ¸ä»£è™Ÿ` varchar(20) NOT NULL,\n`è­‰åˆ¸åç¨±` varchar(20) NOT NULL,\n`æˆäº¤è‚¡æ•¸` bigint(20),\n`æˆäº¤ç­†æ•¸` bigint(20),\n`æˆäº¤é‡‘é¡` float,\n`é–‹ç›¤åƒ¹` float NOT NULL,\n`æœ€é«˜åƒ¹` float NOT NULL,\n`æœ€ä½åƒ¹` float NOT NULL,\n`æ”¶ç›¤åƒ¹` float NOT NULL,\n`æ¼²è·Œåƒ¹å·®` float,\n`æœ€å¾Œæ­ç¤ºè²·åƒ¹` float,\n`æœ€å¾Œæ­ç¤ºè²·é‡` float,\n`æœ€å¾Œæ­ç¤ºè³£åƒ¹` float,\n`æœ€å¾Œæ­ç¤ºè³£é‡` bigint(20),\n`æœ¬ç›Šæ¯”` float,\n`æ—¥æœŸ` date NOT NULL\n'''\n\ncursor.execute('USE TWSE')\ncursor.execute('''CREATE TABLE IF NOT EXISTS `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` ({})'''.format(create_table))\ncursor.execute('ALTER TABLE `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` RENAME TO `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…_tempt`')\n\ndate = datetime.datetime.now()\nn = int(input('æŠ“å–næ—¥è³‡æ–™'))\n\nfor i in range(n):\n   url = \"https://www.twse.com.tw/exchangeReport/MI_INDEX?response=jsn&date={}&type=ALL\".format(str(date).split(' ')[0].replace('-',''))\n   with urllib.request.urlopen(url) as jsonfile:\n       data = json.loads(jsonfile.read().decode())\n       if data['stat'] ==\"OK\":\n           df = pd.DataFrame(data['data9'][0:len(data['data9'])])\n           df.columns = data['fields9']\n           df = df.drop(columns = 'æ¼²è·Œ(+/-)')\n           df = df.set_index('è­‰åˆ¸ä»£è™Ÿ')\n           df = df.applymap(lambda x: str(x.replace(',','')))\n           df[\"æ—¥æœŸ\"] = str(date).split(' ')[0].replace('-','/')\n           df.to_sql('æ¯æ—¥æ”¶ç›¤è¡Œæƒ…_tempt', con = engine, if_exists = 'append', index=True)\n           print(url)\n           time.sleep(4)\n       else:\n           print(data['stat'])\n       date = date - datetime.timedelta(days = 1)\ncursor.execute('CREATE TABLE `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` ({})'.format(create_table))\ncursor.execute('''INSERT INTO `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` SELECT* FROM `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…_tempt` GROUP BY `è­‰åˆ¸ä»£è™Ÿ`, `æ—¥æœŸ` HAVING count(*)>0''')\ncursor.execute('DROP TABLE `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…_tempt`')\nconn.commit()\nconn.close()\nprint(\"All done ! ! !\") \n```\n## å–å‡ºè³‡æ–™\n### å€‹è‚¡æœˆæˆäº¤è³‡è¨Š\n#### 1 å›å‚³å…¨éƒ¨\n```python\ncursor.fetchall()\n```\n#### 2 å›å‚³ä¸€å€‹å€¼\n```python\ncursor.fetchone()\n```\n#### 3 å›å‚³å¤šå€‹å€¼\n```python\ncursor.fetchmany()\n```\n\n#### 4 å¯¦éš›ä½¿ç”¨\n```python\ncursor.execute(\"SELECT `Opening Price` FROM `twse` where `Stock Code` = 2330\")\nresult = cursor.fetchall()\nprint(result)\n```\n#### 5 resultå‹æ…‹\n```python\nprint(type(result))\n```\n##### tuple\n```python\nprint(result[1][0])\n```\n#### 6 å–å‡ºç‰¹å®šæ™‚é–“å…§è³‡æ–™\n> å›å‚³ **Opening Price** \n>\n> Date BETWEEN **2019/10/10 ~ 2020/1/10**\n```python\ncursor.execute(\"SELECT `Opening Price` FROM `twse` WHERE `Stock Code` = 2330 AND `Date` BETWEEN '2019/10/10 00:00:00' AND '2020/1/10 23:59:59'\")\nresult = cursor.fetchall()\nprint(result) \n```\n<img src = \"https://i.imgur.com/yFeVTEB.jpg\" width = \"100%\"/>"},{"excerpt":"TWSEçš„è³‡æ–™å­˜å…¥SQLite å€‹è‚¡æœˆæˆäº¤è³‡è¨Š 1 SQLiteé€£ç·š 2 å»ºç«‹Table 3 åˆªé™¤Table # å®Œæ•´ç¨‹å¼ç¢¼ è³‡æ–™åº«è³‡æ–™é‡è¤‡å•é¡Œè§£æ±º 1 é¸å‡ºæ²’æœ‰é‡è¤‡çš„è³‡æ–™ 2 TWSE_temptç•¶ä½œç·©å­˜ å°‡TWSEæ”¹æˆTWSE_temptç•¶ä½œç·©å­˜ ï¼Œå†æ–°å¢ä¸€å€‹TWSE # å®Œæ•´ç¨‹å¼ç¢¼","fields":{"slug":"/TWSE-3/"},"frontmatter":{"date":"November 28, 2020","title":"ğŸ“ˆ TWSE-3-TWSEçš„è³‡æ–™å­˜å…¥SQLite","tags":["TWSE"]},"rawMarkdownBody":"\n\n# TWSEçš„è³‡æ–™å­˜å…¥SQLite\n\n## å€‹è‚¡æœˆæˆäº¤è³‡è¨Š\n### 1 SQLiteé€£ç·š\n```python\nimport sqlite3\n\nconn = sqlite3.connect('Python_Stock_TWSE.db')\nc = conn.cursor() \n```\n### 2 å»ºç«‹Table\n```python\nc.execute('CREATE TABLE IF NOT EXISTS TWSE2330_tempt (è‚¡ç¥¨ä»£ç¢¼, æ—¥æœŸ, æˆäº¤è‚¡æ•¸, æˆäº¤é‡‘é¡, é–‹ç›¤åƒ¹, æœ€é«˜åƒ¹, æœ€ä½åƒ¹, æ”¶ç›¤åƒ¹, æ¼²è·Œåƒ¹å·®, æˆäº¤ç­†æ•¸)')\n```\n### 3 åˆªé™¤Table\n```python\nc.execute('DROP TABLE TWSE2330_tempt')\n```\n### # å®Œæ•´ç¨‹å¼ç¢¼\n```python\nimport pandas as pd\nimport urllib.request, json\nimport datetime\nimport time\nimport sqlite3\n\nconn = sqlite3.connect('Python_Stock_TWSE.db')\nc = conn.cursor()\n\nc.execute('CREATE TABLE IF NOT EXISTS TWSE (è‚¡ç¥¨ä»£ç¢¼ int, æ—¥æœŸ date, æˆäº¤è‚¡æ•¸ float, æˆäº¤é‡‘é¡ float, é–‹ç›¤åƒ¹ float, æœ€é«˜åƒ¹ float, æœ€ä½åƒ¹ float, æ”¶ç›¤åƒ¹ float, æ¼²è·Œåƒ¹å·® float, æˆäº¤ç­†æ•¸ float)')\nconn.commit()\n\ndate_now = datetime.datetime.now()\nstock_list = [2330,1234]\nm = int(input(\"è«‹è¼¸å…¥æ¬²æŠ“å–æœˆä»½æ•¸\"))-1\n\n\nfor j in range(0,len(stock_list)):\n   for i in range (m,-1,-1):\n       date = date_now - i*datetime.timedelta(days = 30.4375)\n       url = \"http://www.twse.com.tw/exchangeReport/STOCK_DAY?response=jsn&date={}&stockNo={}\".format(str(date).split(' ')[0].replace('-',''),stock_list[j])\n       with urllib.request.urlopen(url) as jsonfile:\n               data = json.loads(jsonfile.read().decode())\n               df = pd.DataFrame(data['data'][0:len(data['data'])])\n               df.columns = data['fields']\n               df[\"è‚¡ç¥¨ä»£ç¢¼\"] = stock_list[j]\n               df = df.set_index('è‚¡ç¥¨ä»£ç¢¼')\n               df.to_sql('TWSE', conn, if_exists='append', index = True)\n               conn.commit()\n               print(\"[#{}] {} is loading...\".format(stock_list[j], data['date']))\n               time.sleep(5)\nconn.close()\nprint(\"Done\") \n```\n<img src = \"https://i.imgur.com/IxMi5Nj.jpg\" width = \"100%\" />\n\n## è³‡æ–™åº«è³‡æ–™é‡è¤‡å•é¡Œè§£æ±º\n### 1 é¸å‡ºæ²’æœ‰é‡è¤‡çš„è³‡æ–™\n```sql\nSELECT*\nFROM TWSE\nGROUP BY è‚¡ç¥¨ä»£ç¢¼, æ—¥æœŸ\nHAVING count(*)>0 \n```\n<img src = \"https://i.imgur.com/yu9YdMQ.jpg\" width = \"100%\" />\n\n### 2 TWSE_temptç•¶ä½œç·©å­˜\n> å°‡TWSEæ”¹æˆTWSE_temptç•¶ä½œç·©å­˜ ï¼Œå†æ–°å¢ä¸€å€‹TWSE\n```sql\nINSERT INTO TWSE\nSELECT*\nFROM TWSE_tempt\nGROUP BY è‚¡ç¥¨ä»£ç¢¼, æ—¥æœŸ\nHAVING count(*)>0 \n```\n```python\nc.execute('''INSERT INTO TWSE SELECT* FROM TWSE_tempt GROUP BY è‚¡ç¥¨ä»£ç¢¼, æ—¥æœŸ HAVING count(*)>0''') \n```\n### # å®Œæ•´ç¨‹å¼ç¢¼\n```python\nimport pandas as pd\nimport urllib.request, json\nimport datetime\nimport time\nimport sqlite3\n\nconn = sqlite3.connect('Python_Stock_TWSE.db')\nc = conn.cursor()\n\nc.execute('CREATE TABLE IF NOT EXISTS TWSE (è‚¡ç¥¨ä»£ç¢¼ int, æ—¥æœŸ date, æˆäº¤è‚¡æ•¸ float, æˆäº¤é‡‘é¡ float, é–‹ç›¤åƒ¹ float, æœ€é«˜åƒ¹ float, æœ€ä½åƒ¹ float, æ”¶ç›¤åƒ¹ float, æ¼²è·Œåƒ¹å·® float, æˆäº¤ç­†æ•¸ float)')\nc.execute('ALTER TABLE TWSE RENAME TO TWSE_tempt')\nconn.commit()\n\ndate_now = datetime.datetime.now()\nstock_list = [2330,1234]\nm = int(input(\"è«‹è¼¸å…¥æ¬²æŠ“å–æœˆä»½æ•¸\"))-1\n\n\nfor j in range(0,len(stock_list)):\n   for i in range (m,-1,-1):\n       date = date_now - i*datetime.timedelta(days = 30.4375)\n       url = \"http://www.twse.com.tw/exchangeReport/STOCK_DAY?response=jsn&date={}&stockNo={}\".format(str(date).split(' ')[0].replace('-',''),stock_list[j])\n       with urllib.request.urlopen(url) as jsonfile:\n               data = json.loads(jsonfile.read().decode())\n               df = pd.DataFrame(data['data'][0:len(data['data'])])\n               df.columns = data['fields']\n               df[\"è‚¡ç¥¨ä»£ç¢¼\"] = stock_list[j]\n               df = df.set_index('è‚¡ç¥¨ä»£ç¢¼')\n               df.to_sql('TWSE_tempt', conn, if_exists='append', index = True)\n               print(\"[{}] Month: {} is loading......\".format(str(stock_list[j]),str(date).split('-')[1]))\n               time.sleep(5)\n\nc.execute('CREATE TABLE TWSE (è‚¡ç¥¨ä»£ç¢¼ int, æ—¥æœŸ date, æˆäº¤è‚¡æ•¸ float, æˆäº¤é‡‘é¡ float, é–‹ç›¤åƒ¹ float, æœ€é«˜åƒ¹ float, æœ€ä½åƒ¹ float, æ”¶ç›¤åƒ¹ float, æ¼²è·Œåƒ¹å·® float, æˆäº¤ç­†æ•¸ float)')\nc.execute('''INSERT INTO TWSE SELECT* FROM TWSE_tempt GROUP BY è‚¡ç¥¨ä»£ç¢¼, æ—¥æœŸ HAVING count(*)>0''')\nc.execute('DROP TABLE TWSE_tempt')\nprint(\"Done\")\nconn.commit()\nconn.close() \n```"},{"excerpt":"DataFrameå­˜å…¥CSVæª” å€‹è‚¡æœˆæˆäº¤è³‡è¨Š 1 ç›¸å°è·¯å¾‘ 2 çµ•å°è·¯å¾‘ 3 å–å¾—è·¯å¾‘ 4 df.to_csv ä½¿ç”¨ 1 ä»¥\"/\"éš”é–‹ 2 å°‡æª”æ¡ˆé‡è¤‡å¯«å…¥ 3 æ›¿æ›ç©ºå€¼ 4 å°æ•¸4ä½ 5 ä¸ä¿ç•™åˆ—åheader 6 ä¸ä¿ç•™å¼•ç´¢å€¼index # å®Œæ•´ç¨‹å¼ç¢¼ æŠ“å–å¤šç­†è³‡æ–™ å€‹è‚¡æœˆæˆäº¤è³‡è¨Š æ¯æ—¥æ”¶ç›¤è¡Œæƒ…","fields":{"slug":"/TWSE-2/"},"frontmatter":{"date":"November 28, 2020","title":"ğŸ“ˆ TWSE-2-å°‡DataFrameå­˜å…¥CSVæª” & æŠ“å–å¤šç­†è³‡æ–™","tags":["TWSE"]},"rawMarkdownBody":"\n# DataFrameå­˜å…¥CSVæª”\n\n##  å€‹è‚¡æœˆæˆäº¤è³‡è¨Š\n### 1 ç›¸å°è·¯å¾‘\n```python\ndf.to_csv('æª”æ¡ˆåç¨±.csv')\n```\n### 2 çµ•å°è·¯å¾‘\n```python\ndf.to_csv (r'è·¯å¾‘\\æª”æ¡ˆåç¨±.csv') \n```\n### 3 å–å¾—è·¯å¾‘\n```python\nimport os\n\nos.getcwd()\n```\n### 4 df.to_csv ä½¿ç”¨\n#### 1 ä»¥\"/\"éš”é–‹\n```python\ndf.to_csv ('æª”æ¡ˆåç¨±.csv', sep='/')\n```\n#### 2 å°‡æª”æ¡ˆé‡è¤‡å¯«å…¥\n\n```python\ndf.to_csv ('æª”æ¡ˆåç¨±.csv', mode = 'a')\n```\n\n#### 3 æ›¿æ›ç©ºå€¼\n```python\ndf.to_csv ('æª”æ¡ˆåç¨±.csv', na_rep='NA')\n```\n\n#### 4 å°æ•¸4ä½\n```python\ndf.to_csv ('æª”æ¡ˆåç¨±.csv', float_format='%.4f')\n```\n\n#### 5 ä¸ä¿ç•™åˆ—åheader\n```python\ndf.to_csv ('æª”æ¡ˆåç¨±.csv', header=0)\n```\n\n#### 6 ä¸ä¿ç•™å¼•ç´¢å€¼index\n```python\ndf.to_csv ('æª”æ¡ˆåç¨±.csv', index=0) \n```\n#### # å®Œæ•´ç¨‹å¼ç¢¼\n```python\n\nimport pandas as pd\nimport urllib.request, json\nimport time\n\nstock_list = [1101,1234,2330,2337]\ndate = 20200813\n\nfor j in range(0,len(stock_list)):\n   url = \"http://www.twse.com.tw/en/exchangeReport/STOCK_DAY?response=jsn&date={}&stockNo={}\".format(date,stock_list[j])\n   with urllib.request.urlopen(url) as jsonfile:\n       data = json.loads(jsonfile.read().decode())\n       stock_data.append(data)\n       df = pd.DataFrame(data['data'][0:len(data['data'])])\n       df.columns = data['fields']\n       df[\"Stock Code\"] = stock_list[j]\n       df = df.set_index('Stock Code')\n       df = df.applymap(lambda x: str(x.replace(',','')))\n       print(\"[#{}] {} is loading...\".format(stock_list[j], data['date']))\n       df.to_csv (r'C:\\Users\\User\\Downloads\\Python\\Python_Stock_TWSE_type = 2330.csv', mode='a', header=0)\n       time.sleep(5) \n```\n---\n## æŠ“å–å¤šç­†è³‡æ–™\n### å€‹è‚¡æœˆæˆäº¤è³‡è¨Š\n```python\nimport urllib.request, json\nimport datetime\nimport pandas as pd\n\ndate_now = datetime.datetime.now()\nstock_list = [2330,1234]\nm = int(input(\"è«‹è¼¸å…¥æ¬²æŠ“å–æœˆä»½æ•¸\"))-1\n\n\nfor j in range(0,len(stock_list)):\n   for i in range (m,-1,-1):\n       date = date_now - i*datetime.timedelta(days = 30.4375)\n       url = \"http://www.twse.com.tw/exchangeReport/STOCK_DAY?response=jsn&date={}&stockNo={}\".format(str(date).split(' ')[0].replace('-',''),stock_list[j])\n       with urllib.request.urlopen(url) as jsonfile:\n               data = json.loads(jsonfile.read().decode())\n               df = pd.DataFrame(data['data'][0:len(data['data'])])\n               df.columns = data['fields']\n               df[\"è‚¡ç¥¨ä»£ç¢¼\"] = stock_list[j]\n               df = df.set_index('è‚¡ç¥¨ä»£ç¢¼')\n               print(df)\n```\n### æ¯æ—¥æ”¶ç›¤è¡Œæƒ…\n```python\nimport urllib.request, json\nimport datetime\nimport time\nimport pandas as pd\n\ndate = datetime.datetime.now()\nn = int(input('æŠ“å–næ—¥è³‡æ–™'))\n\nfor i in range(n):\n   url = \"https://www.twse.com.tw/exchangeReport/MI_INDEX?response=jsn&date={}&type=ALL\".format(str(date).split(' ')[0].replace('-',''))\n   with urllib.request.urlopen(url) as jsonfile:\n       data = json.loads(jsonfile.read().decode())\n       if data['stat'] ==\"OK\":\n           df = pd.DataFrame(data['data9'][0:len(data['data9'])])\n           df.columns = data['fields9']\n           print(url)\n           time.sleep(4)\n       else:\n           print(data['stat'])\n       date = date - datetime.timedelta(days = 1) \n```"},{"excerpt":"TWSEè‚¡ç¥¨è³‡æ–™ 1 å€‹è‚¡æœˆæˆäº¤è³‡è¨Š å€‹è‚¡æœˆæˆäº¤è³‡è¨Šä»¥å°ç©é›»2330ç‚ºä¾‹ é»é¸ åˆ—å°/HTML æ›´æ”¹ html ç‚º jsn æ›´æ”¹ 20200813ç‚º 20200713ï¼Œå³å¯æ‰¾åˆ°7æœˆè³‡æ–™ æ›´æ”¹ stockNo=2330 ç‚º stockNo=1234ï¼Œå³å¯æ‰¾åˆ°é»‘æ¾äº¤æ˜“è³‡ https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=jsn&datâ€¦","fields":{"slug":"/TWSE-1/"},"frontmatter":{"date":"November 27, 2020","title":"ğŸ“ˆ TWSE-1-jsonæª”è§£æ","tags":["TWSE"]},"rawMarkdownBody":"\n## TWSEè‚¡ç¥¨è³‡æ–™\n\n### 1 å€‹è‚¡æœˆæˆäº¤è³‡è¨Š\n1. [å€‹è‚¡æœˆæˆäº¤è³‡è¨Š](https://www.twse.com.tw/zh/page/trading/exchange/STOCK_DAY.html)ä»¥å°ç©é›»2330ç‚ºä¾‹\n2. é»é¸ [åˆ—å°/HTML](https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=html&date=20200813&stockNo=2330)\n3. æ›´æ”¹ **html** ç‚º **jsn**\n\n4. æ›´æ”¹ [**20200813**](https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=jsn&date=20200813&stockNo=2330)ç‚º [**20200713**](https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=jsn&date=20200713&stockNo=2330)ï¼Œå³å¯æ‰¾åˆ°7æœˆè³‡æ–™\n5. æ›´æ”¹ **stockNo=2330** ç‚º **stockNo=1234**ï¼Œå³å¯æ‰¾åˆ°é»‘æ¾äº¤æ˜“è³‡\n    > https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=jsn&date=20200713&stockNo=2330\n    \n    > https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=jsn&date=20200713&stockNo=1234\n\n6. åœ¨**exchangeReport**å‰åŠ ä¸Š **/en/** è½‰æ›æˆè‹±æ–‡ç‰ˆ\n\t> https://www.twse.com.tw/en/exchangeReport/STOCK_DAY?response=jsn&date=20200713&stockNo=1234\n\t\n\t```python\n\tstock_list = [1234, 2330]\n\tdate = 20200813\n\tfor j in range(0,len(stock_list)):\n\t   url = \"http://www.twse.com.tw/en/exchangeReport/STOCK_DAY?response=jsn&date={}&stockNo={}\".format(date,stock_list[j])\n\t   print(url) \n\t```\n\n---\n\n### 2 æ¯æ—¥æ”¶ç›¤è¡Œæƒ…\n1. [æ¯æ—¥æ”¶ç›¤è¡Œæƒ…-å…¨éƒ¨](https://www.twse.com.tw/zh/page/trading/exchange/MI_INDEX.html)\n2. é»é¸ åˆ—å°/HTML\n3. æ›´æ”¹ **html** ç‚º **jsn**\n4. æ›´æ”¹ [**20200827**](https://www.twse.com.tw/exchangeReport/MI_INDEX?response=jsn&date=20200728&type=ALL) ç‚º [**20200828**](https://www.twse.com.tw/exchangeReport/MI_INDEX?response=jsn&date=20200828&type=ALL)ï¼Œå³å¯æ‰¾åˆ°8æœˆ28æ—¥è³‡æ–™\n5. åœ¨**exchangeReport**å‰åŠ ä¸Š **/en/** è½‰æ›æˆè‹±æ–‡ç‰ˆ\n\t\n\t> https://www.twse.com.tw/en/exchangeReport/MI_INDEX?response=jsn&date=20200828&type=ALL\n\n---\n\n##  è§£æJsonæª”\n### 1 å€‹è‚¡æœˆæˆäº¤è³‡è¨Š/en/\n#### 1 è§£æ\n```python\nimport urllib.request, json \n\nstock_list = [2330]\ndate = 20200813\n\nfor j in range(0,len(stock_list)):\n   url = \"http://www.twse.com.tw/en/exchangeReport/STOCK_DAY?response=jsn&date={}&stockNo={}\".format(date,stock_list[j])\n\n   with urllib.request.urlopen(url) as jsonfile:\n\n       data = json.loads(jsonfile.read().decode())\n       print(data) \n```\n#### 2 [Json Editor](https://jsonformatter.org/json-editor)\n![Json Editor](https://i.imgur.com/1ohrpxY.jpg)\n\n```python\nfor i in range(0, len(data['data'])):\n   print(data['data'][i]) \n```\n\n```python\nprint(data['fields'])\nprint(data['date'])\nprint(data['title']) \n```\n\n#### 3 ä»¥DataFrameå‘ˆç¾è³‡æ–™\n\n```python\nimport pandas as pd\n\n# DataFrameå‘ˆç¾\ndf = pd.DataFrame(data['data'][0:len(data['data'])]) \n \n# è¨­å®šæ¬„ä½\ndf.columns = data['fields']\n \n# å¢åŠ Stock Codeè‡³df\ndf[\"Stock Code\"] = stock_list[j]\n \n# å°‡Stock Code è¨­ç‚º index\ndf = df.set_index('Stock Code')\n \n# å°‡é€—è™Ÿæ‹¿æ‰\ndf = df.applymap(lambda x: str(x.replace(',','')))\n```\n\n##### # å®Œæ•´ç¨‹å¼ç¢¼\n```python\nimport pandas as pd\nimport urllib.request, json\n\nstock_list = [2330]\ndate = 20200813\nfor j in range(0,len(stock_list)):\n   url = \"http://www.twse.com.tw/en/exchangeReport/STOCK_DAY?response=jsn&date={}&stockNo={}\".format(date,stock_list[j])\n   with urllib.request.urlopen(url) as jsonfile:\n       data = json.loads(jsonfile.read().decode())\n       df = pd.DataFrame(data['data'][0:len(data['data'])])\n       df.columns = data['fields']\n       df[\"Stock Code\"] = stock_list[j]\n       df = df.set_index('Stock Code')\n       df = df.applymap(lambda x: str(x.replace(',','')))\ndf \n```\n\n---\n\n### 2 æ¯æ—¥æ”¶ç›¤è¡Œæƒ…\n####  è§£æJsonæª”\n##### 1 è§£æ\n```python\nimport urllib.request, json\nimport datetime\n\ndate = datetime.datetime.now()\nurl = \"https://www.twse.com.tw/exchangeReport/MI_INDEX?response=jsn&date={}&type=ALL\".format(str(date).split(' ')[0].replace('-',''))\nwith urllib.request.urlopen(url) as jsonfile:\n    data = json.loads(jsonfile.read().decode())\nprint(data)\n```\n\n```python\nprint(data['fields9'])\nprint(data['data9']) \n```\n##### 2 ä»¥DataFrameå‘ˆç¾\n```python\nimport pandas as pd\n\ndf = pd.DataFrame(data['data9'][0:len(data['data9'])])\ndf.columns = data['fields9'] \n```\n##### 3 å°‡æ¼²è·Œ(+/-)åˆªé™¤\n```python\ndf = df.drop(columns = 'æ¼²è·Œ(+/-)')\n```\n##### 4 å°‡è­‰åˆ¸ä»£è™Ÿè¨­ç‚ºindex \n```python\ndf = df.set_index('è­‰åˆ¸ä»£è™Ÿ')\n```\n##### 5 å°‡é€—è™Ÿæ‹¿æ‰\n```python\ndf = df.applymap(lambda x: str(x.replace(',','')))\n```\n##### 6 åŠ å…¥æ—¥æœŸ\n```python\ndf[\"æ—¥æœŸ\"] = str(date).split(' ')[0].replace('-','/') \n```\n##### # å®Œæ•´ç¨‹å¼ç¢¼ \n```python\nimport urllib.request, json\nimport pandas as pd\nimport datetime\n\ndate = datetime.datetime.now()\nurl = \"https://www.twse.com.tw/exchangeReport/MI_INDEX?response=jsn&date={}&type=ALL\".format(str(date).split(' ')[0].replace('-',''))\nwith urllib.request.urlopen(url) as jsonfile:\n    data = json.loads(jsonfile.read().decode())\n    df = pd.DataFrame(data['data9'][0:len(data['data9'])])\n    df.columns = data['fields9']\n    df = df.drop(columns = 'æ¼²è·Œ(+/-)')\n    df = df.set_index('è­‰åˆ¸ä»£è™Ÿ')\n    df = df.applymap(lambda x: str(x.replace(',','')))\n    df[\"æ—¥æœŸ\"] = str(date).split(' ')[0].replace('-','/')\ndf\n```"}]}},"pageContext":{}},
    "staticQueryHashes": []}