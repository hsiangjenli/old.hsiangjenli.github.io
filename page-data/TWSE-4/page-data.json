{
    "componentChunkName": "component---src-templates-post-jsx",
    "path": "/TWSE-4/",
    "result": {"data":{"site":{"siteMetadata":{"title":"RN"}},"markdownRemark":{"id":"86351f17-7bd3-5d53-b5c0-b8a09c915143","excerpt":"TWSEçš„è³‡æ–™å­˜å…¥MySQL SQLé€£ç·š 1 åŸºæœ¬è¨­å®š 2 ä¸ä½¿ç”¨ä¸­æ–‡ 3 å¯ä½¿ç”¨ä¸­æ–‡ / charset='utf8' / create_engine pymysql sqlalchemy å€‹è‚¡æœˆæˆäº¤è³‡è¨Š/en/ å®Œæ•´ç¨‹å¼ç¢¼ æ¯æ—¥æ”¶ç›¤è¡Œæƒ… å®Œæ•´ç¨‹å¼ç¢¼ å–å‡ºè³‡æ–™ å€‹è‚¡æœˆæˆäº¤è³‡è¨Š 1 å›å‚³å…¨éƒ¨ 2 å›å‚³ä¸€å€‹å€¼ 3 å›å‚³å¤šå€‹å€¼ 4 å¯¦éš›ä½¿ç”¨ 5 resultå‹æ…‹ tuple 6 å–å‡ºç‰¹å®šæ™‚é–“å…§è³‡æ–™ å›å‚³ Opening Price Date BETWEEN 2019/10/10 ~ 2020/1/10","html":"<h1>TWSEçš„è³‡æ–™å­˜å…¥MySQL</h1>\n<h2>SQLé€£ç·š</h2>\n<h3>1 åŸºæœ¬è¨­å®š</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> MySQLdb\n\nuser <span class=\"token operator\">=</span> <span class=\"token string\">'root'</span>\npw <span class=\"token operator\">=</span> <span class=\"token string\">\"YourPassworrd\"</span></code></pre></div>\n<h3>2 ä¸ä½¿ç”¨ä¸­æ–‡</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">conn <span class=\"token operator\">=</span> MySQLdb<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>host<span class=\"token operator\">=</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span>user<span class=\"token operator\">=</span>user<span class=\"token punctuation\">,</span> passwd<span class=\"token operator\">=</span>pw<span class=\"token punctuation\">)</span>\ncursor<span class=\"token operator\">=</span>conn<span class=\"token punctuation\">.</span>cursor<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> </code></pre></div>\n<h3>3 å¯ä½¿ç”¨ä¸­æ–‡ / charset='utf8' /</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">conn<span class=\"token operator\">=</span>MySQLdb<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>host<span class=\"token operator\">=</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span>user<span class=\"token operator\">=</span>user<span class=\"token punctuation\">,</span> passwd<span class=\"token operator\">=</span>pw<span class=\"token punctuation\">,</span>charset<span class=\"token operator\">=</span><span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span>\ncursor<span class=\"token operator\">=</span>conn<span class=\"token punctuation\">.</span>cursor<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> </code></pre></div>\n<h2>create_engine</h2>\n<h3>pymysql sqlalchemy</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pip install pymysql sqlalchemy</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span><span class=\"token string\">\"mysql+pymysql://{}:{}@localhost/{db}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span>pw<span class=\"token punctuation\">,</span>db<span class=\"token operator\">=</span><span class=\"token string\">\"STOCK\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> </code></pre></div>\n<h2>å€‹è‚¡æœˆæˆäº¤è³‡è¨Š/en/</h2>\n<h3>å®Œæ•´ç¨‹å¼ç¢¼</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> urllib<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">,</span> json\n<span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">import</span> datetime\n<span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">import</span> MySQLdb\n\nuser <span class=\"token operator\">=</span> <span class=\"token string\">'root'</span>\npw <span class=\"token operator\">=</span> <span class=\"token string\">\"YourPassworrd\"</span>\n\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span><span class=\"token string\">\"mysql+pymysql://{}:{}@localhost/{db}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span>pw<span class=\"token punctuation\">,</span>db<span class=\"token operator\">=</span><span class=\"token string\">\"STOCK\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n\nconn <span class=\"token operator\">=</span> MySQLdb<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>host<span class=\"token operator\">=</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span>user<span class=\"token operator\">=</span>user<span class=\"token punctuation\">,</span> passwd<span class=\"token operator\">=</span>pw<span class=\"token punctuation\">)</span>\ncursor<span class=\"token operator\">=</span>conn<span class=\"token punctuation\">.</span>cursor<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ncreate_table <span class=\"token operator\">=</span> <span class=\"token triple-quoted-string string\">'''\n`Stock Code` varchar(20) NOT NULL,\n`Date` date NOT NULL,\n`Trade Volume` bigint(20) NOT NULL,\n`Trade Value` bigint(20) NOT NULL,\n`Opening Price` float NOT NULL,\n`Highest Price` float NOT NULL,\n`Lowest Price` float NOT NULL,\n`Closing Price` float NOT NULL,\n`Change` float NOT NULL,\n`Transaction` bigint(20) NOT NULL\n'''</span>\n\ncursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">\"CREATE DATABASE IF NOT EXISTS STOCK DEFAULT CHARSET=utf8 DEFAULT COLLATE=utf8_unicode_ci\"</span> <span class=\"token punctuation\">)</span>\ncursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'USE STOCK'</span><span class=\"token punctuation\">)</span>\ncursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token triple-quoted-string string\">'''CREATE TABLE IF NOT EXISTS TWSE ({})'''</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>create_table<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ncursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'ALTER TABLE TWSE RENAME TO TWSE_tempt'</span><span class=\"token punctuation\">)</span>\nconn<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ndata <span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\ndate_now <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>datetime<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nstock_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2330</span><span class=\"token punctuation\">,</span><span class=\"token number\">1234</span><span class=\"token punctuation\">]</span>\nm <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">input</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"è«‹è¼¸å…¥æ¬²æŠ“å–æœˆä»½æ•¸\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">1</span>\n\n<span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>stock_list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span> <span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n       date <span class=\"token operator\">=</span> date_now <span class=\"token operator\">-</span> i<span class=\"token operator\">*</span>datetime<span class=\"token punctuation\">.</span>timedelta<span class=\"token punctuation\">(</span>days <span class=\"token operator\">=</span> <span class=\"token number\">30.4375</span><span class=\"token punctuation\">)</span>\n       url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://www.twse.com.tw/en/exchangeReport/STOCK_DAY?response=jsn&amp;date={}&amp;stockNo={}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">'-'</span><span class=\"token punctuation\">,</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>stock_list<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n       <span class=\"token keyword\">with</span> urllib<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>urlopen<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> jsonfile<span class=\"token punctuation\">:</span>\n               data <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>jsonfile<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n               df <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n               df<span class=\"token punctuation\">.</span>columns <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'fields'</span><span class=\"token punctuation\">]</span>\n               df<span class=\"token punctuation\">[</span><span class=\"token string\">\"Stock Code\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> stock_list<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span>\n               df <span class=\"token operator\">=</span> df<span class=\"token punctuation\">.</span>set_index<span class=\"token punctuation\">(</span><span class=\"token string\">'Stock Code'</span><span class=\"token punctuation\">)</span>\n               df <span class=\"token operator\">=</span> df<span class=\"token punctuation\">.</span>applymap<span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">,</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n               df<span class=\"token punctuation\">.</span>to_sql<span class=\"token punctuation\">(</span><span class=\"token string\">'TWSE_tempt'</span><span class=\"token punctuation\">,</span> con <span class=\"token operator\">=</span> engine<span class=\"token punctuation\">,</span> if_exists <span class=\"token operator\">=</span> <span class=\"token string\">'append'</span><span class=\"token punctuation\">,</span> index<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n               time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n               <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[Stock Code: #{}][{}]    loading......\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>stock_list<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>            \n\ncursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'CREATE TABLE TWSE ({})'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>create_table<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ncursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token triple-quoted-string string\">'''INSERT INTO TWSE SELECT* FROM TWSE_tempt GROUP BY `Stock Code`, `Date` HAVING count(*)>0'''</span><span class=\"token punctuation\">)</span>\ncursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'DROP TABLE TWSE_tempt'</span><span class=\"token punctuation\">)</span>\nconn<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nconn<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"All done ! ! !\"</span><span class=\"token punctuation\">)</span> </code></pre></div>\n<h2>æ¯æ—¥æ”¶ç›¤è¡Œæƒ…</h2>\n<h3>å®Œæ•´ç¨‹å¼ç¢¼</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> urllib<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">,</span> json\n<span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">import</span> datetime\n<span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">import</span> MySQLdb\n\nuser <span class=\"token operator\">=</span> <span class=\"token string\">'root'</span>\npw <span class=\"token operator\">=</span> <span class=\"token string\">\"YourPassworrd\"</span>\n\nconn<span class=\"token operator\">=</span>MySQLdb<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>host<span class=\"token operator\">=</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span>user<span class=\"token operator\">=</span>user<span class=\"token punctuation\">,</span> passwd<span class=\"token operator\">=</span>pw<span class=\"token punctuation\">,</span>charset<span class=\"token operator\">=</span><span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span>\ncursor<span class=\"token operator\">=</span>conn<span class=\"token punctuation\">.</span>cursor<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> \n\ncursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">\"CREATE DATABASE IF NOT EXISTS TWSE DEFAULT CHARSET=utf8 DEFAULT COLLATE=utf8_unicode_ci\"</span> <span class=\"token punctuation\">)</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span><span class=\"token string\">\"mysql+pymysql://{}:{}@localhost/{db}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span>pw<span class=\"token punctuation\">,</span>db<span class=\"token operator\">=</span><span class=\"token string\">\"TWSE\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\ncreate_table <span class=\"token operator\">=</span> <span class=\"token triple-quoted-string string\">'''\n`è­‰åˆ¸ä»£è™Ÿ` varchar(20) NOT NULL,\n`è­‰åˆ¸åç¨±` varchar(20) NOT NULL,\n`æˆäº¤è‚¡æ•¸` bigint(20),\n`æˆäº¤ç­†æ•¸` bigint(20),\n`æˆäº¤é‡‘é¡` float,\n`é–‹ç›¤åƒ¹` float NOT NULL,\n`æœ€é«˜åƒ¹` float NOT NULL,\n`æœ€ä½åƒ¹` float NOT NULL,\n`æ”¶ç›¤åƒ¹` float NOT NULL,\n`æ¼²è·Œåƒ¹å·®` float,\n`æœ€å¾Œæ­ç¤ºè²·åƒ¹` float,\n`æœ€å¾Œæ­ç¤ºè²·é‡` float,\n`æœ€å¾Œæ­ç¤ºè³£åƒ¹` float,\n`æœ€å¾Œæ­ç¤ºè³£é‡` bigint(20),\n`æœ¬ç›Šæ¯”` float,\n`æ—¥æœŸ` date NOT NULL\n'''</span>\n\ncursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'USE TWSE'</span><span class=\"token punctuation\">)</span>\ncursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token triple-quoted-string string\">'''CREATE TABLE IF NOT EXISTS `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` ({})'''</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>create_table<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ncursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'ALTER TABLE `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` RENAME TO `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…_tempt`'</span><span class=\"token punctuation\">)</span>\n\ndate <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>datetime<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nn <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">input</span><span class=\"token punctuation\">(</span><span class=\"token string\">'æŠ“å–næ—¥è³‡æ–™'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   url <span class=\"token operator\">=</span> <span class=\"token string\">\"https://www.twse.com.tw/exchangeReport/MI_INDEX?response=jsn&amp;date={}&amp;type=ALL\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">'-'</span><span class=\"token punctuation\">,</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   <span class=\"token keyword\">with</span> urllib<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>urlopen<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> jsonfile<span class=\"token punctuation\">:</span>\n       data <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>jsonfile<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n       <span class=\"token keyword\">if</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'stat'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span><span class=\"token string\">\"OK\"</span><span class=\"token punctuation\">:</span>\n           df <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'data9'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'data9'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n           df<span class=\"token punctuation\">.</span>columns <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'fields9'</span><span class=\"token punctuation\">]</span>\n           df <span class=\"token operator\">=</span> df<span class=\"token punctuation\">.</span>drop<span class=\"token punctuation\">(</span>columns <span class=\"token operator\">=</span> <span class=\"token string\">'æ¼²è·Œ(+/-)'</span><span class=\"token punctuation\">)</span>\n           df <span class=\"token operator\">=</span> df<span class=\"token punctuation\">.</span>set_index<span class=\"token punctuation\">(</span><span class=\"token string\">'è­‰åˆ¸ä»£è™Ÿ'</span><span class=\"token punctuation\">)</span>\n           df <span class=\"token operator\">=</span> df<span class=\"token punctuation\">.</span>applymap<span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">,</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n           df<span class=\"token punctuation\">[</span><span class=\"token string\">\"æ—¥æœŸ\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">'-'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n           df<span class=\"token punctuation\">.</span>to_sql<span class=\"token punctuation\">(</span><span class=\"token string\">'æ¯æ—¥æ”¶ç›¤è¡Œæƒ…_tempt'</span><span class=\"token punctuation\">,</span> con <span class=\"token operator\">=</span> engine<span class=\"token punctuation\">,</span> if_exists <span class=\"token operator\">=</span> <span class=\"token string\">'append'</span><span class=\"token punctuation\">,</span> index<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n           <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n           time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n       <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n           <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'stat'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n       date <span class=\"token operator\">=</span> date <span class=\"token operator\">-</span> datetime<span class=\"token punctuation\">.</span>timedelta<span class=\"token punctuation\">(</span>days <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\ncursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'CREATE TABLE `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` ({})'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>create_table<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ncursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token triple-quoted-string string\">'''INSERT INTO `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…` SELECT* FROM `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…_tempt` GROUP BY `è­‰åˆ¸ä»£è™Ÿ`, `æ—¥æœŸ` HAVING count(*)>0'''</span><span class=\"token punctuation\">)</span>\ncursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'DROP TABLE `æ¯æ—¥æ”¶ç›¤è¡Œæƒ…_tempt`'</span><span class=\"token punctuation\">)</span>\nconn<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nconn<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"All done ! ! !\"</span><span class=\"token punctuation\">)</span> </code></pre></div>\n<h2>å–å‡ºè³‡æ–™</h2>\n<h3>å€‹è‚¡æœˆæˆäº¤è³‡è¨Š</h3>\n<h4>1 å›å‚³å…¨éƒ¨</h4>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">cursor<span class=\"token punctuation\">.</span>fetchall<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4>2 å›å‚³ä¸€å€‹å€¼</h4>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">cursor<span class=\"token punctuation\">.</span>fetchone<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4>3 å›å‚³å¤šå€‹å€¼</h4>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">cursor<span class=\"token punctuation\">.</span>fetchmany<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4>4 å¯¦éš›ä½¿ç”¨</h4>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">cursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">\"SELECT `Opening Price` FROM `twse` where `Stock Code` = 2330\"</span><span class=\"token punctuation\">)</span>\nresult <span class=\"token operator\">=</span> cursor<span class=\"token punctuation\">.</span>fetchall<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span></code></pre></div>\n<h4>5 resultå‹æ…‹</h4>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">type</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h5>tuple</h5>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4>6 å–å‡ºç‰¹å®šæ™‚é–“å…§è³‡æ–™</h4>\n<blockquote>\n<p>å›å‚³ <strong>Opening Price</strong></p>\n<p>Date BETWEEN <strong>2019/10/10 ~ 2020/1/10</strong></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">cursor<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">\"SELECT `Opening Price` FROM `twse` WHERE `Stock Code` = 2330 AND `Date` BETWEEN '2019/10/10 00:00:00' AND '2020/1/10 23:59:59'\"</span><span class=\"token punctuation\">)</span>\nresult <span class=\"token operator\">=</span> cursor<span class=\"token punctuation\">.</span>fetchall<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span> </code></pre></div>\n<img src='https://i.imgur.com/yFeVTEB.jpg' width='100%'>","frontmatter":{"title":"ğŸ“ˆ TWSE-4-è³‡æ–™å­˜å…¥MySQLåŠå–å‡º","date":"November 29, 2020","update":null,"tags":["TWSE"],"series":null},"fields":{"slug":"/TWSE-4/","readingTime":{"minutes":3.935}}},"seriesList":{"edges":[{"node":{"id":"84f12206-b35b-569c-9a52-90932eba4126","fields":{"slug":"/TWSE-1/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-1-jsonæª”è§£æ"}}},{"node":{"id":"98ac704b-948d-5e27-b018-5e74d19a2321","fields":{"slug":"/TWSE-2/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-2-å°‡DataFrameå­˜å…¥CSVæª” & æŠ“å–å¤šç­†è³‡æ–™"}}},{"node":{"id":"cbc00f9f-691d-55bb-b94d-9626ccd82c85","fields":{"slug":"/TWSE-3/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-3-TWSEçš„è³‡æ–™å­˜å…¥SQLite"}}},{"node":{"id":"86351f17-7bd3-5d53-b5c0-b8a09c915143","fields":{"slug":"/TWSE-4/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-4-è³‡æ–™å­˜å…¥MySQLåŠå–å‡º"}}},{"node":{"id":"fb2f8d77-486a-51de-be15-df09463393a8","fields":{"slug":"/TWSE-5/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-5-mpl_finance Kç·šåœ–"}}},{"node":{"id":"f61afa98-58c0-5b78-8a49-d195b14ad223","fields":{"slug":"/TWSE-6/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-6-MySQL to Dataframe & mplfinance Kç·šåœ–"}}},{"node":{"id":"a02d0528-84ff-5573-b188-9292da9a5fda","fields":{"slug":"/TWSE-7/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-7-Interactive Candlestick Charts"}}},{"node":{"id":"d6651b52-be20-5a3d-87a8-b8036f1bff68","fields":{"slug":"/TWSE-8/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-8-plotly | Chart Studio | 1"}}},{"node":{"id":"354205b6-2680-5494-9688-421c384c2e7c","fields":{"slug":"/TWSE-9/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-9-Bs4 + é‰…äº¨ç¶²"}}},{"node":{"id":"c5dd3d84-ee79-50ff-bbb7-4081479a3c49","fields":{"slug":"/TWSE-10-1/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-10-1-MongoDB+Python"}}},{"node":{"id":"891d93d2-e527-5635-bfb0-23c478c5e65f","fields":{"slug":"/TWSE-10-2/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-10-2-MongoDB+Python"}}},{"node":{"id":"cb12e004-6706-503c-be88-311feff22a6c","fields":{"slug":"/TWSE-10-3/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-10-3-MongoDB+Python"}}},{"node":{"id":"5891f396-11aa-55b9-b766-888ed2c6814f","fields":{"slug":"/TWSE-10-4/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-10-4-MongoDB+Python"}}},{"node":{"id":"8b6644eb-6972-55ca-8d28-d43250b9b5d7","fields":{"slug":"/TWSE-11/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-11-Wordcloud + MongoDB"}}},{"node":{"id":"16e41194-8361-5114-8171-1bebe6f4c75e","fields":{"slug":"/TWSE-12/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-12-Efficient Frontier"}}},{"node":{"id":"b2d27c4b-8019-5ba4-923d-8e66c8772c61","fields":{"slug":"/TWSE-13/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-13-Selenium + é‰…äº¨ç¶²"}}},{"node":{"id":"686b1422-7e63-516f-a3a1-30b86e86aa8c","fields":{"slug":"/About/"},"frontmatter":{"title":"ğŸ˜¶ About"}}},{"node":{"id":"51baac29-b12a-5cdc-ae5b-db1fa86fe935","fields":{"slug":"/C-1/"},"frontmatter":{"title":"ğŸ–¥ï¸ C-Set up Visual Studio Code"}}},{"node":{"id":"4dd46789-25c7-56ec-869d-d4114e3f7c71","fields":{"slug":"/VSCode-imgur/"},"frontmatter":{"title":"ğŸ–¥ï¸ Visual Studio Code + Imgur"}}},{"node":{"id":"1b91a9d3-1f8a-5c85-8423-9b119011250b","fields":{"slug":"/OCW/"},"frontmatter":{"title":"ğŸ““ Online Course"}}},{"node":{"id":"9e148609-92c6-5429-8913-89c5b9ff96bc","fields":{"slug":"/projects/"},"frontmatter":{"title":"ğŸ’¼ Projects"}}}]},"previous":{"fields":{"slug":"/TWSE-3/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-3-TWSEçš„è³‡æ–™å­˜å…¥SQLite"}},"next":{"fields":{"slug":"/TWSE-5/"},"frontmatter":{"title":"ğŸ“ˆ TWSE-5-mpl_finance Kç·šåœ–"}}},"pageContext":{"id":"86351f17-7bd3-5d53-b5c0-b8a09c915143","series":null,"previousPostId":"cbc00f9f-691d-55bb-b94d-9626ccd82c85","nextPostId":"fb2f8d77-486a-51de-be15-df09463393a8"}},
    "staticQueryHashes": []}